import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;
import java.util.Calendar;

public class MonthView2 extends HttpServlet{

    public void doGet(HttpServletRequest req, HttpServletResponse res)
        throws ServletException, IOException{

        res.setContentType("text/html;charset=Shift_Jis");
        PrintWriter out = res.getWriter();

        int[] calendarDay;
        int count;

        calendarDay = new int[42];  /* Å‘å‚Å7“ú~6T */
        count = 0;

        StringBuffer sb = new StringBuffer();

        sb.append("<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.0.1//EN\" \"http://www.w3.org/TR/html4/strict.dtd\">");

        sb.append("<html lang=\"ja\">");
        sb.append("<head>");
        sb.append("<meta http-equiv=\"Content-Type\" Content=\"text/html;charset=Shift_JIS\">");

        sb.append("<title>ƒXƒPƒWƒ…[ƒ‹ŠÇ—</title>");

        sb.append("<style>");
        sb.append("table{border:1px solid #a9a9a9;width:90%;padding:0px;margin:0px;border-collapse:collapse;}");
        sb.append("td{width:12%;border-top:1px solid #a9a9a9;border-left:1px solid #a9a9a9;vertical-align:top;margin:0px;padding:2px;}");
        sb.append("td.week{background-color:#f0f8ff;text-align:center;}");
        sb.append("td.day{background-color:#f5f5f5;text-align:right;font-size:0.75em;}");
        sb.append("td.otherday{background-color:#f5f5f5;color:#d3d3d3;text-align:right;font-size:0.75em;}");
        sb.append("td.sche{background-color:#fffffff;text-align:left;height:80px;}");
        sb.append("img{border:0px;}");
        sb.append("p{font-size:0.75em;}");
        sb.append("</style>");

        sb.append("</head>");
        sb.append("<body>");

        Calendar calendar = Calendar.getInstance();
        int year = calendar.get(Calendar.YEAR);
        int month = calendar.get(Calendar.MONTH);
        int day = calendar.get(Calendar.DATE);

        /* “ú•tƒf[ƒ^‚ğ”z—ñ‚ÉŠi”[ */
        count = setDateArray(year, month, day, calendarDay, count);

        sb.append("<p>" + year + "”N" + (month + 1) + "Œ</p>");

        sb.append("<table>");

        sb.append("<tr><td class=\"week\">“ú</td><td class=\"week\">Œ</td><td class=\"week\">‰Î</td><td class=\"week\">…</td><td class=\"week\">–Ø</td><td class=\"week\">‹à</td><td class=\"week\">“y</td></tr>");

        int weekCount = count / 7;

        for (int i = 0 ; i < weekCount ; i++){
            sb.append("<tr>");

            for (int j = i * 7 ; j < i * 7 + 7 ; j++){
                if (calendarDay[j] > 35){
                    sb.append("<td class=\"otherday\">");
                    sb.append(calendarDay[j] - 35);
                }else{
                    sb.append("<td class=\"day\">");
                    sb.append(calendarDay[j]);
                }
                sb.append("</td>");
            }

            sb.append("</tr>");
            sb.append(createScheduleStr());
        }

        sb.append("</table>");

        sb.append("</body>");
        sb.append("</html>");

        out.println(new String(sb));
    }

    protected String createScheduleStr(){
        StringBuffer sb = new StringBuffer();

        sb.append("<tr>");
        for (int i = 0 ; i < 7 ; i++){
            sb.append("<td class=\"sche\"><img src="../../index.htm" tppabs="https://www.javadrive.jp/"./img/memo.png/"" width=\"14\" height=\"16\"></td>");
        }
        sb.append("</tr>");

        return (new String(sb));
    }

    protected int setDateArray(int year, int month, int day, int[] calendarDay, int count){

        Calendar calendar = Calendar.getInstance();

        /* ¡Œ‚ª‰½—j“ú‚©‚çŠJn‚³‚ê‚Ä‚¢‚é‚©Šm”F‚·‚é */
        calendar.set(year, month, 1);
        int startWeek = calendar.get(Calendar.DAY_OF_WEEK);
        System.out.println("¡Œ‚Ì—j“ú‚Í" + startWeek + "‚©‚ç");

        /* æŒ‚ª‰½“ú‚Ü‚Å‚¾‚Á‚½‚©‚ğŠm”F‚·‚é */
        calendar.set(year, month, 0);
        int beforeMonthlastDay = calendar.get(Calendar.DATE);
        System.out.println("æŒ‚Í" + beforeMonthlastDay + "“ú‚Ü‚Å");

        /* ¡Œ‚ª‰½“ú‚Ü‚Å‚©‚ğŠm”F‚·‚é */
        calendar.set(year, month + 1, 0);
        int thisMonthlastDay = calendar.get(Calendar.DATE);
        System.out.println("¡Œ‚Í" + thisMonthlastDay + "“ú‚Ü‚Å\r\n");

        /* æŒ•ª‚Ì“ú•t‚ğŠi”[‚·‚é */
        for (int i = startWeek - 2 ; i >= 0 ; i--){
            calendarDay[count++] = beforeMonthlastDay - i + 35;
        }

        /* ¡Œ•ª‚Ì“ú•t‚ğŠi”[‚·‚é */
        for (int i = 1 ; i <= thisMonthlastDay ; i++){
            calendarDay[count++] = i;
        }

        /* —‚Œ•ª‚Ì“ú•t‚ğŠi”[‚·‚é */
        int nextMonthDay = 1;
        while (count % 7 != 0){
            calendarDay[count++] = 35 + nextMonthDay++;
        }

        return count;
    }
}
