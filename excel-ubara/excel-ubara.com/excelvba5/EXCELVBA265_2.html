<!DOCTYPE html>
<html lang="ja">
<head>
  <script data-ad-client="ca-pub-6511020045004282" async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6511020045004282",
      enable_page_level_ads: true
    });
  </script>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>他ブックへのリンクエラーを探し解除するマクロ｜VBAサンプル集</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="リンクエラーが見つけられない… 「リンクの編集」で、「リンクの解除」を選択してもリンクが削除できない… 前ページの他ブックへのリンクエラーを探し解除するでは、発生原因や外部（他ブック）リンクの探し方を解説しました、簡単には探せないということも説明しました。自分で必要でもあり使いたいということでマクロを作成したのですが、">
  <meta name="keywords" content="他ブックへ,リンクエラーを探し解除する,サンプル集,エクセル,Excel,マクロ,VBA">
  <link rel="icon" type="image/x-icon" href="../images/favicon_excel.png">
  <link rel="stylesheet" href="../css/style.css-20210304.css" tppabs="https://excel-ubara.com/css/style.css?20210304">
  <link rel="stylesheet" href="../css/slide.css-20210304.css" tppabs="https://excel-ubara.com/css/slide.css?20210304">
  <link rel="canonical" href="https://excel-ubara.com/excelvba5/EXCELVBA265_2.html" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="他ブックへのリンクエラーを探し解除するマクロ｜VBAサンプル集" />
  <meta property="og:description" content="リンクエラーが見つけられない… 「リンクの編集」で、「リンクの解除」を選択してもリンクが削除できない… 前ページの他ブックへのリンクエラーを探し解除するでは、発生原因や外部（他ブック）リンクの探し方を解説しました、簡単には探せないということも説明しました。自分で必要でもあり使いたいということでマクロを作成したのですが、" />
  <meta property="og:image" content="https://excel-ubara.com/excelvba5/image74.jpg" />
  <meta property="og:url" content="https://excel-ubara.com/excelvba5/EXCELVBA265_2.html" />
  <meta property="og:site_name" content="エクセルの神髄" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="他ブックへのリンクエラーを探し解除するマクロ｜VBAサンプル集" />
  <meta name="twitter:description" content="リンクエラーが見つけられない… 「リンクの編集」で、「リンクの解除」を選択してもリンクが削除できない… 前ページの他ブックへのリンクエラーを探し解除するでは、発生原因や外部（他ブック）リンクの探し方を解説しました、簡単には探せないということも説明しました。自分で必要でもあり使いたいということでマクロを作成したのですが、" />
  <meta name="twitter:image" content="https://excel-ubara.com/excelvba5/image74.jpg" />
  <meta name="twitter:site" content="@yamaoka_ss" />
  <script src="../../code.jquery.com/jquery-3.3.1.min.js" tppabs="https://code.jquery.com/jquery-3.3.1.min.js" async></script>
  <script type="text/javascript" src="../js/fix.js" tppabs="https://excel-ubara.com/js/fix.js" async></script>
  <script type="text/javascript" src="../js/fixmenu_pagetop.js-20210304" tppabs="https://excel-ubara.com/js/fixmenu_pagetop.js?20210304" async></script>
  <script type="text/javascript" src="../js/CopyDisp.js-20210304" tppabs="https://excel-ubara.com/js/CopyDisp.js?20210304" async></script>
</head>

<body class="c2">
  <header>
    <div class="inner">
      <p id="logo"><a href="../index.htm" tppabs="https://excel-ubara.com/"><img src="../images/logo.png" tppabs="https://excel-ubara.com/images/logo.png" alt="エクセルの神髄"></a></p>
      <div id="contact">
        <h1>VBAサンプル集<br>他ブックへのリンクエラーを探し解除するマクロ</h1>ExcelマクロVBAの実用サンプル、エクセルVBA集と解説
      </div>
    </div>
  </header>

  <!--PC用（801px以上端末）メニュー-->
  <nav id="dropmenu">
    <ul class="inner">
      <li><a href="../excel_index.html" tppabs="https://excel-ubara.com/excel_index.html">Excel全般<span>Excel</span></a>
        <ul>
          <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
          <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
          <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
          <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
          <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
          <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
        </ul>
      </li>
      <li><a href="../excel_vba1.html" tppabs="https://excel-ubara.com/excel_vba1.html">マクロVBA入門編<span>VBA Beginner</span></a>
        <ul>
          <li><a href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</a></li>
          <li><a href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</a></li>
          <li><a href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</a></li>
          <li><a href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</a></li>
          <li><a href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</a></li>
          <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
          <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
        </ul>
      </li>
      <li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編<span>VBA Advanced</span></a>
        <ul>
          <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
          <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
          <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
          <li><A href="../excelvba4/index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
          <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
          <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
        </ul>
      </li>
      <li><a href="../excel_other.html" tppabs="https://excel-ubara.com/excel_other.html">その他（Excel以外）<span>Other than Excel</span></a>
        <ul>
          <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">Python入門</A></li>
          <li><A href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">SQL入門</A></li>
          <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">スプレッドシート入門</A></li>
          <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">GAS入門</A></li>
        </ul>
      </li>
      <li><a href="../siteguide.html" tppabs="https://excel-ubara.com/siteguide.html">サイト案内<span>site map</span></a>
        <ul>
          <li><A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧</A></li>
          <li><A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">アクセスランキング</A></li>
          <li><A href="../sitemap.html" tppabs="https://excel-ubara.com/sitemap.html">サイトマップ&nbsp;&nbsp;</A></li>
          <li><a href="../business/index.htm" tppabs="https://excel-ubara.com/business/">旧トップページ&nbsp;&nbsp;</a></li>
          <li><A href="../query.html" tppabs="https://excel-ubara.com/query.html">お問い合わせ&nbsp;&nbsp;</A></li>
        </ul>
      </li>
    </ul>
  </nav>

  <div id="pan"><ul itemscope itemtype="http://schema.org/BreadcrumbList">
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="../index.htm" tppabs="https://excel-ubara.com/">
<span itemprop="name">ホーム</span></a>
<meta itemprop="position" content="1" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">
<span itemprop="name">マクロVBA応用編</span></a>
<meta itemprop="position" content="2" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">
<span itemprop="name">マクロVBAサンプル集</span></a>
<meta itemprop="position" content="3" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="EXCELVBA265_2.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265_2.html">
<span itemprop="name">他ブックへのリンクエラーを探し解除するマクロ</span></a>
<meta itemprop="position" content="4" />
</li>
</ul></div>
  <div class="ads1">
    <center>
    <script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- yama21 -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-6511020045004282"
        data-ad-slot="1104944574"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    </center>
  </div>

  <div id="contents" class="inner">
    <div id="contents-in">
      <div id="main">
        <section>
          <span style="line-height:20px;float:right" align="right">最終更新日：2020-08-28</span>
<h2 align="center">他ブックへのリンクエラーを探し解除するマクロ</h2><p><br>
<strong>リンクエラーが見つけられない</strong>・・・<br>
「リンクの編集」で、「リンクの解除」を選択しても<strong>リンクが削除できない</strong>・・・<br><div class="br2"><br></div>
前ページの<strong><a href="EXCELVBA265.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265.html" target="_blank">他ブックへのリンクエラーを探し解除する</a></strong>では、<div class="details">リンクエラーが見つけられない… 「リンクの編集」で、「リンクの解除」を選択してもリンクが削除できない… こんな経験をした人は多いのではないでしょうか。エクセルをいろいろと操作していると、意図せずに参照先が別ブックになってしまい、かつ、その参照先のブックが無くなってしまっている… こんな場合に、リンクエラーとなります。</div>
発生原因や外部（他ブック）リンクの探し方を解説しました、<br>
簡単には探せないということも説明しました。<br><div class="br2"><br></div>
自分で必要でもあり使いたいということでマクロを作成したのですが、<br>
公開にあたって、機能を盛り込みアプリっぽくしたものを公開します。<br><div class="br2"><br></div>
マクロVBAはかなり大きく、複雑になっていますので、<br>
VBAの詳しい解説は省略しています。<br>
書いたVBAコードは公開することを意図して、<br>
意図的に細かいテクニックをいろいろなパターンで使っています。<br>
VBA内のコメントを頼りにコードを読み解いていくのは、VBAの良い勉強になると思います。<br><div class="br2"><br></div>
シート構成と全体の流れの詳細は、<br>
前ページの<strong><a href="EXCELVBA265.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265.html" target="_blank">他ブックへのリンクエラーを探し解除する</a></strong>を参照してください。<div class="details">リンクエラーが見つけられない… 「リンクの編集」で、「リンクの解除」を選択してもリンクが削除できない… こんな経験をした人は多いのではないでしょうか。エクセルをいろいろと操作していると、意図せずに参照先が別ブックになってしまい、かつ、その参照先のブックが無くなってしまっている… こんな場合に、リンクエラーとなります。</div>
ここでは、マクロVBAの全文を掲載をします。<br><div class="br2"><br></div><div class="br2"><br></div>
<strong>機能概要</strong></p>
<div class="main-indent">「検索開始」ボタン</div>
<div class="main-indent">
<div class="main-indent">・指定ブックの外部（他のブックの）リンクを全て取得して一覧表示します。<br>
　リンク切れかどうかにかかわらず、全ての外部（他のブックの）リンクを出力します。<br>
・リンク判定として、リンク切れの場合は「×」、数式が複雑で判定困難な場合は「△」を出力します。<br>
・削除すべきリンクについては、削除欄に「する」を出力。</div>
</div>
<div class="main-indent">「削除」ボタン</div>
<div class="main-indent">
<div class="main-indent">削除欄「する」のリンクを削除します。</div>
</div>
<div class="main-indent">「表示最大件数」について</div>
<div class="main-indent">
<div class="main-indent">外部（他のブック）リンクは、正常かエラーかにかかわらずセル毎に全て一覧に出力します。<br>
行全体、列全体に対して（条件付き書式や入力規則が）リンク設定されている場合は膨大な数となってしまいます。<br>
連続セルが同一設定の場合はセル範囲で出力するようにしていますが、<br>
1行おきに交互に違う設定がしてある場合等、<br>
セル範囲でまとめて表現できない場合に出力行数が膨大になってしまう場合があります。<br>
そのような場合の対応として、「表示最大件数」を超えた時点で処理を終了しています。<br>
また、リンクされている件数が多いと多大な処理時間がかかってしまうので、<br>
最初は少ない数字にして確認したほうが良いでしょう。</div>
</div><p><br>
<strong>シート構成</strong></p>
<div class="main-indent">シートは、「リンクエラー検索」の一つだけです。<br><div class="br2"><br></div>
<img src="image57.jpg" tppabs="https://excel-ubara.com/excelvba5/image57.jpg" width="561" height="198" border="0" alt="マクロVBA リンクエラー画像"><br>
</div><p><br>
<strong>全体の流れ</strong></p>
<div class="main-indent">「検索開始」ボタン<br>
↓<br>
検索対象のブックを選択<br>
↓<br>
結果が5行目以降に表示されます。<br>
↓<br>
検索完了メッセージが表示されます。<br>
↓<br>
表示された一覧を確認し、E列の「する」を適切に指定してください。<br>
↓<br>
「削除」ボタンでE列「する」が削除されます。 </div><p><br>
<div class="br2"><br></div>
以下に、VBAコードを掲載します。<br>
結構長いVBAとなっていますので、個別の説明は省略します。<br>
VBAコード内に適宜コメントを入れていますので、これを参考に読み解いてみてください。<br><div class="br2"><br></div>
<strong>標準モジュール</strong></p>
<div class="main-indent">一旦掲載後にVBAコードを何度か大幅に変更しています。<br>
当初掲載のVBAコードはこちら</div>
<div class="main-indent">
<div class="main-indent"><a href="EXCELVBA265_3.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265_3.html" target="_blank">他ブックへのリンクエラーを探し解除するマクロ（変更前）</a><br>
</div>
</div>
<div class="main-indent"><br>
以下は変更後のマクロVBAコードになります。<br>
モジュール名は何でも構いません。<br>
以下では、モジュールを3つに分けています。<br>
・Constと共通関数<br>
・「検索開始」ボタン<br>
・「削除」ボタン<br><div class="br2"><br></div><br>
<div class="ads1">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="6991829975"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div><br><form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Option Explicit<br><div class="br2"><br></div>
      <span style="color:#009900;">'待機中のイベントがある時だけDoEventsがCallされる</span><br>
Public Declare PtrSafe Function GetInputState Lib &quot;USER32&quot; () As Long<br><div class="br2"><br></div>
Public Const NmTargetBook As String = &quot;nmTargetBook&quot; <span style="color:#009900;">'対象ブック指定のセル</span><br>
Public Const NmCntMax As String = &quot;nmCntMax&quot; <span style="color:#009900;">'表示最大件数のセル</span><br>
Public Const StartErrRow As Long = 5　 <span style="color:#009900;">'出力シートの開始行</span><br><div class="br2"><br></div>
<span style="color:#009900;">'出力文字列定数</span><br>
Public Const Cns数式 As String = &quot;数式&quot;<br>
Public Const Cns名前定義 As String = &quot;名前定義&quot;<br>
Public Const Cns条件書式 As String = &quot;条件書式&quot;<br>
Public Const Cns入力規則 As String = &quot;入力規則&quot;<br>
Public Const Cnsマクロ登録 As String = &quot;マクロ登録&quot;<br>
Public Const Cnsバツ As String = &quot;×&quot;<br>
Public Const Cns三角 As String = &quot;△&quot;<br>
Public Const Cnsする As String = &quot;する&quot;<br>
Public Const Cnsしない As String = &quot;しない&quot;<br>
Public Const Cns削除済 As String = &quot;削除済&quot;<br><div class="br2"><br></div>
Public wb As Workbook　　　　　<span style="color:#009900;">'検索対象ブック</span><br>
Public ws As Worksheet　　　　 <span style="color:#009900;">'検索対象シート</span><br>
Public WsErr As Worksheet　　　<span style="color:#009900;">'出力シート</span><br>
Public ErrMsg As String　　　　<span style="color:#009900;">'保存用エラーメッセージ</span><br>
Public CntAll As Long　　　　　<span style="color:#009900;">'確認するセル数</span><br>
Public CntMax As Long　　　　　<span style="color:#009900;">'表示最大件数</span><br>
Public HoldAddress As String　 <span style="color:#009900;">'セル範囲統合中のアドレス</span><br>
Public CntHold As Long　　　　 <span style="color:#009900;">'セル範囲統合中の件数</span><br><div class="br2"><br></div>
Public Enum Col <span style="color:#009900;">'出力シートの列位置の列挙</span><br>
　　種別 = 1<br>
　　場所 = 2<br>
　　詳細 = 3<br>
　　判定 = 4<br>
　　削除 = 5<br>
End Enum<br><div class="br2"><br></div>
<span style="color:#009900;">'###　Rangeオブジェクトからセルのアドレス文字を作成　###</span><br>
Public Function RangeToAddress(ByVal rng As Range, _<br>
　　　　　　　　　　　　　　　　Optional ByVal strFix As String) _<br>
　　　　　　　　　　　　　　　　As String<br>
　　RangeToAddress = strFix &amp; &quot;'&quot; &amp; rng.Worksheet.Name &amp; _<br>
　　　　　　　　　　 &quot;'!&quot; &amp; rng.Address(False, False)<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　セルのアドレス文字からRangeオブジェクトを作成　###</span><br>
Public Function AddressToRange(ByVal wb As Workbook, _<br>
　　　　　　　　　　　　　　　　ByVal sAddress As String, _<br>
　　　　　　　　　　　　　　　　Optional ByVal i As Long = 0) _<br>
　　　　　　　　　　　　　　　　As Range<br>
　　Dim sSheet As String<br>
　　Dim sRange As String<br>
　　Dim iPos As Long<br>
　　<br>
　　<span style="color:#009900;">'アドレス文字に!がない場合は処理不能</span><br>
　　If InStr(sAddress, &quot;!&quot;) = 0 Then<br>
　　　　If i &gt; 0 Then MsgBox &quot;B&quot; &amp; i &amp; &quot;セルの値が不正です。&quot;<br>
　　　　End<br>
　　End If<br>
　　<br>
　　Err.Clear <span style="color:#009900;">'念のため呼出元でエラーが出ていた場合</span><br>
　　<br>
　　<span style="color:#009900;">'&quot;!&quot;でシート名とセルアドレス文字に分割</span><br>
　　iPos = InStrRev(sAddress, &quot;!&quot;)<br>
　　sSheet = Mid(sAddress, 2, iPos - 3)<br>
　　sRange = Mid(sAddress, iPos + 1)<br>
　　<br>
　　<span style="color:#009900;">'シート名とセルアドレス文字からRangeオブジェクト作成</span><br>
　　Set AddressToRange = wb.Worksheets(sSheet).Range(sRange)<br>
　　If Err Then<br>
　　　　Err.Clear<br>
　　　　If i &gt; 0 Then MsgBox &quot;B&quot; &amp; i &amp; &quot;セルの値が不正です。&quot;<br>
　　　　End<br>
　　End If<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　ステータスバー表示　###</span><br>
Public Sub DispStatusBar(ByVal argMsg1 As String, _<br>
　　　　　　　　　　　　　　Optional ByVal argMsg2 As String = &quot;&quot;)<br>
　　Static StatusMsg As String <span style="color:#009900;">'静的変数</span><br>
　　If argMsg1 &lt;&gt; &quot;&quot; Then StatusMsg = argMsg1<br>
　　If argMsg2 &lt;&gt; &quot;&quot; Then argMsg2 = &quot;（&quot; &amp; argMsg2 &amp; &quot;）&quot;<br>
　　Application.StatusBar = StatusMsg &amp; argMsg2<br>
　　If GetInputState() Then DoEvents<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'### 件数カウントとセル数が多いと「反応なし」になることへの対応 ###</span><br>
Public Sub CountAndDoEvents()<br>
　　CntAll = CntAll + 1<br>
　　If GetInputState() Then DoEvents<br>
      End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Option Explicit<br><div class="br2"><br></div>
<span style="color:#009900;">'###　リンクエラー検索のメイン処理：「検索開始」ボタン　###</span><br>
Public Sub SearchErrorLink()<br>
　　Dim rng1 As Range<br>
　　Dim i As Long, j As Long<br>
　　Dim StartTime As Date<br>
　　Dim isErr As Boolean<br>
　　<br>
　　Set WsErr = ActiveSheet <span style="color:#009900;">'リンクエラー検索</span><br>
　　<br>
　　<span style="color:#009900;">'チェック対象ブック選択</span><br>
　　With WsErr<br>
　　　　.Unprotect <span style="color:#009900;">'シート保護解除</span><br>
　　　　Set wb = frmSelectBook.DoModal(.Range(NmTargetBook))<br>
　　　　If wb Is Nothing Then<br>
　　　　　　.Protect<br>
　　　　　　Exit Sub<br>
　　　　End If<br>
　　　　ThisWorkbook.Activate<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'開始処理</span><br>
　　StartTime = Now()<br>
　　Application.Cursor = xlWait<br>
　　CntAll = 0: HoldAddress = &quot;&quot;: CntHold = 0<br>
　　WsErr.Unprotect<br>
　　isErr = True<br>
　　<br>
　　<span style="color:#009900;">'エラー出力先を準備</span><br>
　　With WsErr<br>
　　　　CntMax = .Range(NmCntMax)<br>
　　　　Set rng1 = .Cells.SpecialCells(xlCellTypeLastCell)<br>
　　　　If rng1.Row &gt;= StartErrRow Then<br>
　　　　　　.Range(.Cells(StartErrRow, &quot;A&quot;), rng1).Clear<br>
　　　　End If<br>
　　　　.Range(.Columns(Col.場所), .Columns(Col.詳細)).NumberFormatLocal = &quot;@&quot;<br>
　　　　.Range(.Columns(Col.場所), .Columns(Col.詳細)).WrapText = True<br>
　　　　.Range(.Columns(Col.判定), .Columns(Col.削除)).Font.Bold = True<br>
　　　　.Range(.Columns(Col.判定), .Columns(Col.削除)).HorizontalAlignment = xlCenter<br>
　　　　Application.Goto .Cells(StartErrRow, Col.種別), True<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'数式</span><br>
　　If Not checkFormula(wb) Then GoTo FinalExit<br>
　　<br>
　　<span style="color:#009900;">'名前定義</span><br>
　　If Not checkNames(wb) Then GoTo FinalExit<br>
　　<br>
　　<span style="color:#009900;">'条件付き書式</span><br>
　　If Not checkFormatConditions(wb) Then GoTo FinalExit<br>
　　<br>
　　<span style="color:#009900;">'入力規則</span><br>
　　If Not checkValidation(wb) Then GoTo FinalExit<br>
　　<br>
　　<span style="color:#009900;">'オブジェクトの登録マクロ</span><br>
　　If Not checkShapes(wb) Then GoTo FinalExit<br>
　　<br>
　　isErr = False<br>
　　<br>
FinalExit: <span style="color:#009900;">'途中でエラーがあった時の飛び先</span><br>
　　If isErr Then<br>
　　　　MsgBox &quot;処理中で問題が発生しました。&quot; &amp; vbLf &amp; _<br>
　　　　　　　　&quot;途中からは処理がスキップされています。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　Application.StatusBar &amp; vbLf &amp; _<br>
　　　　　　　　ErrMsg &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　Err.Description, vbExclamation<br>
　　End If<br>
　　<br>
　　<span style="color:#009900;">'エラー出力シートを設定</span><br>
　　Call setOutputSheet<br>
　　<br>
　　<span style="color:#009900;">'終了処理</span><br>
　　Dim CntLink As Long, CntErr As Long, CntPend As Long<br>
　　With WsErr<br>
　　　　CntLink = .Cells(.Rows.Count, Col.種別).End(xlUp).Row - StartErrRow + 1<br>
　　　　CntErr = WorksheetFunction.CountIf(.Columns(Col.判定), &quot;*&quot; &amp; Cnsバツ &amp; &quot;*&quot;)<br>
　　　　CntPend = WorksheetFunction.CountIf(.Columns(Col.判定), &quot;*&quot; &amp; Cns三角 &amp; &quot;*&quot;)<br>
　　End With<br>
　　Application.StatusBar = False<br>
　　Application.Cursor = xlDefault<br>
　　MsgBox &quot;チェック完了しました。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　&quot;処理時間=&quot; &amp; CDate(Now() - StartTime) &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　&quot;確認セル範囲数 = &quot; &amp; Format(CntAll, &quot;#,##0&quot;) &amp; vbLf &amp; _<br>
　　　　　　&quot;　外部 リンク数 = &quot; &amp; Format(CntLink, &quot;#,##0&quot;) &amp; vbLf &amp; _<br>
　　　　　　&quot;　エラー リンク 数 = &quot; &amp; Format(CntErr, &quot;#,##0&quot;) &amp; vbLf &amp; _<br>
　　　　　　&quot;　保留 リンク数 = &quot; &amp; Format(CntPend, &quot;#,##0&quot;), _<br>
　　　　　　vbOKOnly, &quot;結果表示&quot;<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'数式</span><br>
Private Function checkFormula(ByVal wb As Workbook) As Boolean<br>
　　Dim rng1 As Range, rng2 As Range<br>
　　On Error Resume Next<br>
　　For Each ws In wb.Worksheets<br>
　　　　Call DispStatusBar(&quot;数式のチェック中：&quot; &amp; ws.Name)<br>
　　　　Set rng1 = ws.Cells.SpecialCells(xlCellTypeFormulas)<br>
　　　　If Err Then<br>
　　　　　　Err.Clear<br>
　　　　Else<br>
　　　　　　For Each rng2 In rng1<br>
　　　　　　　　If setError(rng2, rng2.Formula) Then Exit Function<br>
　　　　　　　　Call CountAndDoEvents<br>
　　　　　　Next<br>
　　　　End If<br>
　　Next<br>
　　On Error GoTo 0<br>
　　checkFormula = True<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'名前定義</span><br>
Private Function checkNames(ByVal wb As Workbook) As Boolean<br>
　　Dim nm As Name<br>
　　On Error Resume Next<br>
　　Call DispStatusBar(&quot;名前定義のチェック中：&quot;)<br>
　　For Each nm In wb.Names<br>
　　　　If setError(nm, nm.RefersTo) Then Exit Function<br>
　　　　Call CountAndDoEvents<br>
　　Next<br>
　　checkNames = True<br>
End Function<br>
　　<br>
<span style="color:#009900;">'条件付き書式</span><br>
Private Function checkFormatConditions(ByVal wb As Workbook) As Boolean<br>
　　Dim i As Long<br>
　　Dim rng1 As Range, rng2 As Range<br>
　　Dim fcds As FormatConditions<br>
　　Dim fcd As FormatCondition<br>
　　Dim ws As Worksheet<br>
　　On Error Resume Next<br>
　　For Each ws In wb.Worksheets<br>
　　　　Call DispStatusBar(&quot;条件付き書式のチェック中：&quot; &amp; ws.Name)<br>
　　　　Set rng1 = ws.Cells.SpecialCells(xlCellTypeAllFormatConditions)<br>
　　　　If Err Then<br>
　　　　　　Err.Clear<br>
　　　　Else<br>
　　　　　　Set fcds = rng1.FormatConditions<br>
　　　　　　For i = fcds.Count To 1 Step -1<br>
　　　　　　　　<span style="color:#009900;">'「数式を使用して…」のみ対象</span><br>
　　　　　　　　If TypeName(fcds(i)) = &quot;FormatCondition&quot; Then<br>
　　　　　　　　　　Set fcd = fcds(i)<br>
　　　　　　　　　　<span style="color:#009900;">'Parentからセルを取得するためコレクションを渡す</span><br>
　　　　　　　　　　If setError(fcds, fcd.Formula1, i) Then Exit Function<br>
　　　　　　　　End If<br>
　　　　　　　　Call CountAndDoEvents<br>
　　　　　　Next<br>
　　　　End If<br>
　　Next<br>
　　checkFormatConditions = True<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'入力規則</span><br>
Private Function checkValidation(ByVal wb As Workbook) As Boolean<br>
　　Dim rng1 As Range, rng2 As Range, rng3 As Range<br>
　　Dim vdt As Validation<br>
　　On Error Resume Next<br>
　　For Each ws In wb.Worksheets<br>
　　　　Call DispStatusBar(&quot;入力規則のチェック中：&quot; &amp; ws.Name)<br>
　　　　Set rng1 = ws.Cells.SpecialCells(xlCellTypeAllValidation)<br>
　　　　If Err Then<br>
　　　　　　Err.Clear<br>
　　　　Else<br>
　　　　　　For Each rng2 In rng1.Areas<br>
　　　　　　　　Set vdt = rng2.Validation<br>
　　　　　　　　If vdt.Formula1 &amp; vdt.Formula2 &lt;&gt; &quot;&quot; Then<br>
　　　　　　　　　　If Err Then<br>
　　　　　　　　　　　　Err.Clear<br>
　　　　　　　　　　　　For Each rng3 In rng2<br>
　　　　　　　　　　　　　　Set vdt = rng3.Validation<br>
　　　　　　　　　　　　　　If setError(vdt, vdt.Formula1 &amp; vdt.Formula2) Then Exit Function<br>
　　　　　　　　　　　　　　Call CountAndDoEvents<br>
　　　　　　　　　　　　Next<br>
　　　　　　　　　　Else<br>
　　　　　　　　　　　　If setError(vdt, vdt.Formula1 &amp; vdt.Formula2) Then Exit Function<br>
　　　　　　　　　　　　Call CountAndDoEvents<br>
　　　　　　　　　　End If<br>
　　　　　　　　End If<br>
　　　　　　Next<br>
　　　　End If<br>
　　Next<br>
　　checkValidation = True<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'オブジェクトの登録マクロ</span><br>
Private Function checkShapes(ByVal wb As Workbook) As Boolean<br>
　　Dim sp As Shape<br>
　　For Each ws In wb.Worksheets<br>
　　　　Call DispStatusBar(&quot;登録マクロのチェック中：&quot; &amp; ws.Name)<br>
　　　　For Each sp In ws.Shapes<br>
　　　　　　If Left(sp.Name, 9) &lt;&gt; &quot;Drop Down&quot; Then<br>
　　　　　　　　If sp.OnAction Like &quot;*[!]*&quot; And _<br>
　　　　　　　　　 InStr(sp.OnAction, wb.Name &amp; &quot;!&quot;) &lt;&gt; 1 Then<br>
　　　　　　　　　　If setError(sp) Then Exit Function<br>
　　　　　　　　End If<br>
　　　　　　End If<br>
　　　　　　Call CountAndDoEvents<br>
　　　　Next<br>
　　Next<br>
　　checkShapes = True<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　エラー出力シート作成　###</span><br>
Private Sub setOutputSheet()<br>
　　Dim i As Long, j As Long<br>
　　ThisWorkbook.Activate<br>
　　With WsErr<br>
　　　　<span style="color:#009900;">'セル範囲アドレスの出力残</span><br>
　　　　j = .Cells(.Rows.Count, 1).End(xlUp).Row<br>
　　　　If CntHold &gt; 0 Then .Cells(j, Col.場所) = HoldAddress<br>
　　　　<br>
　　　　<span style="color:#009900;">'「削除」に入力規則設定</span><br>
　　　　With .Range(.Cells(StartErrRow, Col.削除), .Cells(j, Col.削除))<br>
　　　　　　.Validation.Delete<br>
　　　　　　.Validation.Add Type:=xlValidateList, Formula1:=Cnsする &amp; &quot;,&quot; &amp; Cnsしない<br>
　　　　　　.Interior.Color = XlRgbColor.rgbFloralWhite<br>
　　　　　　.Locked = False<br>
　　　　End With<br>
　　　　<br>
　　　　<span style="color:#009900;">'罫線設定</span><br>
　　　　.Cells(StartErrRow - 1, Col.種別).CurrentRegion.Borders.LineStyle = xlContinuous<br>
　　　　For i = StartErrRow To j<br>
　　　　　　If .Cells(i, Col.種別) &lt;&gt; .Cells(i - 1, Col.種別) Then<br>
　　　　　　　　.Range(.Cells(i, Col.種別), .Cells(i, Col.削除)).Borders(xlEdgeTop).LineStyle _<br>
　　　　　　　　　　= XlLineStyle.xlDouble<br>
　　　　　　End If<br>
　　　　Next<br>
　　　　<br>
　　　　<span style="color:#009900;">'条件付き書式と入力規則は、リンク先の存否にかかわらず削除対象</span><br>
　　　　For i = 5 To j<br>
　　　　　　If .Cells(i, Col.判定) = Cnsバツ Or _<br>
　　　　　　　　.Cells(i, Col.種別) = Cns条件書式 Or _<br>
　　　　　　　　.Cells(i, Col.種別) = Cns入力規則 Then<br>
　　　　　　　　If .Cells(i, Col.削除) = &quot;&quot; Then<br>
　　　　　　　　　　.Cells(i, Col.削除) = Cnsする<br>
　　　　　　　　End If<br>
　　　　　　End If<br>
　　　　Next<br>
　　　　Application.Goto .Cells(StartErrRow, Col.種別), True<br>
　　　　.Protect <span style="color:#009900;">'シート保護</span><br>
　　　　.Select<br>
　　End With<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'###　見つけた他ブックのリンクに対する処理　###</span><br>
Private Function setError(ByVal obj As Object, _<br>
　　　　　　　　　　　　　Optional ByVal sLink As String = &quot;&quot;, _<br>
　　　　　　　　　　　　　Optional ByVal i As Integer = 0) _<br>
　　　　　　　　　　　　　As Boolean<br>
　　<span style="color:#009900;">'外部リンクが無い場合はFalseで抜ける</span><br>
　　If sLink &lt;&gt; &quot;&quot; And _<br>
　　　 Not sLink Like &quot;*[[]*[]]*[!]*&quot; Then<br>
　　　　Exit Function<br>
　　End If<br>
　　<br>
　　Dim rng As Range, rng1 As Range, rng2 As Range<br>
　　Dim nm As Name<br>
　　Dim fcds As FormatConditions<br>
　　Dim vdt As Validation<br>
　　Dim sp As Shape<br>
　　Dim myArray(1 To 1, Col.種別 To Col.判定)<br>
　　Dim errRow As Long<br>
　　<br>
　　setError = True<br>
　　If Err Then Exit Function <span style="color:#009900;">'呼び出し元でエラーが出ている場合</span><br>
　　<br>
　　Select Case TypeName(obj)<br>
　　　　Case &quot;Range&quot; <span style="color:#009900;">'数式</span><br>
　　　　　　Set rng = obj<br>
　　　　　　ErrMsg = &quot;場所：&quot; &amp; rng.Address(False, False)<br>
　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cns数式, _<br>
　　　　　　　　　　　　　　RangeToAddress(rng, &quot;'&quot;), _<br>
　　　　　　　　　　　　　　rng.Formula, _<br>
　　　　　　　　　　　　　　isLinkExist(rng.Formula))<br>
　　　　Case &quot;Name&quot; <span style="color:#009900;">'名前定義</span><br>
　　　　　　Set nm = obj<br>
　　　　　　ErrMsg = &quot;場所：&quot; &amp; nm.Name<br>
　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cns名前定義, _<br>
　　　　　　　　　　　　　　nm.Name, _<br>
　　　　　　　　　　　　　　nm.RefersTo, _<br>
　　　　　　　　　　　　　　isLinkExist(nm.RefersTo))<br>
　　　　Case &quot;FormatConditions&quot; <span style="color:#009900;">'条件付き書式</span><br>
　　　　　　Set fcds = obj<br>
　　　　　　Set rng = fcds.Parent.Cells<br>
　　　　　　ErrMsg = &quot;場所：&quot; &amp; rng.Address(False, False)<br>
　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cns条件書式, _<br>
　　　　　　　　　　　　　　RangeToAddress(rng, &quot;'&quot;), _<br>
　　　　　　　　　　　　　　fcds(i).Formula1, _<br>
　　　　　　　　　　　　　　isLinkExist(fcds(i).Formula1))<br>
　　　　Case &quot;Validation&quot; <span style="color:#009900;">'入力規則</span><br>
　　　　　　Set vdt = obj<br>
　　　　　　Set rng = vdt.Parent<br>
　　　　　　ErrMsg = &quot;場所：&quot; &amp; rng.Address(False, False)<br>
　　　　　　If vdt.Formula2 = &quot;&quot; Then<br>
　　　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cns入力規則, _<br>
　　　　　　　　　　　　　　RangeToAddress(rng, &quot;'&quot;), _<br>
　　　　　　　　　　　　　　vdt.Formula1, _<br>
　　　　　　　　　　　　　　isLinkExist(vdt.Formula1))<br>
　　　　　　Else<br>
　　　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cns入力規則, _<br>
　　　　　　　　　　　　　　RangeToAddress(rng, &quot;'&quot;), _<br>
　　　　　　　　　　　　　　vdt.Formula1 &amp; vbLf &amp; vdt.Formula2, _<br>
　　　　　　　　　　　　　　isLinkExist(vdt.Formula1) &amp; vbLf &amp; _<br>
　　　　　　　　　　　　　　　　isLinkExist(vdt.Formula2))<br>
　　　　　　End If<br>
　　　　Case &quot;Shape&quot; <span style="color:#009900;">'オブジェクトの登録マクロ</span><br>
　　　　　　Set sp = obj<br>
　　　　　　Set rng = sp.TopLeftCell<br>
　　　　　　ErrMsg = &quot;場所：&quot; &amp; rng.Address(False, False)<br>
　　　　　　Call setMyArray(myArray, _<br>
　　　　　　　　　　　　　　Cnsマクロ登録, _<br>
　　　　　　　　　　　　　　sp.Name &amp; &quot;:&quot; &amp; RangeToAddress(rng), _<br>
　　　　　　　　　　　　　　sp.OnAction, _<br>
　　　　　　　　　　　　　　isLinkExist2(sp.OnAction))<br>
　　　　Case Else <span style="color:#009900;">'あり得ないが念のため</span><br>
　　　　　　ErrMsg = TypeName(obj) &amp; &quot;:&quot; &amp; obj.Name<br>
　　End Select<br>
　　<br>
　　errRow = WsErr.Cells(WsErr.Rows.Count, Col.種別).End(xlUp).Row + 1<br>
　　　　<br>
　　<span style="color:#009900;">'出力セルを範囲に統合</span><br>
　　If myArray(1, Col.種別) = WsErr.Cells(errRow - 1, Col.種別) And _<br>
　　　　myArray(1, Col.詳細) = WsErr.Cells(errRow - 1, Col.詳細) Then<br>
　　　　Select Case myArray(1, Col.種別)<br>
　　　　　　Case Cns数式, Cns条件書式, Cns入力規則<br>
　　　　　　　　If CntHold &gt; 0 Then<br>
　　　　　　　　　　Set rng1 = AddressToRange(wb, Mid(HoldAddress, 2))<br>
　　　　　　　　Else<br>
　　　　　　　　　　Set rng1 = AddressToRange(wb, WsErr.Cells(errRow - 1, Col.場所))<br>
　　　　　　　　End If<br>
　　　　　　　　Set rng2 = AddressToRange(wb, Mid(myArray(1, Col.場所), 2))<br>
　　　　　　　　If rng1.Worksheet Is rng2.Worksheet Then<br>
　　　　　　　　　　Set rng = Union(rng1, rng2)<br>
　　　　　　　　　　HoldAddress = RangeToAddress(rng, &quot;'&quot;)<br>
　　　　　　　　　　If CntHold Mod 100 = 0 Then<br>
　　　　　　　　　　　　Call DispStatusBar(&quot;&quot;, &quot;同一設定の統合中：&quot; &amp; HoldAddress)<br>
　　　　　　　　　　End If<br>
　　　　　　　　　　CntHold = CntHold + 1<br>
　　　　　　　　　　errRow = 0<br>
　　　　　　　　End If<br>
　　　　End Select<br>
　　End If<br>
　　<br>
　　<span style="color:#009900;">'シートに出力</span><br>
　　With WsErr<br>
　　　　If errRow &gt; 0 Then<br>
　　　　　　If CntHold &gt; 0 Then<br>
　　　　　　　　.Cells(errRow - 1, Col.場所) = HoldAddress<br>
　　　　　　　　HoldAddress = &quot;&quot;: CntHold = 0<br>
　　　　　　　　Call DispStatusBar(&quot;&quot;)<br>
　　　　　　End If<br>
　　　　　　.Range(.Cells(errRow, Col.種別), .Cells(errRow, Col.判定)) = myArray<br>
　　　　　　<span style="color:#009900;">'マクロブックに切り替えて進捗が見えるように</span><br>
　　　　　　ThisWorkbook.Activate<br>
　　　　　　.Select<br>
　　　　　　DoEvents<br>
　　　　　　If errRow &gt; 0 Then .Cells(errRow, Col.場所).Select<br>
　　　　　　DoEvents<br>
　　　　End If<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'表示最大件数の確認</span><br>
　　If errRow - StartErrRow + 1 &gt; CntMax Then<br>
　　　　ErrMsg = ErrMsg &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;エラー最大件数件を超えました。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;処理を終了します。&quot;<br>
　　　　setError = True<br>
　　　　Exit Function<br>
　　End If<br>
　　<br>
　　setError = False<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　配列へ入れるだけ、記述の簡易化の為だけ　###</span><br>
Private Sub setMyArray(ByRef myArray(), _<br>
　　　　　　　　　　　　ByVal arg1 As String, _<br>
　　　　　　　　　　　　ByVal arg2 As String, _<br>
　　　　　　　　　　　　ByVal arg3 As String, _<br>
　　　　　　　　　　　　ByVal arg4 As String)<br>
　　myArray(1, Col.種別) = arg1<br>
　　myArray(1, Col.場所) = arg2<br>
　　myArray(1, Col.詳細) = arg3<br>
　　myArray(1, Col.判定) = arg4<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'###　他ブックのリンク先のファイル存在確認　###</span><br>
Private Function isLinkExist(ByVal strLink As String) As String<br>
　　　　Dim wbWork As Workbook<br>
　　　　Dim iPos As Integer<br>
　　　　Dim sTemp As String<br>
　　　　<br>
　　　　isLinkExist = &quot;&quot;<br>
　　　　<br>
　　　　<span style="color:#009900;">'他ブック参照なしならExit</span><br>
　　　　If strLink = &quot;&quot; Then Exit Function<br>
　　　　If Not strLink Like &quot;*[[]*[]]*[!]*&quot; Then Exit Function<br>
　　　　<br>
　　　　<span style="color:#009900;">'他ブック参照が複数ある場合は判定保留</span><br>
　　　　If strLink Like &quot;*[[]*[]]*[[]*[]]*&quot; Then<br>
　　　　　　isLinkExist = Cns三角<br>
　　　　　　Exit Function<br>
　　　　End If<br>
　　　　<br>
　　　　<span style="color:#009900;">'先頭の=削除、数式先頭の関数を削除</span><br>
　　　　sTemp = editFormula(strLink)<br>
　　　　<br>
　　　　<span style="color:#009900;">'他ブックのフルパス取得、[]と!と\で判定</span><br>
　　　　sTemp = getBookFullpath(sTemp)<br>
　　　　<br>
　　　　<span style="color:#009900;">'ブック名だけの場合は、開いているブックを探す</span><br>
　　　　If InStr(sTemp, &quot;\&quot;) = 0 Then<br>
　　　　　　For Each wbWork In Workbooks<br>
　　　　　　　　If wbWork.Name = sTemp Then<br>
　　　　　　　　　　Exit Function<br>
　　　　　　　　End If<br>
　　　　　　Next<br>
　　　　End If<br>
　　　　<br>
　　　　<span style="color:#009900;">'フルパス以外はエラー</span><br>
　　　　If InStr(sTemp, &quot;\&quot;) = 0 Then<br>
　　　　　　isLinkExist = Cnsバツ<br>
　　　　　　Exit Function<br>
　　　　End If<br>
　　　　<br>
　　　　<span style="color:#009900;">'Dir関数でファイルの存在確認</span><br>
　　　　If Dir(sTemp) = &quot;&quot; Then<br>
　　　　　　If Err Then <span style="color:#009900;">'数式が複雑なためフルパスに変換失敗</span><br>
　　　　　　　　Err.Clear<br>
　　　　　　　　isLinkExist = Cns三角<br>
　　　　　　　　Exit Function<br>
　　　　　　End If<br>
　　　　　　isLinkExist = Cnsバツ<br>
　　　　End If<br>
End Function<br>
<span style="color:#009900;">'###　他ブックのリンク先のファイル存在確認：オブジェクト用　###</span><br>
Private Function isLinkExist2(ByVal strLink As String) As String<br>
　　　　Dim iPos As Integer<br>
　　　　Dim sTemp As String<br>
　　　　<br>
　　　　isLinkExist2 = &quot;&quot;<br>
　　　　<br>
　　　　<span style="color:#009900;">'他ブック参照なしならExit</span><br>
　　　　If strLink = &quot;&quot; Then Exit Function<br>
　　　　If InStr(strLink, &quot;\&quot;) = 0 Then Exit Function<br>
　　　　<br>
　　　　<span style="color:#009900;">'マクロの登録不正</span><br>
　　　　If InStr(strLink, &quot;!&quot;) = 0 Then<br>
　　　　　　isLinkExist2 = Cnsバツ<br>
　　　　　　Exit Function<br>
　　　　End If<br>
　　　　<br>
　　　　<span style="color:#009900;">'登録マクロのフルパス取得</span><br>
　　　　iPos = InStrRev(strLink, &quot;!&quot;)<br>
　　　　sTemp = Left(strLink, iPos - 1)<br>
　　　　If sTemp Like &quot;'*'&quot; Then<br>
　　　　　　sTemp = Mid(sTemp, 2, Len(sTemp) - 2)<br>
　　　　End If<br>
　　　　<br>
　　　　<span style="color:#009900;">'Dir関数でファイルの存在確認</span><br>
　　　　If Dir(sTemp) = &quot;&quot; Then<br>
　　　　　　If Err Then <span style="color:#009900;">'数式が複雑なためフルパスに変換失敗</span><br>
　　　　　　　　Err.Clear<br>
　　　　　　　　isLinkExist2 = Cns三角<br>
　　　　　　　　Exit Function<br>
　　　　　　End If<br>
　　　　　　isLinkExist2 = Cnsバツ<br>
　　　　End If<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　先頭の=削除と、数式先頭の関数を削除　###</span><br>
Private Function editFormula(ByVal aStr As String) As String<br>
　　Dim i As Long<br>
　　Dim iPos As Long<br>
　　<br>
　　<span style="color:#009900;">'先頭の=削除</span><br>
　　If Left(aStr, 1) = &quot;=&quot; Then aStr = Mid(aStr, 2)<br>
　　<br>
　　<span style="color:#009900;">'数式先頭の関数を削除</span><br>
　　iPos = 0<br>
　　For i = 1 To Len(aStr)<br>
　　　　If Mid(aStr, i, 1) = &quot;(&quot; Or _<br>
　　　　　　Mid(aStr, i, 1) = &quot;'&quot; Or _<br>
　　　　　　Mid(aStr, i, 1) = &quot;[&quot; Then<br>
　　　　　　iPos = i<br>
　　　　Else<br>
　　　　　　If (Mid(aStr, i, 1) &gt;= &quot;A&quot; And Mid(aStr, i, 1) &lt;= &quot;Z&quot;) Or _<br>
　　　　　　　　(Mid(aStr, i, 1) &gt;= &quot;0&quot; And Mid(aStr, i, 1) &lt;= &quot;9&quot;) Or _<br>
　　　　　　　　Mid(aStr, i, 1) = &quot;.&quot; Or _<br>
　　　　　　　　Mid(aStr, i, 1) = &quot;,&quot; Then<br>
　　　　　　Else<br>
　　　　　　　　Exit For<br>
　　　　　　End If<br>
　　　　End If<br>
　　Next<br>
　　If iPos &gt; 0 Then<br>
　　　　If Mid(aStr, iPos, 1) = &quot;[&quot; Then<br>
　　　　　　aStr = Mid(aStr, iPos)<br>
　　　　Else<br>
　　　　　　aStr = Mid(aStr, iPos + 1)<br>
　　　　End If<br>
　　End If<br>
　　<br>
　　editFormula = aStr<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'###　他ブックのフルパス取得、[]と!と\で判定　###</span><br>
Private Function getBookFullpath(ByVal aStr As String) As String<br>
　　Dim iPos As Long<br>
　　If aStr Like &quot;*[[]*[]]*&quot; Then<br>
　　　　aStr = Left(aStr, InStrRev(aStr, &quot;!&quot;) - 1)<br>
　　　　aStr = Left(aStr, InStrRev(aStr, &quot;]&quot;) - 1)<br>
　　　　If InStr(aStr, &quot;\&quot;) &gt; 0 Then<br>
　　　　　　iPos = InStrRev(aStr, &quot;\&quot;)<br>
　　　　Else<br>
　　　　　　iPos = 1<br>
　　　　End If<br>
　　　　iPos = InStr(iPos, aStr, &quot;[&quot;)<br>
　　　　aStr = Left(aStr, iPos - 1) &amp; Mid(aStr, iPos + 1)<br>
　　　　If Left(aStr, 1) = &quot;'&quot; Then aStr = Mid(aStr, 2)<br>
　　Else<br>
　　　　aStr = Left(aStr, InStr(aStr, &quot;!&quot;) - 1)<br>
　　　　If Right(aStr, 1) = &quot;'&quot; Then aStr = Left(aStr, Len(aStr) - 1)<br>
　　　　If Left(aStr, 1) = &quot;'&quot; Then aStr = Mid(aStr, 2)<br>
　　End If<br>
　　<br>
　　getBookFullpath = aStr<br>
      End Function</td>
    </tr>
  </tbody>
</table></code></div><br><div class="br2"><br></div>
<div class="ads1">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="7467492230"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div><br><form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Option Explicit<br><div class="br2"><br></div>
<span style="color:#009900;">'###　E列で削除実行のメイン処理：「削除」ボタン　###</span><br>
Public Sub DeleteErrorLink()<br>
　　Dim CntDel As Long<br>
　　Dim cntDo As Long<br>
　　Dim cntFail As Long<br>
　　Dim sTemp As String<br>
　　Dim rng As Range<br>
　　Dim i As Long<br>
　　<br>
　　Set WsErr = ActiveSheet <span style="color:#009900;">'リンクエラー検索</span><br>
　　On Error Resume Next<br>
　　<br>
　　<span style="color:#009900;">'対象ブックの取得と、「検索実行」時との確認</span><br>
　　sTemp = WsErr.Range(NmTargetBook).Value<br>
　　sTemp = Mid(sTemp, InStrRev(sTemp, &quot;\&quot;) + 1)<br>
　　Set wb = Workbooks(sTemp)<br>
　　If Err Then<br>
　　　　MsgBox &quot;対象ブックが開かれていません。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;「検索開始」実行後に行ってください。&quot;<br>
　　　　Exit Sub<br>
　　End If<br>
　　If WsErr.Range(NmTargetBook).Value &lt;&gt; wb.FullName Then<br>
　　　　MsgBox &quot;対象ブックの保存パスが変更されています。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;「検索開始」実行後に行ってください。&quot;<br>
　　　　Exit Sub<br>
　　End If<br>
　　<br>
　　<span style="color:#009900;">'実行可否の確認</span><br>
　　If MsgBox(&quot;「削除」で「する」が選択されている、他ブックへのリンクを削除します。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;元に戻すことはできません。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;万一の場合は、実行後に「保存しない」で対応してください。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;実行してよろしいですか。&quot;, vbYesNo, &quot;確認&quot;) = vbNo Then<br>
　　　　Exit Sub<br>
　　End If<br>
　　<br>
　　<span style="color:#009900;">'削除処理</span><br>
　　CntDel = 0: cntDo = 0: cntFail = 0<br>
　　With WsErr<br>
　　　　cntDo = WorksheetFunction.CountIf(.Columns(Col.削除), Cnsする)<br>
　　　　For i = StartErrRow To .Cells(.Rows.Count, Col.種別).End(xlUp).Row<br>
　　　　　　If .Cells(i, Col.削除) = Cnsする Then<br>
　　　　　　　　sTemp = .Cells(i, Col.場所)<br>
　　　　　　　　Select Case .Cells(i, Col.種別)<br>
　　　　　　　　　　Case Cns数式 <span style="color:#009900;">'数式</span><br>
　　　　　　　　　　　　Set rng = AddressToRange(wb, sTemp, i)<br>
　　　　　　　　　　　　rng.ClearContents<br>
　　　　　　　　　　　　Call setProcessCount(.Cells(i, Col.削除), cntFail, CntDel)<br>
　　　　　　　　　　Case Cns名前定義 <span style="color:#009900;">'名前定義</span><br>
　　　　　　　　　　　　wb.Names(sTemp).Delete<br>
　　　　　　　　　　　　Call setProcessCount(.Cells(i, Col.削除), cntFail, CntDel)<br>
　　　　　　　　　　Case Cns条件書式 <span style="color:#009900;">'条件付き書式</span><br>
　　　　　　　　　　　　Set rng = AddressToRange(wb, sTemp, i)<br>
　　　　　　　　　　　　rng.FormatConditions.Delete<br>
　　　　　　　　　　　　Call setProcessCount(.Cells(i, Col.削除), cntFail, CntDel)<br>
　　　　　　　　　　Case Cns入力規則 <span style="color:#009900;">'入力規則</span><br>
　　　　　　　　　　　　Set rng = AddressToRange(wb, sTemp, i)<br>
　　　　　　　　　　　　rng.Validation.Delete<br>
　　　　　　　　　　　　Call setProcessCount(.Cells(i, Col.削除), cntFail, CntDel)<br>
　　　　　　　　　　Case Cnsマクロ登録 <span style="color:#009900;">'オブジェクトの登録マクロ</span><br>
　　　　　　　　　　　　sTemp = Mid(sTemp, InStr(sTemp, &quot;:&quot;) + 1)<br>
　　　　　　　　　　　　Set rng = AddressToRange(wb, sTemp, i)<br>
　　　　　　　　　　　　sTemp = .Cells(i, Col.場所)<br>
　　　　　　　　　　　　sTemp = Left(sTemp, InStr(sTemp, &quot;:&quot;) - 1)<br>
　　　　　　　　　　　　rng.Worksheet.Shapes(sTemp).OnAction = &quot;&quot;<br>
　　　　　　　　　　　　Call setProcessCount(.Cells(i, Col.削除), cntFail, CntDel)<br>
　　　　　　　　End Select<br>
　　　　　　End If<br>
　　　　Next<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'終了メッセージ</span><br>
　　MsgBox &quot;削除完了しました。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　 &quot;削除する数=&quot; &amp; Format(cntDo, &quot;#,##0&quot;) &amp; vbLf &amp; _<br>
　　　　　 &quot;削除成功数=&quot; &amp; Format(CntDel, &quot;#,##0&quot;) &amp; vbLf &amp; _<br>
　　　　　 &quot;削除失敗数=&quot; &amp; Format(cntFail, &quot;#,##0&quot;), _<br>
　　　　　 vbOKOnly, &quot;結果表示&quot;<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'###　エラー削除のカウント　###</span><br>
Private Sub setProcessCount(ByRef rng As Range, ByRef cntFail As Long, ByRef CntDel As Long)<br>
　　If Err Then<br>
　　　　Err.Clear<br>
　　　　cntFail = cntFail + 1<br>
　　Else<br>
　　　　rng.Value = Cns削除済<br>
　　　　CntDel = CntDel + 1<br>
　　End If<br>
      End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
</div><p><br>
<strong>ユーザーフォーム</strong></p>
<div class="main-indent">フォームのオブジェクト名は、<br>
「frmSelectBook」<br><div class="br2"><br></div>
<img src="image74.jpg" tppabs="https://excel-ubara.com/excelvba5/image74.jpg" width="558" height="430" border="0" alt="マクロVBA リンクエラー ユーザーフォーム"><br><div class="br2"><br></div>
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Option Explicit<br><div class="br2"><br></div>
Private pWb As Workbook<br>
Private pRange As Range<br><div class="br2"><br></div>
<span style="color:#009900;">'標準モジュールから呼ばれるエントリーポイント</span><br>
Public Function DoModal(ByVal argRng As Range) As Workbook<br>
　　Set pRange = argRng<br>
　　If Workbooks.Count = 1 Then<br>
　　　　btnBrowse_Click<br>
　　Else<br>
　　　　Call FormInitialize<br>
　　　　Me.Show vbModal<br>
　　End If<br>
　　If Not pWb Is Nothing Then<br>
　　　　pRange = pWb.FullName<br>
　　End If<br>
　　Set DoModal = pWb<br>
　　Unload Me<br>
End Function<br><div class="br2"><br></div>
<span style="color:#009900;">'「Cancel」ボタン</span><br>
Private Sub btnClose_Click()<br>
　　Set pWb = Nothing<br>
　　Unload Me<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'「Browse」ボタン、ファイルを開くダイアログ</span><br>
Private Sub btnBrowse_Click()<br>
　　Dim FileName As Variant<br>
　　<br>
　　If pRange.Value = &quot;&quot; Then<br>
　　　　<span style="color:#009900;">'C2セルにファイルが指定されていない場合</span><br>
　　　　FileName = Application.GetOpenFilename(FileFilter:=&quot;Excelファイル,*.xls*&quot;)<br>
　　　　If FileName = False Then<br>
　　　　　　Exit Sub<br>
　　　　End If<br>
　　Else<br>
　　　　<span style="color:#009900;">'C2セルのファイルを初期指定する</span><br>
　　　　With Application.FileDialog(msoFileDialogOpen)<br>
　　　　　　.Filters.Clear<br>
　　　　　　.Filters.Add &quot;Excelファイル&quot;, &quot;*.xls*&quot;<br>
　　　　　　.InitialFileName = pRange.Value<br>
　　　　　　.AllowMultiSelect = False<br>
　　　　　　If .Show = False Then<br>
　　　　　　　　Exit Sub<br>
　　　　　　End If<br>
　　　　　　FileName = .SelectedItems(1)<br>
　　　　End With<br>
　　End If<br>
　　<br>
　　<span style="color:#009900;">'ブックを開く</span><br>
　　On Error Resume Next<br>
　　Set pWb = Workbooks.Open(FileName:=FileName, UpdateLinks:=0)<br>
　　<span style="color:#009900;">'開くときにエラーがでる場合の対処</span><br>
　　If Err Then<br>
　　　　Err.Clear<br>
　　　　MsgBox &quot;指定のファイルはVBAで開けないエラーがあります。&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　　　　&quot;手動でファイルを開いて確認してください。&quot;<br>
　　End If<br>
　　Me.Hide<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'リストを選択して「OK」</span><br>
Private Sub btSelect_Click()<br>
　　If Me.lstBook.ListIndex &lt; 0 Then<br>
　　　　MsgBox &quot;ブックが選択されていません。&quot;<br>
　　　　Exit Sub<br>
　　End If<br>
　　Set pWb = Workbooks(Me.lstBook.Text)<br>
　　Me.Hide<br>
End Sub<br><div class="br2"><br></div>
<span style="color:#009900;">'フォームの初期設定</span><br>
Private Sub FormInitialize()<br>
　　<span style="color:#009900;">'リストボックスに開かれているブックの一覧を表示</span><br>
　　With Me.lstBook<br>
　　　　.Clear<br>
　　　　For Each pWb In Workbooks<br>
　　　　　　If Not pWb Is ThisWorkbook Then<br>
　　　　　　　　.AddItem pWb.Name<br>
　　　　　　End If<br>
　　　　Next<br>
　　End With<br>
      End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
</div><p><br>
先にも書きましたが、VBA内のコメントを頼りにコードを読み解いてください。<br><div class="br2"><br></div>
<strong>VBA内で使用している主なキーワード一覧</strong></p>
<div class="main-indent">掲載しているVBAコードから主なものを抽出しました。<br>
全てではなく、列挙定数、VBA定数、名前付き引数等は含んでいません。</div>
<div class="main-indent"><strong>ステートメント</strong></div>
<div class="main-indent">
<div class="main-indent">Declare<br>
Call<br>
Const<br>
Dim<br>
DoEvents<br>
Enum<br>
Exit<br>
For Next<br>
For Each Next<br>
Function<br>
If Then Else Endif<br>
Like<br>
Mod<br>
On Error GoTo<br>
On Error Resume Next<br>
Private<br>
Public<br>
Set<br>
Static<br>
Sub<br>
With End With</div>
</div>
<div class="main-indent"><br>
<strong>プロパティ（コレクション、オブジェクト)</strong></div>
<div class="main-indent">
<div class="main-indent">Application<br>
Borders<br>
Cells<br>
Columns<br>
CurrentRegion<br>
Err<br>
Font<br>
FormatCondition<br>
FormatConditions<br>
Interior<br>
Name<br>
Names<br>
Parent<br>
Range<br>
Rows<br>
Shape<br>
Shapes<br>
SpecialCells<br>
ThisWorkbook<br>
TopLeftCell<br>
Validation<br>
Workbook<br>
Workbooks<br>
Worksheet<br>
WorksheetFunction<br>
Worksheets</div>
</div>
<div class="main-indent"><br>
<strong>プロパティ（単一値の設定、取得）</strong></div>
<div class="main-indent">
<div class="main-indent">Address<br>
Bold<br>
Color<br>
Cursor<br>
Description<br>
Formula<br>
Formula1<br>
Formula2<br>
FullName<br>
HorizontalAlignment<br>
LineStyle<br>
Locked<br>
NumberFormatLocal<br>
OnAction<br>
Protect<br>
RefersTo<br>
Row<br>
StatusBar<br>
Unprotect<br>
Value<br>
WrapText</div>
</div>
<div class="main-indent"><br>
<strong>メソッド</strong></div>
<div class="main-indent">
<div class="main-indent">Activate<br>
Clear<br>
ClearContents<br>
Delete<br>
Select<br>
Union</div>
</div>
<div class="main-indent"><br>
<strong>関数</strong></div>
<div class="main-indent">
<div class="main-indent">CDate<br>
CountIf<br>
Dir<br>
Format<br>
IIf<br>
InStr<br>
InStrRev<br>
Left<br>
Len<br>
Mid<br>
MsgBox<br>
Now<br>
Right<br>
TypeName</div>
</div>
<div class="main-indent"><br>
本サイト内で何らかの解説をしていますので、<br>
不明なキーワードがあるときは、次のgoogleカスタム検索で検索してみてください。<br>
<script>
  (function() {
    var cx = 'partner-pub-6511020045004282:1071452572';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script><br>
<gcse:searchbox-only></gcse:searchbox-only></div><p><br>
掲載したマクロを組み込んだ完成版のダウンロードを用意しました。</p>
<div class="main-indent"><strong><font size="+1"><a href="../excel_download.html" tppabs="https://excel-ubara.com/excel_download.html">完成ファイルのダウンロード</a></font></strong>　・・・　xlsmとzipを用意してあります。</div><p><br>
<div class="br2"><br></div>
本マクロは作成後の実際の使用実績が乏しく（リンク切れファイルが多数用意できない）、<br>
かつ、VBAもかなり大きいので想定外のエラーが出る可能性もあります。<br>
また、本マクロで想定している、<br>
<strong>数式、名前定義、条件付き書式、入力規則、ボタン等の登録マクロ</strong><br>
これら以外に、外部（他のブック）リンクが存在する場合もありえます。<br>
このような状況に対するご意見は、<strong><a href="../query.html" tppabs="https://excel-ubara.com/query.html" target="_blank">「お問い合わせ」</a></strong>からお知らせいただければ可能な限り対応いたします。<div class="details">各種ソフト、ホームページに関するへの質問、問合せを受付けます。</div><br></p>

          
<HR>
<div class="ads1">
<center>
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- yama3 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="8239480723"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="6847508570"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</center>
</div>
          <section>
<br><A name="same"><h3>同じテーマ「<a href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</a>」の記事</h3><p>
<A href="EXCELVBA230.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA230.html">数独（ナンプレ）を解くVBAに挑戦№1</A><br>
<A href="EXCELVBA231.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA231.html">数独（ナンプレ）を解くアルゴリズムの要点とパフォーマンスの検証№1</A><br>
<A href="EXCELVBA248.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA248.html">ナンバーリンク(パズル)を解くVBAに挑戦№1</A><br>
<A href="EXCELVBA249.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA249.html">ナンバーリンクを解くVBAのパフォーマンス改善№1</A><br>
<A href="EXCELVBA260.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA260.html">オセロを作りながらマクロVBAを学ぼう</A><br>
<span class="strrev">他ブックへのリンクエラーを探し解除</span><br>
<A href="EXCELVBA266.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA266.html">Excelシートの複雑な計算式を解析するVBA</A><br>
<A href="EXCELVBA282.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA282.html">Excel将棋：マクロVBAの学習用(№1)</A><br>
<A href="EXCELVBA283.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA283.html">Excel囲碁：万波奈穂先生に捧ぐ</A><br>
<A href="EXCELVBA284.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA284.html">Excel囲碁：再起動後も続けて打てるように改造</A><br>
<A href="EXCELVBA285.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA285.html">エクセルVBAで15パズルを作ってみた</A><br></p>
</A>
          </section>
          <section id="new">
<br><h3><A name="new">新着記事<span class="newicon">NEW</span> </a>・・・<A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧を見る</A></h3><p><A href="../vba100/VBA100_100.html" tppabs="https://excel-ubara.com/vba100/VBA100_100.html">VBA100本ノック 100本目：WEBから100本ノックのリストを取得｜VBA練習問題</A>（3月3日）<br>
<A href="../vba100/VBA100_099.html" tppabs="https://excel-ubara.com/vba100/VBA100_099.html">VBA100本ノック 99本目：自動席替え（行列と前後左右が全て違うように）｜VBA練習問題</A>（3月2日）<br>
<A href="../vba100/VBA100_098.html" tppabs="https://excel-ubara.com/vba100/VBA100_098.html">VBA100本ノック 98本目：席替えルールが守られているか確認｜VBA練習問題</A>（3月1日）<br>
<A href="../vba100/VBA100_097.html" tppabs="https://excel-ubara.com/vba100/VBA100_097.html">VBA100本ノック 97本目：Accessデータを取得（グループ集計）｜VBA練習問題</A>（2月27日）<br>
<A href="../vba100/VBA100_096.html" tppabs="https://excel-ubara.com/vba100/VBA100_096.html">VBA100本ノック 96本目：Accessデータを取得（マスタ結合&amp;抽出）｜VBA練習問題</A>（2月26日）<br>
<A href="../vba100/VBA100_095.html" tppabs="https://excel-ubara.com/vba100/VBA100_095.html">VBA100本ノック 95本目：図形のテキストを検索するフォーム作成｜VBA練習問題</A>（2月24日）<br>
<A href="../vba100/VBA100_094.html" tppabs="https://excel-ubara.com/vba100/VBA100_094.html">VBA100本ノック 94本目：表範囲からHTMLのtableタグを作成｜VBA練習問題</A>（2月23日）<br>
<A href="../vba100/VBA100_093.html" tppabs="https://excel-ubara.com/vba100/VBA100_093.html">VBA100本ノック 93本目：複数ブックを連結して再分割｜VBA練習問題</A>（2月22日）<br>
<A href="../vba100/VBA100_092.html" tppabs="https://excel-ubara.com/vba100/VBA100_092.html">VBA100本ノック 92本目：セルの色を16進で返す関数｜VBA練習問題</A>（2月20日）<br>
<A href="../vba100/VBA100_091.html" tppabs="https://excel-ubara.com/vba100/VBA100_091.html">VBA100本ノック 91本目：時間計算（残業時間の月間合計）｜VBA練習問題</A>（2月19日）<br></p>

          </section>
          <section id="rank">
<br><h3><A name="rank">アクセスランキング </a>・・・ <A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">ランキング一覧を見る</A></h3><p>1.<A href="../excelvba1/EXCELVBA318.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA318.html">最終行の取得（End,Rows.Count）｜VBA入門</A><br>2.<A href="../excelvba1/EXCELVBA311.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA311.html">RangeとCellsの使い方｜VBA入門</A><br>3.<A href="../excelvba1/EXCELVBA312.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA312.html">変数宣言のDimとデータ型｜VBA入門</A><br>4.<A href="../excelvba1/EXCELVBA301.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA301.html">マクロって何？VBAって何？｜VBA入門</A><br>5.<A href="../excelvba1/EXCELVBA310.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA310.html">Range以外の指定方法（Cells,Rows,Columns）｜VBA入門</A><br>6.<A href="../excelvba1/EXCELVBA341.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA341.html">セルのコピー&amp;値の貼り付け（PasteSpecial）｜VBA入門</A><br>7.<A href="../excelvba1/EXCELVBA316.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA316.html">繰り返し処理（For Next)｜VBA入門</A><br>8.<A href="../excelvba1/EXCELVBA308.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA308.html">セルに文字を入れるとは（Range,Value）｜VBA入門</A><br>9.<A href="../excelvba1/EXCELVBA304.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA304.html">マクロはどこに書くの（VBEの起動）｜VBA入門</A><br>10.<A href="../excelvba1/EXCELVBA306.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA306.html">とにかく書いてみよう（Sub,End Sub）｜VBA入門</A><br></p>
          </section>
<br>
          <HR>
          <div><ul>
<li><a href="../index.htm" tppabs="https://excel-ubara.com/">ホーム</a></li>
<li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編</a></li>
<li><a href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</a></li>
<li><span class="strrev2"><strong>他ブックへのリンクエラーを探し解除するマクロ</strong></span></li>
</ul></div><br>
          <strong>このサイトがお役に立ちましたら「シェア」「Bookmark」をお願いいたします。</strong><br>
          <div class="ninja_onebutton">
            <script type="text/javascript">
              //<![CDATA[
              (function(d){
              if(typeof(window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2)=='undefined'){
                  document.write("<sc"+"ript type='text\/javascript' src='\/\/omt.shinobi.jp\/b\/dbb4ddbe09aac6bed0b2564afb27c6f2'><\/sc"+"ript>");
              }else{
                  window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2.ONETAGButton_Load();}
              })(document);
              //]]>
            </script><span class="ninja_onebutton_hidden" style="display:none;"></span><span style="display:none;" class="ninja_onebutton_hidden"></span>
          </div>
<br>
          <script>
            (function() {
              var cx = 'partner-pub-6511020045004282:1071452572';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:searchbox-only></gcse:searchbox-only>
<br>
          記述には細心の注意をしたつもりですが、<br>
          間違いやご指摘がありましたら、<A href="../query.html" tppabs="https://excel-ubara.com/query.html" target="_blank">「お問い合わせ」</A>からお知らせいただけると幸いです。<br>
          掲載のVBAコードは動作を保証するものではなく、あくまでVBA学習のサンプルとして掲載しています。<br>
          掲載のVBAコードは自己責任でご使用ください。万一データ破損等の損害が発生しても責任は負いません。
        </section>
      </div> <!--/#main-->

      <div id="sub">
        <nav>
          <h2>エクセル全般</h2>
          <ul class="submenu">
            <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
            <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
            <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
            <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
            <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
            <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
          </ul>
          <h2>マクロVBA入門編</h2>
          <ul class="submenu">
            <li><A href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</A></li>
            <li><A href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</A></li>
            <li><A href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</A></li>
            <li><A href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</A></li>
            <li><A href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</A></li>
            <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
            <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
          </ul>
          <h2>マクロVBA応用編</h2>
          <ul class="submenu">
            <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
            <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
            <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
            <li><A href="../excelvba4/index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
            <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
            <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
          </ul>
          <h2>その他（Excel以外）</h2>
          <ul class="submenu">
            <li><a href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">SQL入門</a></li>
            <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">スプレッドシート入門</A></li>
            <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">GAS入門</A></li>
            <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">Python入門</A></li>
          </ul>
          <h2>サイト案内</h2>
          <ul class="submenu">
            <li><A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧</A></li>
            <li><A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">アクセスランキング</A></li>
            <li><A href="../sitemap.html" tppabs="https://excel-ubara.com/sitemap.html">サイトマップ</A></li>
            <li><a href="../business/index.htm" tppabs="https://excel-ubara.com/business/">事業案内</a></li>
            <li><A href="../query.html" tppabs="https://excel-ubara.com/query.html">お問い合わせ&nbsp&nbsp</A></li>
          </ul>
        </nav>

        <section>
          
<HR>
<div class="ads1">
<CENTER>
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- yama22 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="9686142173"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</CENTER>
</div>
          

          

          <HR>
          <div><ul>
<li><a href="../index.htm" tppabs="https://excel-ubara.com/">ホーム</a></li>
<li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編</a></li>
<li><a href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</a></li>
<li><span class="strrev2"><strong>他ブックへのリンクエラーを探し解除するマクロ</strong></span></li>
</ul></div><br>
          このサイトがお役に立ちましたら「シェア」「Bookmark」をお願いいたします。<br>

          <div class="ninja_onebutton">
            <script type="text/javascript">
              //<![CDATA[
              (function(d){
              if(typeof(window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2)=='undefined'){
                  document.write("<sc"+"ript type='text\/javascript' src='\/\/omt.shinobi.jp\/b\/dbb4ddbe09aac6bed0b2564afb27c6f2'><\/sc"+"ript>");
              }else{
                  window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2.ONETAGButton_Load();}
              })(document);
              //]]>
            </script><span class="ninja_onebutton_hidden" style="display:none;"></span><span style="display:none;" class="ninja_onebutton_hidden"></span>
          </div>
          本文下部へ<br>
          <div class="main-indent">
            <strong><A href="#same">同じテーマの記事</A></strong><br>
            <strong><A href="#new">新着記事</A></strong><br>
            <strong><A href="#rank">アクセスランク</A></strong><br>
          </div>
          <div class="ads2">
            <script>
              (function() {
                var cx = 'partner-pub-6511020045004282:1071452572';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:searchbox-only></gcse:searchbox-only>
          </div>
<br><nav><h2>おすすめ関連記事</h2><ul class="submenu"><li><a href="EXCELVBA265.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265.html" target="_blank">他ブックへのリンクエラーを探し解除する</a></li><li><a href="EXCELVBA265_3.html" tppabs="https://excel-ubara.com/excelvba5/EXCELVBA265_3.html" target="_blank">他ブックへのリンクエラーを探し解除するマクロ<br>(変更前)</a></li><li><a href="../query.html" tppabs="https://excel-ubara.com/query.html" target="_blank">「お問い合わせ」</a></li></ul></nav>
          

          
<HR>
<div class="ads2">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 新サイド下 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="1968934163"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div><br>
        </section>
      </div> <!--/#sub-->
    </div> <!--/#contents-in-->
  </div> <!--/#contents-->

  <footer>
    <div id="footermenu" class="inner">
      <ul>
        <li><a href="../excel_index.html" tppabs="https://excel-ubara.com/excel_index.html">■Excel全般</a></li>
        <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
        <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
        <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
        <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
        <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
        <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
      </ul>
      <ul>
        <li><a href="../excel_vba1.html" tppabs="https://excel-ubara.com/excel_vba1.html">■マクロVBA入門編</a></li>
        <li><A href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</A></li>
        <li><A href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</A></li>
        <li><A href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</A></li>
        <li><A href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</A></li>
        <li><A href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</A></li>
        <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
        <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
      </ul>
      <ul>
        <li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">■マクロVBA応用編</a></li>
        <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
        <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
        <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
        <li><A href="../excelvba4/index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
        <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
        <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
      </ul>
      <ul>
        <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">■Python入門</A></li>
        <li><a href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">■SQL入門</a></li>
        <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">■スプレッドシート入門</A></li>
        <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">■Google Apps Script入門</A></li>
        <li><A href="../excel_course/index.htm" tppabs="https://excel-ubara.com/excel_course/">■エクセル講座セミナー</A></li>
        <li><A href="../business/index.htm" tppabs="https://excel-ubara.com/business/">■事業案内</A></li>
        <li><A href="../business/sitemap.html" tppabs="https://excel-ubara.com/business/sitemap.html">■サイトマップ</A></li>
      </ul>
    </div> <!--/footermenu-->
    <div id="copyright">
      <small>エクセルの神髄 ｜ Copyright&copy; 2010 <A href="../index.htm" tppabs="https://excel-ubara.com/">鵜原パソコンソフト研究所</A></small>
    </div>
  </footer>

  <p class="nav-fix-pos-pagetop"><a href="#">↑</a></p>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37178461-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
<!--License20150309TPg-->
</body>
</html>
