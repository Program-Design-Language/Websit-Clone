<!DOCTYPE html>
<html lang="ja">
<head>
  <script data-ad-client="ca-pub-6511020045004282" async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6511020045004282",
      enable_page_level_ads: true
    });
  </script>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>PowerQueryの強力な機能をVBAから利用する方法｜VBA技術解説</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Excel2016より標準搭載されたPowerQueryはとても強力な機能ですが、使える環境が限られるので、頻繁に使われだすのはこれからになると思います。PowerQueryが広く使われだすと、色々な使い方が出てくると思います。ここでは、PowerQueryの優れた機能をVBAから利用する場合の手順を説明したものです。">
  <meta name="keywords" content="PowerQuery,VBA,強力な機能をから利用する方法,技術解説,エクセル,Excel,マクロ">
  <link rel="icon" type="image/x-icon" href="../images/favicon_excel.png">
  <link rel="stylesheet" href="../css/style.css-20210304.css" tppabs="https://excel-ubara.com/css/style.css?20210304">
  <link rel="stylesheet" href="../css/slide.css-20210304.css" tppabs="https://excel-ubara.com/css/slide.css?20210304">
  <link rel="canonical" href="https://excel-ubara.com/excelvba4/EXCEL_VBA_408.html" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="PowerQueryの強力な機能をVBAから利用する方法｜VBA技術解説" />
  <meta property="og:description" content="Excel2016より標準搭載されたPowerQueryはとても強力な機能ですが、使える環境が限られるので、頻繁に使われだすのはこれからになると思います。PowerQueryが広く使われだすと、色々な使い方が出てくると思います。ここでは、PowerQueryの優れた機能をVBAから利用する場合の手順を説明したものです。" />
  <meta property="og:image" content="https://excel-ubara.com/excelvba4/image203.jpg" />
  <meta property="og:url" content="https://excel-ubara.com/excelvba4/EXCEL_VBA_408.html" />
  <meta property="og:site_name" content="エクセルの神髄" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="PowerQueryの強力な機能をVBAから利用する方法｜VBA技術解説" />
  <meta name="twitter:description" content="Excel2016より標準搭載されたPowerQueryはとても強力な機能ですが、使える環境が限られるので、頻繁に使われだすのはこれからになると思います。PowerQueryが広く使われだすと、色々な使い方が出てくると思います。ここでは、PowerQueryの優れた機能をVBAから利用する場合の手順を説明したものです。" />
  <meta name="twitter:image" content="https://excel-ubara.com/excelvba4/image203.jpg" />
  <meta name="twitter:site" content="@yamaoka_ss" />
  <script src="../../code.jquery.com/jquery-3.3.1.min.js" tppabs="https://code.jquery.com/jquery-3.3.1.min.js" async></script>
  <script type="text/javascript" src="../js/fix.js" tppabs="https://excel-ubara.com/js/fix.js" async></script>
  <script type="text/javascript" src="../js/fixmenu_pagetop.js-20210304" tppabs="https://excel-ubara.com/js/fixmenu_pagetop.js?20210304" async></script>
  <script type="text/javascript" src="../js/CopyDisp.js-20210304" tppabs="https://excel-ubara.com/js/CopyDisp.js?20210304" async></script>
</head>

<body class="c2">
  <header>
    <div class="inner">
      <p id="logo"><a href="../index.htm" tppabs="https://excel-ubara.com/"><img src="../images/logo.png" tppabs="https://excel-ubara.com/images/logo.png" alt="エクセルの神髄"></a></p>
      <div id="contact">
        <h1>VBA技術解説<br>PowerQueryの強力な機能をVBAから利用する方法</h1>ExcelマクロVBAの問題点と解決策、VBAの技術的解説
      </div>
    </div>
  </header>

  <!--PC用（801px以上端末）メニュー-->
  <nav id="dropmenu">
    <ul class="inner">
      <li><a href="../excel_index.html" tppabs="https://excel-ubara.com/excel_index.html">Excel全般<span>Excel</span></a>
        <ul>
          <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
          <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
          <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
          <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
          <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
          <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
        </ul>
      </li>
      <li><a href="../excel_vba1.html" tppabs="https://excel-ubara.com/excel_vba1.html">マクロVBA入門編<span>VBA Beginner</span></a>
        <ul>
          <li><a href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</a></li>
          <li><a href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</a></li>
          <li><a href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</a></li>
          <li><a href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</a></li>
          <li><a href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</a></li>
          <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
          <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
        </ul>
      </li>
      <li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編<span>VBA Advanced</span></a>
        <ul>
          <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
          <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
          <li><A href="../excelvba5/index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
          <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
          <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
          <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
        </ul>
      </li>
      <li><a href="../excel_other.html" tppabs="https://excel-ubara.com/excel_other.html">その他（Excel以外）<span>Other than Excel</span></a>
        <ul>
          <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">Python入門</A></li>
          <li><A href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">SQL入門</A></li>
          <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">スプレッドシート入門</A></li>
          <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">GAS入門</A></li>
        </ul>
      </li>
      <li><a href="../siteguide.html" tppabs="https://excel-ubara.com/siteguide.html">サイト案内<span>site map</span></a>
        <ul>
          <li><A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧</A></li>
          <li><A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">アクセスランキング</A></li>
          <li><A href="../sitemap.html" tppabs="https://excel-ubara.com/sitemap.html">サイトマップ&nbsp;&nbsp;</A></li>
          <li><a href="../business/index.htm" tppabs="https://excel-ubara.com/business/">旧トップページ&nbsp;&nbsp;</a></li>
          <li><A href="../query.html" tppabs="https://excel-ubara.com/query.html">お問い合わせ&nbsp;&nbsp;</A></li>
        </ul>
      </li>
    </ul>
  </nav>

  <div id="pan"><ul itemscope itemtype="http://schema.org/BreadcrumbList">
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="../index.htm" tppabs="https://excel-ubara.com/">
<span itemprop="name">ホーム</span></a>
<meta itemprop="position" content="1" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">
<span itemprop="name">マクロVBA応用編</span></a>
<meta itemprop="position" content="2" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">
<span itemprop="name">マクロVBA技術解説</span></a>
<meta itemprop="position" content="3" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="EXCEL_VBA_408.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_408.html">
<span itemprop="name">PowerQueryの強力な機能をVBAから利用する方法</span></a>
<meta itemprop="position" content="4" />
</li>
</ul></div>
  <div class="ads1">
    <center>
    <script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- yama21 -->
    <ins class="adsbygoogle"
        style="display:block"
        data-ad-client="ca-pub-6511020045004282"
        data-ad-slot="1104944574"
        data-ad-format="auto"
        data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    </center>
  </div>

  <div id="contents" class="inner">
    <div id="contents-in">
      <div id="main">
        <section>
          <span style="line-height:20px;float:right" align="right">最終更新日：2021-03-03</span>
<h2 align="center">PowerQueryの強力な機能をVBAから利用する方法</h2><br><a href="image189.jpg" tppabs="https://excel-ubara.com/excelvba4/image189.jpg" target="_blank"><img src="image189.jpg" tppabs="https://excel-ubara.com/excelvba4/image189.jpg" width="360" height="355" style="float:right;margin: 0px 10px 10px 10px;" border="0" alt="マクロ VBA PowerQuery"></a><p>Excel2016より標準搭載されたPowerQueryはとても強力な機能ですが、<br>使える環境が限られるので、頻繁に使われだすのはこれからになると思います。<br><div class="br2"><br></div>PowerQueryが広く使われだすと、色々な使い方が出てくると思います。<br>
ここでは、PowerQueryの優れた機能をVBAから利用する場合の手順を説明したものです。<br>
PowerQueryの活用方法の一つとして、ここに記載しておきます。<br><div class="br2"><br></div>
始めてVBAで使う機能の場合、<br>
・手動での操作を確認<br>
・「マクロの記録」でVBAを確認<br>
・VBAの要所の文法を調べる<br>
・VBAを書いてみる<br>
このような順で進めると良いでしょう。<br>
以下、この順に説明します。<br><div class="br2"><br></div></p>
<h3>説明に使用するデータ</h3>
<div class="main-indent">以下では、<br>
フォルダ内の複数ファイルのデータを1シートに集める場合を例に説明しています。<br><div class="br2"><br></div>
フォルダには、<br>
201805.xlsx<br>
201806.xlsx<br>
・・・<br>
一つのExcelファイルには、<br>
「Sheet1」に以下のデータが月別に入っています。<br><div class="br2"><br></div>
<img src="image200.jpg" tppabs="https://excel-ubara.com/excelvba4/image200.jpg" width="455" height="213" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
フォルダ内の月別のExcelファイル（201805.xlsx、201806.xlsx、…）の、<br>
「Sheet1」のデータを一つのシートに集めます。<br><div class="br2"><br></div>
本件の内容であれば、むしろマクロVBAで普通に記述したほうが簡単でしょう。<br>
あくまで、PowerQueryの活用方法の説明としての題材となります。<br><div class="br2"><br></div>
</div>
<div class="main-indent">
<div class="ads1">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="6991829975"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div><h3>PowerQueryの操作方法</h3>
<div class="main-indent">※以下、参考画面はExcel2019になります。<br><div class="br2"><br></div>
<strong>「データ」タブ→「データの取得」→「ファイルから」→「フォルダーから」</strong><br><div class="br2"><br></div>
<img src="image190.jpg" tppabs="https://excel-ubara.com/excelvba4/image190.jpg" width="749" height="234" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
フォルダーを指定して「OK」<br><div class="br2"><br></div>
<img src="image203.jpg" tppabs="https://excel-ubara.com/excelvba4/image203.jpg" width="750" height="500" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
「結合」のドロップダウンをクリック<br><div class="br2"><br></div>
<img src="image205.jpg" tppabs="https://excel-ubara.com/excelvba4/image205.jpg" width="443" height="119" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
「統合および読み込み」をクリック<br>
列の削除等の編集をする場合は、「統合および編集」をすることになりますが、<br>
今回は、あくまでVBAの参考なので、単純な操作にしています。<br><div class="br2"><br></div><div class="br2"><br></div>
<img src="image204.jpg" tppabs="https://excel-ubara.com/excelvba4/image204.jpg" width="750" height="500" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
ここでは「Sheet1」のデータを集めるので、「Sheet1」をクリック<br><div class="br2"><br></div>
<img src="image206.jpg" tppabs="https://excel-ubara.com/excelvba4/image206.jpg" width="750" height="500" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
データの先頭がプレビューされますので、目的のデータであるかを確認して「OK」<br><div class="br2"><br></div>
<img src="image207.jpg" tppabs="https://excel-ubara.com/excelvba4/image207.jpg" width="749" height="461" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
シートが挿入されて、集められたデータがテーブルとして出力されました。<br>
数ファイルであれば、本当に一瞬でデータが結合されます。<br><div class="br2"><br></div>
とても便利で強力な機能のPowerQueryです。<br>
ただし、毎回この操作をしていたのでは、、、<br>
もちろん、一度取り込んでしまえば、簡単に更新はできます。<br><div class="br2"><br></div>
<img src="image209.jpg" tppabs="https://excel-ubara.com/excelvba4/image209.jpg" width="469" height="286" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
しかし、他のPCへ展開する等の時に、<br>
フォルダのパスが変更になる時はどうしたら、、、<br>
もちろん、そのような対応方法もPowerQueryにはあるにはありますが、<br>
ここでは、VBAとしてこの機能を使えるようにしてしまえという事になります。<br><div class="br2"><br></div>
</div>
<div class="main-indent">
<div class="ads1">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="7467492230"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div><h3><strong>PowerQueryのマクロの記録</strong></h3>
<div class="main-indent">「マクロの記録」で上記の操作を行ってください。<br><div class="br2"><br></div>
PowerQueryを作成する場合は、あれこれと試行錯誤することが多いと思います。<br>
一度では完成しない場合も多いと思いますので、<br>
一度完成させた後で、それをお手本に操作すると良いでしょう。<br>
以下は、マクロの記録で作成されたVBAコードになります。<br><div class="br2"><br></div>
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Sub Macro1()<br>
<span style="color:#009900;">'</span><br>
<span style="color:#009900;">' Macro1 Macro</span><br>
<span style="color:#009900;">'</span><br><div class="br2"><br></div>
<span style="color:#009900;">'</span><br>
      　　ActiveWorkbook.Queries.Add Name:=&quot;サンプル ファイルの変換&quot;, Formula:=
      _<br>
　　　　&quot;let&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　ソース = Excel.Workbook(パラメーター1, null, true),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　Sheet1_Sheet = ソース{[Item=&quot;&quot;Sheet1&quot;&quot;,Kind=&quot;&quot;Sheet&quot;&quot;]}[Data],&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　昇格されたヘッダー数 = Table.PromoteHeaders(Sheet1_Sheet, [PromoteAllScalars=true])&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;in&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　昇格されたヘッダー数&quot;<br>
　　ActiveWorkbook.Queries.Add Name:=&quot;パラメーター1&quot;, Formula:= _<br>
　　　　&quot;#&quot;&quot;サンプル ファイル&quot;&quot; meta [IsParameterQuery=true, BinaryIdentifier=#&quot;&quot;サンプル ファイル&quot;&quot;, Type=&quot;&quot;Binary&quot;&quot;, IsParameterQueryRequired=true]&quot;<br>
　　ActiveWorkbook.Queries.Add Name:=&quot;サンプル ファイル&quot;, Formula:= _<br>
      　　　　&quot;let&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp;
      &quot;　　ソース = Folder.Files(&quot;&quot;D:\Excel\マクロVBA入門\月別データ&quot;&quot;),&quot;
      &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　ナビゲーション1 =
      ソース{0}[Content]&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp;
      &quot;in&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　ナビゲーション1&quot;<br>
　　ActiveWorkbook.Queries.Add Name:=&quot;ファイルの変換&quot;, Formula:= _<br>
　　　　&quot;let&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　ソース = (パラメーター1) =&gt; let&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　　　ソース = Excel.Workbook(パラメーター1, null, true),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　　　Sheet1_Sheet = ソース{[Item=&quot;&quot;Sheet1&quot;&quot;,Kind=&quot;&quot;Sheet&quot;&quot;]}[Data],&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　　　昇格されたヘッダー数 = Table.PromoteHeaders(Sheet1_Sheet, [PromoteAllScalars=true])&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　in&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　　　昇格されたヘッダー数&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;in&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　ソース&quot;<br>
　　ActiveWorkbook.Queries.Add Name:=&quot;月別データ&quot;, Formula:= _<br>
      　　　　&quot;let&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp;
      &quot;　　ソース = Folder.Files(&quot;&quot;D:\Excel\マクロVBA入門\月別データ&quot;&quot;),&quot;
      &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　#&quot;&quot;フィルター選択された非表示の
      File1&quot;&quot; = Table.SelectRows(ソース, each [Attributes]?[Hidden]? &lt;&gt;
      true),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　カスタム関数の呼び出し1
      = Table.AddColumn(#&quot;&quot;フィルター選択された非表示の File1&quot;&quot;, &quot;&quot;ファイルの変換&quot;&quot;,
      each ファイルの変換([Content])),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp;
      Chr(10) &amp; &quot;　　#&quot;&quot;名前が変更された列 1&quot;&quot; = Table.RenameColumns(カスタム関数の呼び出し1,
      {&quot;&quot;Name&quot;&quot;, &quot;&quot;Source.Name&quot;&quot;}),&quot;
      &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　削除された他の列1
      = Table.Select&quot; &amp; _<br>
　　　　&quot;Columns(#&quot;&quot;名前が変更された列 1&quot;&quot;, {&quot;&quot;Source.Name&quot;&quot;, &quot;&quot;ファイルの変換&quot;&quot;}),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　展開されたテーブル列1 = Table.ExpandTableColumn(削除された他の列1, &quot;&quot;ファイルの変換&quot;&quot;, Table.ColumnNames(ファイルの変換(#&quot;&quot;サンプル ファイル&quot;&quot;))),&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　変更された型 = Table.TransformColumnTypes(展開されたテーブル列1,{{&quot;&quot;Source.Name&quot;&quot;, type text}, {&quot;&quot;日付&quot;&quot;, type date}, {&quot;&quot;部署&quot;&quot;, type text}, {&quot;&quot;担当&quot;&quot;, type text}, {&quot;&quot;売上数&quot;&quot;, Int64.Type}, {&quot;&quot;売上金額&quot;&quot;, Int64.Type}})&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;i&quot; &amp; _<br>
　　　　&quot;n&quot; &amp; Chr(13) &amp; &quot;&quot; &amp; Chr(10) &amp; &quot;　　変更された型&quot; &amp; _<br>
　　　　&quot;&quot;<br>
      　　Workbooks(&quot;Book1.xlsm&quot;).Connections.Add2 &quot;クエリ - サンプル ファイルの変換&quot;, _<br>
　　　　&quot;ブック内の 'サンプル ファイルの変換' クエリへの接続です。&quot;, _<br>
　　　　&quot;OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=&quot;&quot;サンプル ファイルの変換&quot;&quot;;Extended Properties=&quot;&quot;&quot;&quot;&quot; _<br>
　　　　, &quot;SELECT * FROM [サンプル ファイルの変換]&quot;, 2<br>
      　　Workbooks(&quot;Book1.xlsm&quot;).Connections.Add2 &quot;クエリ - パラメーター1&quot;,
      _<br>
　　　　&quot;ブック内の 'パラメーター1' クエリへの接続です。&quot;, _<br>
　　　　&quot;OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=パラメーター1;Extended Properties=&quot;&quot;&quot;&quot;&quot; _<br>
　　　　, &quot;SELECT * FROM [パラメーター1]&quot;, 2<br>
      　　Workbooks(&quot;Book1.xlsm&quot;).Connections.Add2 &quot;クエリ - サンプル ファイル&quot;,
      _<br>
　　　　&quot;ブック内の 'サンプル ファイル' クエリへの接続です。&quot;, _<br>
　　　　&quot;OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=&quot;&quot;サンプル ファイル&quot;&quot;;Extended Properties=&quot;&quot;&quot;&quot;&quot; _<br>
　　　　, &quot;SELECT * FROM [サンプル ファイル]&quot;, 2<br>
      　　Workbooks(&quot;Book1.xlsm&quot;).Connections.Add2 &quot;クエリ - ファイルの変換&quot;,
      _<br>
　　　　&quot;ブック内の 'ファイルの変換' クエリへの接続です。&quot;, _<br>
　　　　&quot;OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=ファイルの変換;Extended Properties=&quot;&quot;&quot;&quot;&quot; _<br>
　　　　, &quot;SELECT * FROM [ファイルの変換]&quot;, 2<br>
　　ActiveWorkbook.Worksheets.Add<br>
      　　With ActiveSheet.ListObjects.Add(SourceType:=0, Source:= _<br>
　　　　&quot;OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=月別データ;Extended Properties=&quot;&quot;&quot;&quot;&quot; _<br>
　　　　, Destination:=Range(&quot;$A$1&quot;)).QueryTable<br>
　　　　.CommandType = xlCmdSql<br>
　　　　.CommandText = Array(&quot;SELECT * FROM [月別データ]&quot;)<br>
　　　　.RowNumbers = False<br>
　　　　.FillAdjacentFormulas = False<br>
　　　　.PreserveFormatting = True<br>
　　　　.RefreshOnFileOpen = False<br>
　　　　.BackgroundQuery = True<br>
　　　　.RefreshStyle = xlInsertDeleteCells<br>
　　　　.SavePassword = False<br>
　　　　.SaveData = True<br>
　　　　.AdjustColumnWidth = True<br>
　　　　.RefreshPeriod = 0<br>
　　　　.PreserveColumnInfo = True<br>
　　　　.ListObject.DisplayName = &quot;月別データ&quot;<br>
　　　　.Refresh BackgroundQuery:=False<br>
　　End With<br>
End Sub</td>
    </tr>
  </tbody>
</table></code></div>
※HTMLとして掲載する都合で、半角スペース2個を、全角スペース1個にしています。<br><div class="br2"><br></div>
いきなりこのVBAコードをみると、何が何だか分からなくなります。<br>
まずは、簡単にメソッドの構文を確認してから、このコードを見やすく整形して使いまわせるようにしていきます。<br><div class="br2"><br></div>
</div>
<h3>PowerQueryのVBA文法</h3>
<div class="main-indent"> 上記のマクロの記録で作成されたVBAコードを見ていくと、<br>
その中で、実際に動作が行われている命令、つまりメソッドは、<br>
ActiveWorkbook.Queries.Add<br>
Workbooks(&quot;Book1.xlsm&quot;).Connections.Add2<br>
ActiveSheet.ListObjects.Add<br>
この3つがあることが分かります。<br>
そこで、これらを調べてみましょう。<br><div class="br2"><br></div>
<strong>Workbook.Queries.Add</strong></div>
<div class="main-indent">
<div class="main-indent">新しいWorkbookQueryオブジェクトをブックのQueriesコレクションに追加します。<br>
Workbook.Queries.Add(Name, Formula, Description)<br><div class="br2"><br></div>
<div class="table-scroll"><table border="1" cellpadding="5">
<tbody>
  <tr>
    <td>名前</td>
    <td>必須/オプション</td>
    <td>データ型</td>
    <td>説明</td>
  </tr>
  <tr>
    <td>Name</td>
    <td>必須</td>
    <td>String</td>
    <td>クエリの名前。</td>
  </tr>
  <tr>
    <td>Formula</td>
    <td>必須</td>
    <td>String</td>
    <td>新しいクエリの Power Query M数式。</td>
  </tr>
  <tr>
    <td>Description</td>
    <td>省略可能</td>
    <td>Variant</td>
    <td>クエリの説明。</td>
  </tr>
</tbody>
</table></div><br>
戻り値は、WorkbookQuery<br><div class="br2"><br></div>
</div>
</div>
<div class="main-indent"><strong>Workbook.Connections.Add2</strong></div>
<div class="main-indent">
<div class="main-indent">ブックに新しい接続を追加します。<br>
Workbook.Add2(Name, Description, ConnectionString, CommandText, lcmdtype, createmodelconnection, importrelationships)<br><div class="br2"><br></div>
<div class="table-scroll"><table border="1" cellpadding="5">
  <tbody>
    <tr>
      <td>名前</td>
      <td>必須/オプション</td>
      <td>データ型</td>
      <td>説明</td>
    </tr>
    <tr>
      <td>名前</td>
      <td>必須</td>
      <td>String</td>
      <td>接続の名前を指定します。</td>
    </tr>
    <tr>
      <td>Description</td>
      <td>必須</td>
      <td>String</td>
      <td>接続の簡単な説明を指定します。</td>
    </tr>
    <tr>
      <td>ConnectionString</td>
      <td>必須</td>
      <td>バリアント型</td>
      <td>接続文字列を指定します。</td>
    </tr>
    <tr>
      <td>CommandText</td>
      <td>必須</td>
      <td>バリアント型</td>
      <td>接続を作成するコマンド テキストを指定します。</td>
    </tr>
    <tr>
      <td>lcmdtype</td>
      <td>Optional</td>
      <td>Variant</td>
      <td>コマンドの種類を指定します。</td>
    </tr>
    <tr>
      <td>createmodelconnection</td>
      <td>省略可能</td>
      <td>Boolean</td>
      <td>PowerPivot モデルへの接続を作成するかどうかを指定します。</td>
    </tr>
    <tr>
      <td>importrelationships</td>
      <td>省略可能</td>
      <td>Boolean</td>
      <td>既存のリレーションシップをインポートするかどうかを指定します。</td>
    </tr>
  </tbody>
</table></div><br>
戻り値は、WorkbookConnection<br><div class="br2"><br></div>
※MicrosoftのVBAリファレンスには、Addメソッドが出ています。</div>
<div class="main-indent">
<div class="main-indent">AddメソッドはExcel2013から非表示メンバとなり、代わってAdd2メソッドが追加されています。<br>
オブジェクトブラウザで違いを見てみると、<br><div class="br2"><br></div>
<img src="image195.jpg" tppabs="https://excel-ubara.com/excelvba4/image195.jpg" width="340" height="230" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
<img src="image196.jpg" tppabs="https://excel-ubara.com/excelvba4/image196.jpg" width="837" height="54" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
<img src="image197.jpg" tppabs="https://excel-ubara.com/excelvba4/image197.jpg" width="1163" height="55" border="0" alt="マクロ VBA PowerQuery"><br><div class="br2"><br></div>
引数が追加されています。<br>
つまり、上記の構文はAdd2メソッドになります。<br>
つまり、Docsの記載ミスと思われます。<br><div class="br2"><br></div>
</div>
</div>
</div>
<div class="main-indent"><strong>WorkSheet.ListObjects.Add</strong></div>
<div class="main-indent">
<div class="main-indent">新しいリスト オブジェクトを作成します。<br>
WorkSheet.追加(SourceType, Source, linksource, xllist thasheaders, Destination,
TableStyleName)<br><div class="br2"><br></div>
<div class="table-scroll"><table border="1" cellpadding="5">
<tbody>
  <tr>
    <td>名前</td>
    <td>必須 / オプション</td>
    <td>データ型</td>
    <td>説明</td>
  </tr>
  <tr>
    <td>SourceType</td>
    <td>省略可能</td>
    <td>XlListObjectSourceType</td>
    <td>クエリで使用されるソースの種類を指定します。<br>xlSrcExternal : 外部データ ソース (Microsoft SharePoint Foundation サイト)<br>
xlSrcModel :PowerPivot モデル<br>
xlSrcQuery :クエリ<br>
xlSrcRange : 範囲<br>
xlSrcXml : XML</td>
  </tr>
  <tr>
    <td>Source</td>
    <td>Optional</td>
    <td>Variant</td>
    <td>SourceType = xlsrcrangeデータソースを表す Range オブジェクトを指定します。<br>
      省略した場合、_ソース_は、リスト範囲検出コードによって返される範囲に既定で設定されます。<br>
      SourceType = xlsrcexternal: ソースへの接続を指定する文字列値の配列。次の要素が含まれています。<br>
0 - SharePoint サイトの URL<br>
1 - ListName<br>
2 - ViewGUID</td>
  </tr>
  <tr>
    <td>LinkSource</td>
    <td>省略可能</td>
    <td>Boolean</td>
    <td>外部データ ソースを ListObject オブジェクトにリンクするかどうかを指定します。<br>
      _SourceType_がxlsrcexternalの場合、既定値はTrueになります。<br>
      _SourceType_がxlsrcrangeの場合は無効です。<br>
      省略した場合は、エラーが返されます。</td>
  </tr>
  <tr>
    <td>XlListObjectHasHeaders</td>
    <td>Optional</td>
    <td>Variant</td>
    <td>インポートされているデータに列ラベルがあるかどうかを示すxlyes noguess定数を指定します。<br>
      _ソース_にヘッダーが含まれていない場合、Excel は自動的にヘッダーを生成します。<br>
      既定値はxlguessです。</td>
  </tr>
  <tr>
    <td>Destination</td>
    <td>省略可能</td>
    <td>Variant</td>
    <td>新しいリストオブジェクトの左上隅のリンク先として単一セル参照を指定するRangeオブジェクト。<br>
      Range オブジェクトが複数のセルを参照する場合は、エラーが生成されます。<br>
      _SourceType_がxlsrcexternalに設定されている場合は、 _Destination_引数を指定する必要があります。 _SourceType_がxlsrcrange出力に設定されている場合、引数_Destination_は無視されます。<br>
      移動先の範囲は、_式_で指定されたlistobjectsコレクションが含まれているワークシート上にある必要があります。 新しい列は、新しいリストに適合するように_コピー先_に挿入されます。 したがって、既存のデータは上書きされません。</td>
  </tr>
  <tr>
    <td>TableStyleName</td>
    <td>省略可能</td>
    <td>文字列型 (String)</td>
    <td>TableStyle の名前。<br>
      たとえば、&quot;TableStyleLight1&quot; のようになります。</td>
  </tr>
</tbody>
</table></div><br>
戻り値は、新しいリストオブジェクトを表すListObjectオブジェクト。<br><div class="br2"><br></div>
</div>
</div>
<div class="main-indent">対象となるオブジェクトがある程度わかれば、VBAを書いてオブジェクトの状態を調べることができます。<br>
<strong>WorkbookQuery</strong></div>
<div class="main-indent">
<div class="main-indent">
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Sub クエリ出力()<br>
      　　Dim wb As Workbook<br>
      　　Set wb = ActiveWorkbook<br>
      　　Dim qry As WorkbookQuery<br>
      　　For Each qry In wb.Queries<br>
      　　　　Debug.Print qry.Name<br>
      　　　　Debug.Print qry.Formula<br>
      　　Next<br>
      End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
クエリを全てイミィディエイトに出力しています。<br><div class="br2"><br></div>
</div>
</div>
<div class="main-indent"><strong>WorkbookConnection</strong></div>
<div class="main-indent">
<div class="main-indent">
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Sub 接続出力()<br>
　　Dim wb As Workbook<br>
　　Set wb = ActiveWorkbook<br>
      　　Dim con As WorkbookConnection<br>
      　　On Error Resume Next<br>
　　For Each con In wb.Connections<br>
　　　　Debug.Print con.Name<br>
　　　　Debug.Print con.Description<br>
　　　　<span style="color:#009900;">'ODBC</span><br>
      　　　　Debug.Print con.ODBCConnection.Connection<br>
      　　　　Debug.Print con.ODBCConnection.CommandText<br>
      　　　　Debug.Print con.ODBCConnection.CommandType<br>
　　　　<span style="color:#009900;">'OLEDB</span><br>
　　　　Debug.Print con.OLEDBConnection.Connection<br>
      　　　　Debug.Print con.OLEDBConnection.CommandText<br>
　　　　Debug.Print con.OLEDBConnection.CommandType<br>
　　Next<br>
　　On Error GoTo 0<br>
End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
ODBCまたはOLEDBのどちらかでエラーになるので、On Errorを入れています。<br>接続を全てイミィディエイトに出力しています。<br>
<strong>CommandTextを取得して、SQL文の文字列変更後に更新することもできます。</strong><br><div class="br2"><br></div>
</div><br>
マクロの記録のVBAと合わせて設定情報を確認しつつVBAを変更していきます。<br><div class="br2"><br></div>
</div>
<div class="main-indent">
<div class="ads1">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="5140526405"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div><h3><strong>PowerQueryの機能を利用したマクロVBA</strong></h3>
<div class="main-indent">上記の「マクロの記録」で作成されたVBAコードを使いまわせるように書き直したものが以下になります。<br>
以下のVBAでは、いわばPowerQueryはその機能だけを利用しています。<br>
つまり、PowerQueryは使い捨てていることになります。<br>
マクロVBAでデータを集める部分のみPowerQueryの機能を利用して、その後はクエリも接続も消しています。<br><div class="br2"><br></div>
<form>
<input type="button" value="VBAをコピー" onclick="fncVbaCopy(this)">
</form>
<div class="table-scroll"><code class="vbacode"><table border="1" cellpadding="10">
  <tbody>
    <tr>
      <td>Sub Macro1()<br>
　　<span style="color:#009900;">'対象のフォルダ選択</span><br>
　　Dim strFolder As String<br>
      　　With Application.FileDialog(msoFileDialogFolderPicker)<br>
      　　　　.AllowMultiSelect = False<br>
　　　　.Title = &quot;フォルダの選択&quot;<br>
　　　　If Not .Show Then<br>
　　　　　　Exit Sub<br>
　　　　End If<br>
　　　　strFolder = .SelectedItems(1)<br>
　　End With<br>
　　<br>
　　Application.ScreenUpdating = False<br>
　　Application.Calculation = xlCalculationManual<br>
　　On Error GoTo ErrExit<br>
　　<br>
　　<span style="color:#009900;">'出力ブック・シートの指定</span><br>
　　Dim wb As Workbook<br>
　　Set wb = ActiveWorkbook<br>
　　Dim ws As Worksheet<br>
　　Set ws = ActiveSheet<br>
　　ws.Cells.Clear<br>
　　<br>
　　<span style="color:#009900;">'ブックのクエリを全削除、もちろん適宜変更</span><br>
　　Dim qry As WorkbookQuery<br>
　　For Each qry In wb.Queries<br>
　　　　qry.Delete<br>
　　Next<br>
　　<br>
      　　<span style="color:#009900;">'クエリの数式文字列作成</span><br>
　　Dim qryStr1 As String<br>
　　Dim qryStr2 As String<br>
　　Dim qryStr3 As String<br>
　　Dim qryStr4 As String<br>
　　Dim qryStr5 As String<br>
      　　qryStr1 = &quot;let ソース = Excel.Workbook(<strong>QUERY2</strong>, null, true), Sheet1_Sheet = ソース{[Item=&quot;&quot;Sheet1&quot;&quot;,Kind=&quot;&quot;Sheet&quot;&quot;]}[Data], 昇格されたヘッダー数 = Table.PromoteHeaders(Sheet1_Sheet, [PromoteAllScalars=true]) in 昇格されたヘッダー数&quot;<br>
      　　qryStr2 = &quot;#&quot;&quot;QUERY3&quot;&quot; meta [IsParameterQuery=true,
      BinaryIdentifier=#&quot;&quot;<strong>QUERY3</strong>&quot;&quot;, Type=&quot;&quot;Binary&quot;&quot;, IsParameterQueryRequired=true]&quot;<br>
　　qryStr3 = &quot;let ソース = Folder.Files(&quot;&quot;&quot; &amp; _<br>
      　　　　　　　<strong>strFolder</strong> &amp; _<br>
　　　　　　　&quot;&quot;&quot;), ナビゲーション1 = ソース{0}[Content] in ナビゲーション1&quot;<br>
      　　qryStr4 = &quot;let ソース = (<strong>QUERY2</strong>) =&gt; let ソース = Excel.Workbook(<strong>QUERY2</strong>, null, true), Sheet1_Sheet = ソース{[Item=&quot;&quot;Sheet1&quot;&quot;,Kind=&quot;&quot;Sheet&quot;&quot;]}[Data], 昇格されたヘッダー数 = Table.PromoteHeaders(Sheet1_Sheet, [PromoteAllScalars=true]) in 昇格されたヘッダー数 in ソース&quot;<br>
　　qryStr5 = &quot;let ソース = Folder.Files(&quot;&quot;&quot; &amp; _<br>
      　　　　　　　<strong>strFolder</strong> &amp; _<br>
      　　　　　　　&quot;&quot;&quot;), #&quot;&quot;フィルター選択された非表示の File1&quot;&quot;
      = Table.SelectRows(ソース, each [Attributes]?[Hidden]? &lt;&gt; true), カスタム関数の呼び出し1
      = Table.AddColumn(#&quot;&quot;フィルター選択された非表示の File1&quot;&quot;, &quot;&quot;<strong>QUERY4</strong>&quot;&quot;, each <strong>QUERY4</strong>([Content])), #&quot;&quot;名前が変更された列 1&quot;&quot; = Table.RenameColumns(カスタム関数の呼び出し1, {&quot;&quot;Name&quot;&quot;, &quot;&quot;Source.Name&quot;&quot;}), 削除された他の列1 = Table.Select&quot; &amp; &quot;Columns(#&quot;&quot;名前が変更された列 1&quot;&quot;, {&quot;&quot;Source.Name&quot;&quot;, &quot;&quot;<strong>QUERY4</strong>&quot;&quot;}), 展開されたテーブル列1 = Table.ExpandTableColumn(削除された他の列1, &quot;&quot;<strong>QUERY4</strong>&quot;&quot;, Table.ColumnNames(<strong>QUERY4</strong>(#&quot;&quot;<strong>QUERY3</strong>&quot;&quot;))), 変更された型 = Table.TransformColumnTypes(展開されたテーブル列1,{{&quot;&quot;Source.Name&quot;&quot;, type text}, {&quot;&quot;日付&quot;&quot;, type date}, {&quot;&quot;部署&quot;&quot;, type text}, {&quot;&quot;担当&quot;&quot;, type text}, {&quot;&quot;売上数&quot;&quot;, Int64.Type}, {&quot;&quot;売上金額&quot;&quot;, Int64.Type}}) i&quot; &amp; &quot;n 変更された型&quot; &amp; &quot;&quot;<br>
　　<br>
　　<span style="color:#009900;">'ブックにクエリ追加</span><br>
      　　With wb.Queries<br>
      　　　　.Add Name:=&quot;QUERY1&quot;, Formula:=qryStr1<br>
　　　　.Add Name:=&quot;QUERY2&quot;, Formula:=qryStr2<br>
　　　　.Add Name:=&quot;QUERY3&quot;, Formula:=qryStr3<br>
　　　　.Add Name:=&quot;QUERY4&quot;, Formula:=qryStr4<br>
　　　　.Add Name:=&quot;QUERY5&quot;, Formula:=qryStr5<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'接続文字列作成</span><br>
　　Dim i As Long<br>
　　Dim Provider As String<br>
　　For i = 1 To 4<br>
　　　　Provider = _<br>
　　　　　　　　&quot;OLEDB;&quot; &amp; _<br>
　　　　　　　　&quot;Provider=Microsoft.Mashup.OleDb.1;&quot; &amp; _<br>
　　　　　　　　&quot;Data Source=$Workbook$;&quot; &amp; _<br>
      　　　　　　　　&quot;Location=<strong>QUERY&quot; &amp; i</strong> &amp; &quot;;&quot; &amp; _<br>
　　　　　　　　&quot;Extended Properties=&quot;&quot;&quot;&quot;&quot;<br>
      　　　　wb.Connections.Add2 _<br>
      　　　　　　　　<strong>&quot;QUERY&quot; &amp; i</strong>, _<br>
      　　　　　　　　<strong>&quot;接続&quot; &amp; i</strong>, _<br>
　　　　　　　　Provider, _<br>
      　　　　　　　　&quot;SELECT * FROM [<strong>QUERY&quot; &amp; i</strong> &amp; &quot;]&quot;, _<br>
　　　　　　　　2<br>
　　Next<br>
　　<br>
      　　<span style="color:#009900;">'クエリーテーブル追加</span><br>
      　　With ws.ListObjects.Add(SourceType:=0, _<br>
　　　　　　　　　　　　　　Source:=&quot;OLEDB;&quot; &amp; _<br>
　　　　　　　　　　　　　　&quot;Provider=Microsoft.Mashup.OleDb.1;&quot; &amp; _<br>
　　　　　　　　　　　　　　&quot;Data Source=$Workbook$;&quot; &amp; _<br>
      　　　　　　　　　　　　　　&quot;Location=<strong>QUERY5</strong>;Extended Properties=&quot;&quot;&quot;&quot;&quot;, _<br>
　　　　　　　　　　　　　　Destination:=Range(&quot;$A$1&quot;))<br>
      　　　　With .QueryTable<br>
　　　　　　.CommandType = xlCmdSql<br>
      　　　　　　.CommandText = Array(&quot;SELECT * FROM [<strong>QUERY5</strong>]&quot;)<br>
　　　　　　.RowNumbers = False<br>
　　　　　　.FillAdjacentFormulas = False<br>
　　　　　　.PreserveFormatting = True<br>
　　　　　　.RefreshOnFileOpen = False<br>
　　　　　　.BackgroundQuery = True<br>
　　　　　　.RefreshStyle = xlInsertDeleteCells<br>
　　　　　　.SavePassword = False<br>
　　　　　　.SaveData = True<br>
　　　　　　.AdjustColumnWidth = True<br>
　　　　　　.RefreshPeriod = 0<br>
　　　　　　.PreserveColumnInfo = True<br>
　　　　　　.ListObject.DisplayName = &quot;適当な名前&quot;<br>
　　　　　　.Refresh BackgroundQuery:=False<br>
　　　　End With<br>
　　　　<br>
      　　　　<span style="color:#009900;">'テーブルを範囲に変換</span><br>
　　　　.TableStyle = &quot;&quot;<br>
　　　　.Unlist<br>
　　End With<br>
　　<br>
　　<span style="color:#009900;">'ブックのクエリを全削除、もちろん適宜変更</span><br>
　　For Each qry In wb.Queries<br>
　　　　qry.Delete<br>
　　Next<br>
　　<br>
　　Application.Calculation = xlCalculationAutomatic<br>
　　Application.ScreenUpdating = True<br>
　　MsgBox &quot;PowerQuery取込終了&quot;<br>
　　Exit Sub<br>
　　<br>
ErrExit:<br>
　　MsgBox &quot;PowerQuery異常発生&quot; &amp; vbLf &amp; vbLf &amp; _<br>
　　　　　 Err.Description<br>
      End Sub</td>
    </tr>
  </tbody>
</table></code></div><br>
VBAコードの細かい解説は省略します。<br>マクロの記録の元のVBAと比べながらVBAコードを読んでみてください。<br>
処理の流れとしては、<br>
・QueryのFormulaを作成し、Queries.Add<br>
・接続文字列を作成し、Connections.Add2<br>
・作成した接続でクエリテーブルを追加、ListObjects.Add<br>
上記VBAコードの太字を中心に見ていくと流れがわかると思います。<br><div class="br2"><br></div>
クエリの数式文字列については、M言語と言うものになります。<br>
これは説明していたらきりがありませんし、私もまだよく理解していません。<br>
今後PowerQueryがVBAで頻繁に使われるようになった時には、解説できるようにしたいと思っています。<br>
上記では、マクロの記録で作成されたものを一部変更しただけのものになります。<br>
主な変更点は、<br>
・Chr(13) &amp; &quot;&quot; &amp; Chr(10) 、これは改行なので不要<br>
・クエリ名をVBAで扱いやすいように変更<br>
改行は消す必要はないのですが、<br>
ここでは掲載した時のゴチャゴチャ感を減らすために消したまでです。<br>
その他の日本語が使われている部分も短くしたいところですが、マクロ記録と比較しやすいようにそのままにしてあります。<br><div class="br2"><br></div>
QueryTableのプロパティは省略できるものも多いのですが、<br>
後々の変更を考えれば、そのまま残しておいた方が良いと思いでしょう。<br><div class="br2"><br></div>
</div>
<h3>PowerQueryについて</h3>
<div class="main-indent">PowerQueryは、名前の通りQuryの機能を強化したものです。<br>
基本部分は、以前からあったQueryTable（テキストデータのインポート等）を強化したものと考えれば良いでしょう。<br>
M言語を導入しエディタからM言語を自動生成されるようになっていて、この機能がとても優れていると思います。<br>
特にテーブル機能と上手く連携していて、かなりスムーズに扱えるようになっていると感じます。<br><div class="br2"><br></div>
DB（データベース）を良く扱う人にとっては、そんなに理解しづらいものではないと思います。<br>
<strong><a href="EXCEL273.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL273.html" target="_blank">ADOを使いSQL発行</a></strong>するのと同じ考え方になります。<div class="details">ADOはMicrosoftが提供するデータベースアクセスのためのソフトウェア部品です。OLEDBをActiveXコントロールの形で使えるようにしたプログラミングインターフェースになります。ここでは、ADOを使用したデータベースへの接続方法を解説します。</div>
つまり、M言語を覚えるのはSQLを覚えることと似ている部分は多いでしょう。<br>
ただし、いずれにしても一つの言語になりますので、学習には相応の時間がかかるとは思います。<br><div class="br2"><br></div>
M言語を直接スラスラ書けるに越したことはありませんが、<br>
PowerQuryエディタの自動生成を上手く利用していくことでVBAでの活用範囲は広がるはずです。<br><div class="br2"><br></div>
ただし、やはり自動作成されたM言語は無駄な部分もかなり多いように見受けられました。<br>
これは、マクロの記録で作成されたVBAと同じだろうと思います。<br>
今後、WEBや書籍でクエリの具体例と解説が増えてくるはずですので、それを基に作成するという使い方もできるようになってくるでしょう。<br><div class="br2"><br></div>
</div>

          
<HR>
<div class="ads1">
<center>
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- yama3 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="8239480723"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="6847508570"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</center>
</div>
          <section>
<br><A name="same"><h3>同じテーマ「<a href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</a>」の記事</h3><p>
<A href="EXCEL_VBA_409.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_409.html">Byte配列と文字コード関数について</A><br>
<A href="EXCEL_VBA_404.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_404.html">VBA+SeleniumBasicで検索順位チェッカー（改）</A><br>
<A href="EXCEL_VBA_407.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_407.html">Applicationを省略できるApplicationのメソッド・プロパティ一覧</A><br>
<span class="strrev">PowerQueryの強力な機能をVBAから利用する方法</span><br>
<A href="EXCEL_VBA_411.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_411.html">ShapesとDrawingObjectsの相違点と使い方</A><br>
<A href="EXCEL_VBA_412.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_412.html">新規挿入可能なシート名の判定</A><br>
<A href="EXCEL_VBA_413.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_413.html">VBAにおける配列やコレクションの起点について</A><br>
<A href="EXCEL_VBA_416.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_416.html">VBAのマルチステートメント（複数のステートメントを同じ行に）</A><br>
<A href="EXCEL_VBA_418.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_418.html">クリップボードに2次元配列を作成してシートに貼り付ける</A><br>
<A href="EXCEL_VBA_419.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_419.html">ユーザー定義型の制限とクラスとの使い分け</A><br>
<A href="EXCEL_VBA_420.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL_VBA_420.html">シングルクォートの削除とコピー（PrefixCharacter）</A><br></p>
</A>
          </section>
          <section id="new">
<br><h3><A name="new">新着記事<span class="newicon">NEW</span> </a>・・・<A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧を見る</A></h3><p><A href="../vba100/VBA100_100.html" tppabs="https://excel-ubara.com/vba100/VBA100_100.html">VBA100本ノック 100本目：WEBから100本ノックのリストを取得｜VBA練習問題</A>（3月3日）<br>
<A href="../vba100/VBA100_099.html" tppabs="https://excel-ubara.com/vba100/VBA100_099.html">VBA100本ノック 99本目：自動席替え（行列と前後左右が全て違うように）｜VBA練習問題</A>（3月2日）<br>
<A href="../vba100/VBA100_098.html" tppabs="https://excel-ubara.com/vba100/VBA100_098.html">VBA100本ノック 98本目：席替えルールが守られているか確認｜VBA練習問題</A>（3月1日）<br>
<A href="../vba100/VBA100_097.html" tppabs="https://excel-ubara.com/vba100/VBA100_097.html">VBA100本ノック 97本目：Accessデータを取得（グループ集計）｜VBA練習問題</A>（2月27日）<br>
<A href="../vba100/VBA100_096.html" tppabs="https://excel-ubara.com/vba100/VBA100_096.html">VBA100本ノック 96本目：Accessデータを取得（マスタ結合&amp;抽出）｜VBA練習問題</A>（2月26日）<br>
<A href="../vba100/VBA100_095.html" tppabs="https://excel-ubara.com/vba100/VBA100_095.html">VBA100本ノック 95本目：図形のテキストを検索するフォーム作成｜VBA練習問題</A>（2月24日）<br>
<A href="../vba100/VBA100_094.html" tppabs="https://excel-ubara.com/vba100/VBA100_094.html">VBA100本ノック 94本目：表範囲からHTMLのtableタグを作成｜VBA練習問題</A>（2月23日）<br>
<A href="../vba100/VBA100_093.html" tppabs="https://excel-ubara.com/vba100/VBA100_093.html">VBA100本ノック 93本目：複数ブックを連結して再分割｜VBA練習問題</A>（2月22日）<br>
<A href="../vba100/VBA100_092.html" tppabs="https://excel-ubara.com/vba100/VBA100_092.html">VBA100本ノック 92本目：セルの色を16進で返す関数｜VBA練習問題</A>（2月20日）<br>
<A href="../vba100/VBA100_091.html" tppabs="https://excel-ubara.com/vba100/VBA100_091.html">VBA100本ノック 91本目：時間計算（残業時間の月間合計）｜VBA練習問題</A>（2月19日）<br></p>

          </section>
          <section id="rank">
<br><h3><A name="rank">アクセスランキング </a>・・・ <A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">ランキング一覧を見る</A></h3><p>1.<A href="../excelvba1/EXCELVBA318.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA318.html">最終行の取得（End,Rows.Count）｜VBA入門</A><br>2.<A href="../excelvba1/EXCELVBA311.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA311.html">RangeとCellsの使い方｜VBA入門</A><br>3.<A href="../excelvba1/EXCELVBA312.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA312.html">変数宣言のDimとデータ型｜VBA入門</A><br>4.<A href="../excelvba1/EXCELVBA301.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA301.html">マクロって何？VBAって何？｜VBA入門</A><br>5.<A href="../excelvba1/EXCELVBA310.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA310.html">Range以外の指定方法（Cells,Rows,Columns）｜VBA入門</A><br>6.<A href="../excelvba1/EXCELVBA341.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA341.html">セルのコピー&amp;値の貼り付け（PasteSpecial）｜VBA入門</A><br>7.<A href="../excelvba1/EXCELVBA316.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA316.html">繰り返し処理（For Next)｜VBA入門</A><br>8.<A href="../excelvba1/EXCELVBA308.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA308.html">セルに文字を入れるとは（Range,Value）｜VBA入門</A><br>9.<A href="../excelvba1/EXCELVBA304.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA304.html">マクロはどこに書くの（VBEの起動）｜VBA入門</A><br>10.<A href="../excelvba1/EXCELVBA306.html" tppabs="https://excel-ubara.com/excelvba1/EXCELVBA306.html">とにかく書いてみよう（Sub,End Sub）｜VBA入門</A><br></p>
          </section>
<br>
          <HR>
          <div><ul>
<li><a href="../index.htm" tppabs="https://excel-ubara.com/">ホーム</a></li>
<li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編</a></li>
<li><a href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</a></li>
<li><span class="strrev2"><strong>PowerQueryの強力な機能をVBAから利用する方法</strong></span></li>
</ul></div><br>
          <strong>このサイトがお役に立ちましたら「シェア」「Bookmark」をお願いいたします。</strong><br>
          <div class="ninja_onebutton">
            <script type="text/javascript">
              //<![CDATA[
              (function(d){
              if(typeof(window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2)=='undefined'){
                  document.write("<sc"+"ript type='text\/javascript' src='\/\/omt.shinobi.jp\/b\/dbb4ddbe09aac6bed0b2564afb27c6f2'><\/sc"+"ript>");
              }else{
                  window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2.ONETAGButton_Load();}
              })(document);
              //]]>
            </script><span class="ninja_onebutton_hidden" style="display:none;"></span><span style="display:none;" class="ninja_onebutton_hidden"></span>
          </div>
<br>
          <script>
            (function() {
              var cx = 'partner-pub-6511020045004282:1071452572';
              var gcse = document.createElement('script');
              gcse.type = 'text/javascript';
              gcse.async = true;
              gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          <gcse:searchbox-only></gcse:searchbox-only>
<br>
          記述には細心の注意をしたつもりですが、<br>
          間違いやご指摘がありましたら、<A href="../query.html" tppabs="https://excel-ubara.com/query.html" target="_blank">「お問い合わせ」</A>からお知らせいただけると幸いです。<br>
          掲載のVBAコードは動作を保証するものではなく、あくまでVBA学習のサンプルとして掲載しています。<br>
          掲載のVBAコードは自己責任でご使用ください。万一データ破損等の損害が発生しても責任は負いません。
        </section>
      </div> <!--/#main-->

      <div id="sub">
        <nav>
          <h2>エクセル全般</h2>
          <ul class="submenu">
            <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
            <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
            <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
            <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
            <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
            <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
          </ul>
          <h2>マクロVBA入門編</h2>
          <ul class="submenu">
            <li><A href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</A></li>
            <li><A href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</A></li>
            <li><A href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</A></li>
            <li><A href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</A></li>
            <li><A href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</A></li>
            <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
            <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
          </ul>
          <h2>マクロVBA応用編</h2>
          <ul class="submenu">
            <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
            <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
            <li><A href="../excelvba5/index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
            <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
            <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
            <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
          </ul>
          <h2>その他（Excel以外）</h2>
          <ul class="submenu">
            <li><a href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">SQL入門</a></li>
            <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">スプレッドシート入門</A></li>
            <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">GAS入門</A></li>
            <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">Python入門</A></li>
          </ul>
          <h2>サイト案内</h2>
          <ul class="submenu">
            <li><A href="../EXCELNEW.html" tppabs="https://excel-ubara.com/EXCELNEW.html">新着記事一覧</A></li>
            <li><A href="../EXCELRANK.html" tppabs="https://excel-ubara.com/EXCELRANK.html">アクセスランキング</A></li>
            <li><A href="../sitemap.html" tppabs="https://excel-ubara.com/sitemap.html">サイトマップ</A></li>
            <li><a href="../business/index.htm" tppabs="https://excel-ubara.com/business/">事業案内</a></li>
            <li><A href="../query.html" tppabs="https://excel-ubara.com/query.html">お問い合わせ&nbsp&nbsp</A></li>
          </ul>
        </nav>

        <section>
          
<HR>
<div class="ads1">
<CENTER>
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- yama22 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="9686142173"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</CENTER>
</div>
          

          

          <HR>
          <div><ul>
<li><a href="../index.htm" tppabs="https://excel-ubara.com/">ホーム</a></li>
<li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">マクロVBA応用編</a></li>
<li><a href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</a></li>
<li><span class="strrev2"><strong>PowerQueryの強力な機能をVBAから利用する方法</strong></span></li>
</ul></div><br>
          このサイトがお役に立ちましたら「シェア」「Bookmark」をお願いいたします。<br>

          <div class="ninja_onebutton">
            <script type="text/javascript">
              //<![CDATA[
              (function(d){
              if(typeof(window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2)=='undefined'){
                  document.write("<sc"+"ript type='text\/javascript' src='\/\/omt.shinobi.jp\/b\/dbb4ddbe09aac6bed0b2564afb27c6f2'><\/sc"+"ript>");
              }else{
                  window.NINJA_CO_JP_ONETAG_BUTTON_dbb4ddbe09aac6bed0b2564afb27c6f2.ONETAGButton_Load();}
              })(document);
              //]]>
            </script><span class="ninja_onebutton_hidden" style="display:none;"></span><span style="display:none;" class="ninja_onebutton_hidden"></span>
          </div>
          本文下部へ<br>
          <div class="main-indent">
            <strong><A href="#same">同じテーマの記事</A></strong><br>
            <strong><A href="#new">新着記事</A></strong><br>
            <strong><A href="#rank">アクセスランク</A></strong><br>
          </div>
          <div class="ads2">
            <script>
              (function() {
                var cx = 'partner-pub-6511020045004282:1071452572';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:searchbox-only></gcse:searchbox-only>
          </div>
<br><nav><h2>おすすめ関連記事</h2><ul class="submenu"><li><a href="EXCEL273.html" tppabs="https://excel-ubara.com/excelvba4/EXCEL273.html" target="_blank">ADOを使いSQL発行</a></li></ul></nav>
          

          
<HR>
<div class="ads2">
<script async src="../../pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" tppabs="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 新サイド下 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6511020045004282"
     data-ad-slot="1968934163"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div><br>
        </section>
      </div> <!--/#sub-->
    </div> <!--/#contents-in-->
  </div> <!--/#contents-->

  <footer>
    <div id="footermenu" class="inner">
      <ul>
        <li><a href="../excel_index.html" tppabs="https://excel-ubara.com/excel_index.html">■Excel全般</a></li>
        <li><A href="../excel1/index.htm" tppabs="https://excel-ubara.com/excel1/">エクセル入門</A></li>
        <li><A href="../excel2/index.htm" tppabs="https://excel-ubara.com/excel2/">エクセル基本操作</A></li>
        <li><A href="../excel3/index.htm" tppabs="https://excel-ubara.com/excel3/">エクセル関数応用</A></li>
        <li><A href="../excel4/index.htm" tppabs="https://excel-ubara.com/excel4/">エクセル挑戦問題</A></li>
        <li><A href="../EXCEL/excel_reference.html" tppabs="https://excel-ubara.com/EXCEL/excel_reference.html">Excelリファレンス</A></li>
        <li><A href="../excel5/index.htm" tppabs="https://excel-ubara.com/excel5/">エクセル雑感</A></li>
      </ul>
      <ul>
        <li><a href="../excel_vba1.html" tppabs="https://excel-ubara.com/excel_vba1.html">■マクロVBA入門編</a></li>
        <li><A href="../excelvba1/index.htm" tppabs="https://excel-ubara.com/excelvba1/">マクロVBA入門</A></li>
        <li><A href="../excelvba1r/index.htm" tppabs="https://excel-ubara.com/excelvba1r/">マクロVBA再入門</A></li>
        <li><A href="../excelvba2/index.htm" tppabs="https://excel-ubara.com/excelvba2/">マクロ記録でVBA</A></li>
        <li><A href="../excelvba9/index.htm" tppabs="https://excel-ubara.com/excelvba9/">マクロVBA練習問題</A></li>
        <li><A href="../MOS_VBA/index.htm" tppabs="https://excel-ubara.com/MOS_VBA/">VBAエキスパート対策</A></li>
        <li><A href="../excelvba8/index.htm" tppabs="https://excel-ubara.com/excelvba8/">マクロVBA関数</A></li>
        <li><A href="../vba100/index.htm" tppabs="https://excel-ubara.com/vba100/">VBA100本ノック</A></li>
      </ul>
      <ul>
        <li><a href="../excel_vba2.html" tppabs="https://excel-ubara.com/excel_vba2.html">■マクロVBA応用編</a></li>
        <li><A href="../excelvba3/index.htm" tppabs="https://excel-ubara.com/excelvba3/">ユーザーフォーム入門</A></li>
        <li><A href="../vba_class/index.htm" tppabs="https://excel-ubara.com/vba_class/">VBAクラス入門</A></li>
        <li><A href="../excelvba5/index.htm" tppabs="https://excel-ubara.com/excelvba5/">マクロVBAサンプル集</A></li>
        <li><A href="index.htm" tppabs="https://excel-ubara.com/excelvba4/">マクロVBA技術解説</A></li>
        <li><A href="../excelvba7/index.htm" tppabs="https://excel-ubara.com/excelvba7/">エクセル顧客管理</A></li>
        <li><A href="../EXCEL/vba_reference.html" tppabs="https://excel-ubara.com/EXCEL/vba_reference.html">VBAリファレンス</A></li>
      </ul>
      <ul>
        <li><A href="../python/index.htm" tppabs="https://excel-ubara.com/python/">■Python入門</A></li>
        <li><a href="../vba_sql/index.htm" tppabs="https://excel-ubara.com/vba_sql/">■SQL入門</a></li>
        <li><A href="../spreadsheet1/index.htm" tppabs="https://excel-ubara.com/spreadsheet1/">■スプレッドシート入門</A></li>
        <li><A href="../apps_script1/index.htm" tppabs="https://excel-ubara.com/apps_script1/">■Google Apps Script入門</A></li>
        <li><A href="../excel_course/index.htm" tppabs="https://excel-ubara.com/excel_course/">■エクセル講座セミナー</A></li>
        <li><A href="../business/index.htm" tppabs="https://excel-ubara.com/business/">■事業案内</A></li>
        <li><A href="../business/sitemap.html" tppabs="https://excel-ubara.com/business/sitemap.html">■サイトマップ</A></li>
      </ul>
    </div> <!--/footermenu-->
    <div id="copyright">
      <small>エクセルの神髄 ｜ Copyright&copy; 2010 <A href="../index.htm" tppabs="https://excel-ubara.com/">鵜原パソコンソフト研究所</A></small>
    </div>
  </footer>

  <p class="nav-fix-pos-pagetop"><a href="#">↑</a></p>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37178461-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
<!--License20150309TPg-->
</body>
</html>
