<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Ruby入門 - 制御構文 - とほほのWWW入門</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="../style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>Ruby入門 - 制御構文</h2>
<a href="../www.htm" tppabs="http://www.tohoho-web.com/www.htm">トップ</a> &gt;
<a href="index.html" tppabs="http://www.tohoho-web.com/ruby/index.html">Ruby入門</a> &gt;
制御構文

<h4 id="if">もし～ならば(if, then, else, elsif)</h4>
<div class=i>
<div class="title-tab">文法1</div>
<pre class=c2>
<b>if</b> <i>expr</i> [<b>then</b>]
  <i>expression</i>...
[<b>elsif</b> <i>expr</i> [<b>then</b>]
  <i>expression</i>...]...
[<b>else</b>
  <i>expression</i>...]
<b>end</b>
</pre>
<div class="title-tab">文法2</div>
<pre class=c2>
<i>expression</i> <b>if</b> <i>expr</i>
</pre>
<p><b>if</b> は「もし」を意味します。式が真であれば、<b>then</b> ～ <b>end</b> までの処理を実行します。下記の例では、num の値が 10より大きければ BIG を表示します。then は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>if</em> num &gt; 10 <em>then</em>
  puts "BIG"
<em>end</em>
</pre>
<p><b>else</b> は「さもなくば」を意味します。下記の例では、num が 10より大きければ BIG を、さもなくば SMALL を表示します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>if</em> num &gt; 10 <em>then</em>
  puts "BIG"
<em>else</em>
  puts "SMALL"
<em>end</em>
</pre>
<p><b>elsif</b> は「さもなくばもし」を意味します。下記の例では、num が 10より大きければ BIG を、10と等しければ NORMAL を、さもなくば SMALL を表示します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>if</em> num &gt; 10 <em>then</em>
  puts "BIG"
<em>elsif</em> num == 10 <em>then</em>
  puts "NORMAL"
<em>else</em>
  puts "SMALL"
<em>end</em>
</pre>
<p>下記の例も、num の値が 10 より大きければ BIG を表示します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
puts "BIG" <em>if</em> num &gt; 10
</pre>
<p>PHP などでは数値の 0 や空文字列も偽とみなされますが、Ruby では false および nil のみが偽と判断され、0 や空文字を含むその他の値は真とみなされます。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>if 0 then</em>
  puts "OK"            #=&gt; OK
end
</pre>
</div>

<h4 id="unless">もし～でなければ(unless, then)</h4>
<div class=i>
<div class="title-tab">文法1</div>
<pre class=c2>
<b>unless</b> <i>expr</i> [<b>then</b>]
  <i>expression</i>...
[<b>else</b>
  <i>expression</i>...]
<b>end</b>
</pre>
<div class="title-tab">文法2</div>
<pre class=c2>
<i>expression</i> <b>unless</b> <i>expr</i>
</pre>
<p><b>unless</b> は「もし～でなければ」を意味します。下記の例では、num が 10 より小さくなければ、BIG を表示します。then は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>unless</em> num &lt; 10 <em>then</em>
  puts "BIG"
<em>end</em>
</pre>
<p>下記の表記も可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
puts "BIG" <em>unless</em> num &lt; 10
</pre>
</div>

<h4 id="while">～のあいだ(while, do)</h4>
<div class=i>
<div class="title-tab">文法1</div>
<pre class=c2>
<b>while</b> <i>expr</i> [<b>do</b>]
  <i>expression</i>...
<b>end</b>
</pre>
<div class="title-tab">文法2</div>
<pre class=c2>
<i>expression</i> <b>while</b> <i>expr</i>
</pre>
<p><b>while</b> は「～のあいだ」を意味します。下記の例では、i の値が 10よりも小さい間 i の値を表示します。do は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
i = 0
<em>while</em> i &lt; 10 <em>do</em>
  puts i
  i += 1
<em>end</em>
</pre>
<p>下記の例も同じように動作します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
i = 0
begin
  puts i
  i += 1
end <em>while</em> i &lt; 10
</pre>
</div>

<h4 id="until">～になるまでのあいだ(until, do)</h4>
<div class=i>
<div class="title-tab">文法1</div>
<pre class=c2>
<b>until</b> <i>expr</i> [<b>do</b>]
  <i>expression</i>...
<b>end</b>
</pre>
<div class="title-tab">文法2</div>
<pre class=c2>
<i>expression</i> <b>until</b> <i>expr</i>
</pre>
<p><b>until</b> は「～になるまでのあいだ」を意味します。下記の例では、i の値が 10よりも大きくなるまでの間 i の値を表示します。do は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
i = 0
<em>until</em> i &gt; 10 <em>do</em>
  puts i
  i += 1
<em>end</em>
</pre>
<p>下記の例も同じように動作します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
i = 0
begin
  puts i
  i += 1
end <em>until</em> i &gt; 10
</pre>
</div>

<h4 id="for">～のあいだ(for, in, do)</h4>
<div class=i>
<div class="title-tab">文法</div>
<pre class=c2>
<b>for</b> <i>var</i>[<b>,</b> var]... <b>in</b> <i>expr</i> [<b>do</b>]
  <i>expression</i>...
<b>end</b>
</pre>
<p><b>for</b> は配列の各要素に対して処理を繰り返します。do は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>for</em> i <em>in</em> [1, 2, 3] <em>do</em>
  puts i                  #=&gt; 1, 2, 3
<em>end</em>
</pre>
<p>下記の例では、1～10 の間処理を繰り返します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>for</em> i <em>in</em> 1..10 <em>do</em>
  puts i                  #=&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
<em>end</em>
</pre>
<p>複数の配列を扱うには次のようにします。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>for</em> i, j <em>in</em> [[1, 2], [3, 4], [5, 6]] <em>do</em>
  puts i * j              #=&gt; 2, 12, 30
<em>end</em>
</pre>
<p>ただし、Ruby では for 文を使用することはあまりなく、下記の様なイテレータを使用するのが一般的です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
<em>10.times do |i|</em>
  puts i
<em>end</em>
</pre>
</div>

<h4 id="case">～の場合(case, when)</h4>
<div class=i>
<div class="title-tab">文法</div>
<pre class=c2>
<b>case</b> [<i>expr</i>]
[<b>when</b> <i>expr</i>[<b>,</b> <i>expr</i>]...[<b>,</b> <b>*</b><i>expr</i>] [<b>then</b>]
  <i>expression</i>...]...
[<b>when</b> <b>*</b><i>expr</i> [<b>then</b>]
  <i>expression</i>...]...
[<b>else</b>
  <i>expression</i>...]...
<b>end</b>
</pre>
<p><b>case</b>, <b>when</b>, <b>else</b> は、値によって処理を振り分けます。次の例では、num の値が 1～3 の場合は SMALL、4～6 の場合は NORMAL、その他の場合は BIG を表示します。then は省略可能です。</p>
<div class="tab">Ruby</div>
<pre class=c2>
num = 4
<em>case</em> num
<em>when</em> 1..3 <em>then</em>
  puts "SMALL"
<em>when</em> 4..6 <em>then</em>
  puts "NORMAL"
<em>else</em>
  puts "BIG"
<em>end</em>
</pre>
</div>

<h4 id="break">ループを抜ける(break)</h4>
<div class=i>
<p><b>break</b> は最も内側の while, until, for などのループ処理を抜けます。下記の例では、i が 5の時に forループを抜けます。</p>
<div class="tab">Ruby</div>
<pre class=c2>
for i in 1..10
  if i == 5 then
    <em>break</em>
  end
  puts i                 #=&gt; 1, 2, 3, 4
end
</pre>
</div>

<h4 id="next">ループを繰り返す(next)</h4>
<div class=i>
<p><b>next</b> は while, until, for などのループ処理において、残りの処理をスキップして次のループを始めます。次の例では、i が 5の時のみ、puts を実行しません。</p>
<div class="tab">Ruby</div>
<pre class=c2>
for i in 1..10
  if i == 5 then
    <em>next</em>
  end
  puts i              #=&gt; 1, 2, 3, 4, 6, 7, 8, 9, 10
end
</pre>
</div>

<h4 id="redo">ループを繰り返す(redo)</h4>
<div class=i>
<p><b>redo</b> も next と同様、ループを繰り返しますが、next がループの終了判断を行ってから処理を行うのに対し、redo は終了判断無しで処理を繰り返します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
i = 0
while i &lt; 5 do
  i += 1
  if i == 5 then
    <em>redo</em>
  end
  puts i              #=&gt; 1, 2, 3, 4, 6
end
</pre>
</div>

<h4 id="raise">例外処理(raise, begin, rescue, else, ensure)</h4>
<div class=i>
<div class="title-tab">文法</div>
<pre class=c2>
<b>raise</b> [<i>error_type</i>,] <i>message</i>[, <i>traceback</i>]
</pre>
<div class="title-tab">文法</div>
<pre class=c2>
<b>begin</b>
  <i>expression</i>...
[<b>rescue</b> [<i>error_type</i>, ...] [<b>=&gt;</b> <i>evar</i>] [<b>then</b>]
  <i>expression</i>...]...
[<b>else</b>
  <i>expression</i>...]...
[<b>ensure</b>
  <i>expression</i>...]
<b>end</b>
</pre>
<p><b>raise</b> は、エラー発生時に例外(Exception)を投げます。<b>rescue</b> には、例外を受け取った際の例外処理を記述します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
def square(n)
  if n &gt; 10 then
    <em>raise RangeError, "ERROR!"</em>   # 例外を投げる
  end
  return n * n                    # この行は実行されない
end

<em>begin</em>
  x = square(15)                  # 例外発生
  puts x                          # この行は実行されない
<em>rescue RangeError</em>                 # 例外を受け取る
  puts "ERROR: RangeError"        # 例外処理
<em>end</em>
</pre>
<p>例外種別に応じて複数の rescue 節を記述できます。例外種別を省略した場合、StandardError 例外とみなされます。<b>else</b> にはどの rescue 節にも該当しなかった例外処理を記述します。<b>ensure</b> には、例外の有無に関わらず実行する処理を記述します。</p>
<div class="tab">Ruby</div>
<pre class=c2>
def func(num)
  case num
  when 1
    raise SyntaxError, "ERROR!"
  when 2
    raise ArgumentError, "ERROR!"
  when 3
    raise NoMemoryError, "ERROR!"
  when 4
    <em>raise "ERROR!"</em>              # Same as raise StandardError, "ERROR!"
  else
    return
  end
end

<em>begin</em>
  func(3)
<em>rescue SyntaxError</em>
  puts "Rescue(SyntaxError)"
<em>rescue ArgumentError</em>
  puts "Rescue(ArgumentError)"
<em>rescue</em>                          # Same as rescue StandardError
  puts "Rescue"
<em>else</em>
  puts "Else"
<em>ensure</em>
  puts "Ensure"
<em>end</em>
</pre>
<p>例外種別は、Exception クラスのサブクラスとして実装されています。rescue は指定した例外種別のサブクラスすべてを待ち受けます。例えば、SyntaxError は ScriptError のサブクラスであるため、下記の例では Rescue(SyntaxError) ではなく、Rescue(ScriptError) が表示されます。</p>
<div class="tab">Ruby</div>
<pre class=c2>
begin
  raise <em>SyntaxError</em>, "ERROR!"
<em>rescue ScriptError</em>
  puts "Rescue(ScriptError)"     # こちらが出力される
<em>rescue SyntaxError</em>
  puts "Rescue(SyntaxError)"     # こちらにはマッチしない
end
</pre>
<p>例外種別のクラス階層は次のようになっています。</p>
<div class="tab">Ruby</div>
<pre class=c2>
Exception
  fatal
  SystemExit
  NoMemoryError
  ScriptError
    LoadError
    NotImplementedError
    SyntaxError
  SignalException
    Interrupt
  StandardError
    ArgumentError
    IOError
      EOFError
    IndexError
      StopIteration
    LocalJumpError
    NameError
      NoMethodError
    RangeError
      FloatDomainError
    RegexpError
    RuntimeError
    SecurityError    # Ruby 1.9からはExceptionのサブクラス
    SystemCallError
      Errno::EXXXXX
    SystemStackError
    ThreadError
    TypeError
    ZeroDivitionError
</pre>
</div>


<hr>
<div>Copyright(C) 2014 杜甫々</div>
<div>初版：2014年12月30日、最終更新：2014年12月30日</div>
<div>http://www.tohoho-web.com/ruby/control.html</div>
</body>
</html>

