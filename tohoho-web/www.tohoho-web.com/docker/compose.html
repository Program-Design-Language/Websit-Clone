<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8"utf-8">
<title>Docker Compose - ã¨ã»ã»ã®WWWå…¥é–€</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="../style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>Docker Compose</h2>
<a href="../www.htm" tppabs="http://www.tohoho-web.com/www.htm">ãƒˆãƒƒãƒ—</a> &gt;
<a href="index.html" tppabs="http://www.tohoho-web.com/docker/index.html">Docker</a> &gt;
Docker Compose

<h4 id="abou">Docker Composeã¨ã¯</h4>
<div class="i">
<p>Docker Compose ã¯ã€Webã‚µãƒ¼ãƒã‚³ãƒ³ãƒ†ãƒŠã¨ DBã‚µãƒ¼ãƒã‚³ãƒ³ãƒ†ãƒŠãªã©ã€é–¢é€£ã™ã‚‹è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
</div>

<h4 id="install">Docker Composeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h4>
<div class="i">
<p><a href="javascript:if(confirm('https://github.com/docker/compose/04.htm  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://github.com/docker/compose/04.htm'" tppabs="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a> ã®è¨˜è¿°ã«å¾“ã„ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# curl -L \
  https://github.com/docker/compose/releases/download/1.25.0-rc2/docker-compose-`uname -s`-`uname -m` \
  -o /usr/local/bin/docker-compose
# chmod +x /usr/local/bin/docker-compose
</pre>
</div>

<h4 id="tutorial">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</h4>
<div class="i">
<p>ãƒ¯ãƒ¼ã‚¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª work1 ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¯ã€ã‚¤ãƒ¡ãƒ¼ã‚¸åã€ã‚³ãƒ³ãƒ†ãƒŠåã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åãªã©ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# mkdir ./work1
# cd ./work1
</pre>
<p>Docker Compose ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€Python ãƒ™ãƒ¼ã‚¹ã® Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ(web)ã¨ã€ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚³ãƒ³ãƒ†ãƒŠ(radis)ã® 2ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# ls -l
-rw-r--r--. 1 root root  96  9æœˆ  4 21:30 Dockerfile
-rw-r--r--. 1 root root 309  9æœˆ  4 21:30 app.py
-rw-r--r--. 1 root root 156  9æœˆ  4 21:30 docker-compose.yml
-rw-r--r--. 1 root root  12  9æœˆ  4 21:30 requirements.txt
</pre>
<p>ã¾ãš app.py ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥(redis)ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å›æ•°ã‚’èª­ã¿å–ã‚Šã€ã‚¢ã‚¯ã‚»ã‚¹å›æ•°ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã‚ã¦è¿”å´ã™ã‚‹ç°¡å˜ãª Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚</p>
<div class="title-tab">app.py</div>
<pre class="c2">
from flask import Flask
from redis import Redis

app = Flask(__name__)
redis = Redis(host='redis', port=6379)

@app.route('/')
def hello():
    redis.incr('hits')
    return 'Hello World! I have been seen %s times.\n' % redis.get('hits').decode()

if __name__ == "__main__":
    app.run(host="0.0.0.0", debug=True)
</pre>
<p>app.py ã‚’å®Ÿè¡Œã™ã‚‹ã®ã«å¿…è¦ã¨ãªã‚‹ Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ—æŒ™ã—ã¾ã™ã€‚</p>
<div class="title-tab">requirements.txt</div>
<pre class="c2">
flask
redis
</pre>
<p>app.py ã‚’çµ„ã¿è¾¼ã‚€ webã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã® Dockerfile ã‚’ä½œæˆã—ã¾ã™ã€‚</p>
<div class="title-tab">Dockerfile</div>
<pre class="c2">
FROM python:3.6
ADD . /code
WORKDIR /code
RUN pip install -r requirements.txt
CMD python app.py
</pre>
<p>ä¸Šè¨˜ã§ä½œæˆã™ã‚‹ web ã‚³ãƒ³ãƒ†ãƒŠã¨ã€æ¨™æº–ã® redis ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®šç¾©ã—ã¾ã™ã€‚</p>
<div class="title-tab">docker-compose.yml</div>
<pre class="c2">
version: '2'
services:
  web:
    build: .
    ports:
     - "5000:5000"
    volumes:
     - .:/code
    depends_on:
     - redis
  redis:
    image: redis
</pre>
<p>docker-compose ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦ã€web ã‚³ãƒ³ãƒ†ãƒŠã¨ redis ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒ“ãƒ«ãƒ‰ãªã©ãŒè‡ªå‹•çš„ã«è¡Œã‚ã‚Œã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# docker-compose up -d
</pre>
<p>http://localhost:5000/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã€web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã™åº¦ã«ã€ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹å›æ•°ãŒã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# curl http://localhost:5000/
Hello World! I have been seen 1 times.
# curl http://localhost:5000/
Hello World! I have been seen 2 times.
# curl http://localhost:5000/
Hello World! I have been seen 3 times.
</pre>
<p>ä¸‹è¨˜ã§ç¢ºèªã™ã‚‹ã¨ã€work1_web_1, work1_redis_1 ã‚³ãƒ³ãƒ†ãƒŠã€work1_web ã‚¤ãƒ¡ãƒ¼ã‚¸ãªã©ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# docker ps             <span class="cm">=&gt; work1_web_1, work1_redis_1 ã‚³ãƒ³ãƒ†ãƒŠ</span>
# docker images         <span class="cm">=&gt; work1_web ã‚¤ãƒ¡ãƒ¼ã‚¸</span>
# docker network ls     <span class="cm">=&gt; work1_default ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</span>
# docker volume ls      <span class="cm">=&gt; åç„¡ã—ãƒœãƒªãƒ¥ãƒ¼ãƒ </span>
</pre>
<p>app.py ã‚’å°‘ã—ä¿®æ­£ã—ã¦å†åº¦ docker-compose up ã™ã‚‹ã¨ã€ä¿®æ­£ãŒã‚³ãƒ³ãƒ†ãƒŠã«åæ˜ ã•ã‚Œã¾ã™ã€‚</p>
<div class="title-tab">Shell</div>
<pre class="c2">
# vi ./app.py
# docker-compose up -d             <span class="cm">Hello! ã‚’ Hello!!! ã«ä¿®æ­£</span>
# curl http://localhost:5000/
Hello World!!! I have been seen 4 times.
</pre>
<p>docker-compose.yml ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>
</div>

<h4 id="links">ãƒªãƒ³ã‚¯</h4>
<div class="i">
<ul>
<li><a href="javascript:if(confirm('http://docs.docker.jp/compose/cgi_h.htm  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://docs.docker.jp/compose/cgi_h.htm'" tppabs="http://docs.docker.jp/compose/compose-file.html">http://docs.docker.jp/compose/compose-file.html</a>
</ul>
</div>

<hr>
<div>Copyright (C) 2019 æœç”«ã€…</div>
<div>åˆç‰ˆ:2019å¹´9æœˆ1æ—¥ æœ€çµ‚æ›´æ–°:2019å¹´9æœˆ1æ—¥</div>
<div>http://www.tohoho-web.com/docker/compose.html</div>
</body>
</html>
