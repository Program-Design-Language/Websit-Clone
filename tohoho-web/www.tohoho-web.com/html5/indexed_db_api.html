<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HTML5 - Indexed Database API - ã¨ã»ã»ã®WWWå…¥é–€</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="../style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>HTML5 - Indexed Database API</h2>
<a href="../www.htm" tppabs="http://www.tohoho-web.com/www.htm">ãƒˆãƒƒãƒ—</a> &gt;
<a href="index.html" tppabs="http://www.tohoho-web.com/html5/index.html">HTML5</a> &gt;
Indexed Database API

<h4>Indexed Database APIã¨ã¯</h4>
<div class=i>
<p>Indexed Database API ã¯ã€<a href="../wwwcook.htm" tppabs="http://www.tohoho-web.com/wwwcook.htm">Cookie</a>, <a href="web_storage.html" tppabs="http://www.tohoho-web.com/html5/web_storage.html">Web Storage</a>, <a href="web_sql_db.html" tppabs="http://www.tohoho-web.com/html5/web_sql_db.html">Web SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</a> ã¨åŒæ§˜ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã«ä¿å­˜ã™ã‚‹ä»•çµ„ã¿ã®ã²ã¨ã¤ã§ã™ã€‚ä¸‹è¨˜ã®ä»•æ§˜ãŒå…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<ul>
<li>æœ€æ–°ç‰ˆ: <a target="_top" href="javascript:if(confirm('https://www.w3.org/TR/IndexedDB-2/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.w3.org/TR/IndexedDB-2/'" tppabs="https://www.w3.org/TR/IndexedDB-2/">https://www.w3.org/TR/IndexedDB-2/</a>
<li>V2.0: <a target="_top" href="javascript:if(confirm('https://www.w3.org/TR/2017/PR-IndexedDB-2-20171116/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.w3.org/TR/2017/PR-IndexedDB-2-20171116/'" tppabs="https://www.w3.org/TR/2017/PR-IndexedDB-2-20171116/">https://www.w3.org/TR/2017/PR-IndexedDB-2-20171116/</a> [PR]
<li>V1.0: <a target="_top" href="javascript:if(confirm('https://www.w3.org/TR/2015/REC-IndexedDB-20150108/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://www.w3.org/TR/2015/REC-IndexedDB-20150108/'" tppabs="https://www.w3.org/TR/2015/REC-IndexedDB-20150108/">https://www.w3.org/TR/2015/REC-IndexedDB-20150108/</a> [REC]
</ul>
<p>Cookie ã‚„ Web Storage ãŒ Key-Valueå½¢å¼ã€Web SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒ SQL ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã®ã«å¯¾ã—ã€Indexed Database API ã§ã¯ã€SQLã«ä¾å­˜ã—ãªã„ NoSQL ã«åˆ†é¡ã•ã‚Œã‚‹æ–¹æ³•ã§ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚</p>
<p>Web SQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä»£ã‚ã‚Šã€ä»Šå¾Œã®æ¨™æº–ã¨ãªã‚‹äºˆå®šã§ã™ãŒã€ã¾ã ä»•æ§˜ã¯ç¢ºå®šã—ã¦ãŠã‚‰ãšã€å„ãƒ–ãƒ©ã‚¦ã‚¶ã®å®Ÿè£…ã«ã‚‚éäº’æ›æ€§ãŒãšã„ã¶ã‚“ã‚ã‚‹ã‚ˆã†ã§ã™ã€‚</p>
<p>Indexed Database API ã¯ã€ä¸‹è¨˜ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§éƒ¨åˆ†çš„ã«ã‚µãƒãƒ¼ãƒˆãŒå§‹ã¾ã£ã¦ã„ã¾ã™ã€‚</p>
<ul>
<li>Internet Explorer 10(Î²ç‰ˆ)
<li>Firefox 4.0
<li>Google Chrome 11
</ul>
</div>

<h4>ã‚µãƒ³ãƒ—ãƒ«</h4>
<div class=i>
<p>ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€DBã®ä½œæˆã€ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ã€ãƒ‡ãƒ¼ã‚¿ã®1ä»¶å‚ç…§ã€ãƒ‡ãƒ¼ã‚¿ã®å…¨ä»¶å‚ç…§ã€DBã®å‰Šé™¤ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚Firefox 12, Chrome 19 ã§ã€å‹•ä½œã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚</p>
<ul>
<li><a href="javascript:if(confirm('http://www.tohoho-web.com/html5/menu.htm  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ²»¿ÉÓÃ, »ò·ÅÆúÁËÏÂÔØ, »òÏîÄ¿¼´½«Í£Ö¹¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://www.tohoho-web.com/html5/menu.htm'" tppabs="http://www.tohoho-web.com/html5/indexed_db_api_sample.html">Indexed Database API Sample</a>
</ul>
<div class="title-tab">HTML</div>
<pre class=c2>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Indexed Database API Sample&lt;/title&gt;
&lt;style&gt;
#message {
    margin: 1em;
    padding: 1em;
    border: 1px solid gray;
    font: 9pt Courier;
    white-space: pre;
}
&lt;/style&gt;
&lt;script&gt;
var ver = 201205201;
var <em>indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB;</em>
var <em>IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.mozIDBTransaction;</em>
var db = null;

function print(msg) {
    document.getElementById("message").innerHTML += msg + "\n";
}

function clearConsole() {
    document.getElementById("message").innerHTML = "";
}

function <em>createSample()</em> {
    print("----------------------------------------------------");
    print("START: createSample()");
    <em>var reqOpen = indexedDB.open("sampleDB", ver)</em>;

    <em>reqOpen.onupgradeneeded</em> = function(e) {
        print("START: reqOpen.onupgradeneeded()");
        <em>db = reqOpen.result;</em>
        <em>db.createObjectStore("sample", { "keyPath": "id" });</em>
        print("EXEC : createObjectStore()");
        print("END  : reqOpen.onupgradeneeded()");
    <em>}</em>
    <em>reqOpen.onsuccess</em> = function(e) {
        print("START: reqOpen.onsuccess()");
        <em>db = reqOpen.result;</em>
        if (db.setVersion) {
            var reqVersion = <em>db.setVersion(ver);</em>
            <em>reqVersion.onsuccess</em> = function() {
                print("START: reqVersion.onsuccess()");
                <em>db.createObjectStore("sample", { "keyPath": "id" });</em>
                print("EXEC : createObjectStore()");
                print("END  : reqVersion.onsuccess()");
            }
        }
        print("END  : reqOpen.onsuccess()");
    }
    reqOpen.onerror = function(err) { print("ERROR: " + err.code + ":" + err.message); }
    reqOpen.onblocked = function(err) { print("INFO : BLOCKED"); }
    print("END  : createSample()");
}

function <em>addSample()</em> {
    print("----------------------------------------------------");
    print("START: addSample()");
    var userList = [
        { "id": 1, "name": "Yamada", "age": 18, "addr": "Tokyo" },
        { "id": 2, "name": "Suzuki", "age": 27, "addr": "Osaka" },
        { "id": 3, "name": "Tanaka", "age": 36, "addr": "Kyoto" },
        { "id": 4, "name": "Kimura", "age": 45, "addr": "Aichi" }
    ];

    var transaction = <em>db.transaction(["sample"], IDBTransaction.READ_WRITE);</em>
    var store = <em>transaction.objectStore("sample");</em>
    for (var i = 0; i &lt; userList.length; i++) {
        var data = userList[i];
        var reqAdd = <em>store.add(data);</em>
        print("EXEC : add() " + data.id + " / " + data.name + " / " + data.age + " / " + data.addr);
        reqAdd.onsuccess = function(e) { print("INFO : add() -&gt; SUCCESS"); }
        reqAdd.onerror = function(e) { print("INFO : add() -&gt; ERROR"); }
    }
    print("END  : addSample()");
}

function <em>getSample()</em> {
    print("----------------------------------------------------");
    print("START: getSample()");
    var transaction = <em>db.transaction(["sample"], IDBTransaction.READ_ONLY);</em>
    var reqGet = <em>transaction.objectStore("sample").get(1);</em>
    print("EXEC : get()");
    reqGet.onsuccess = function(e) {
        var data = reqGet.result;
        print("DATA : " + data.id + " / " + data.name + " / " + data.age + " / " + data.addr);
    }
    reqGet.onerror = function(e) { print("ERROR: add() -&gt; " + e); }
    print("END  : getSample()");
}

function <em>getAllSample()</em> {
    print("----------------------------------------------------");
    print("START: getAllSample()");
    var transaction = <em>db.transaction(["sample"], IDBTransaction.READ_ONLY);</em>
    var reqGet = <em>transaction.objectStore("sample").openCursor();</em>
    print("EXEC : openCursor()");
    reqGet.onsuccess = function(e) {
        var cursor = <em>reqGet.result;</em>
        var data = cursor.value;
        print("DATA : " + cursor.key + " / " + data.name + " / " + data.age + " / " + data.addr);
        <em>cursor.continue();</em>
    }
    reqGet.onerror = function(e) { print("ERROR: add() -&gt; " + e); }
    print("END  : getAllSample()");
}

function <em>deleteSample()</em> {
    print("----------------------------------------------------");
    print("START: deleteSample()");
    if (db) { db.close(); }
    var reqDelete = <em>indexedDB.deleteDatabase("sampleDB");</em>
    print("EXEC : deleteDatabase()");
    reqDelete.onsuccess = function(e) { print("INFO : deleteDatabase() -&gt; SUCCESS"); }
    reqDelete.onerror = function(e) { print("ERROR: deleteDatabase() -&gt; " + e); }
    reqDelete.onblocked = function(e) { print("INFO : BLOCKED"); }
    print("END  : deleteSample()");
}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;button onclick="<em>createSample()</em>"&gt;CREATE&lt;/button&gt;
&lt;button onclick="<em>addSample()</em>"&gt;ADD&lt;/button&gt;
&lt;button onclick="<em>getSample()</em>"&gt;GET&lt;/button&gt;
&lt;button onclick="<em>getAllSample()</em>"&gt;GET ALL&lt;/button&gt;
&lt;button onclick="<em>deleteSample()</em>"&gt;DELETE&lt;/button&gt;
&lt;button onclick="clearConsole()"&gt;CLEAR&lt;/button&gt;
&lt;div id="message"&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
</div>

<h4>API</h4>
<h5>APIåˆ©ç”¨ã®æº–å‚™</h5>
<div class=i>
<p>ã¾ã ä»•æ§˜ãŒç¢ºå®šã—ã¦ã„ãªã„ãŸã‚ã€Firefox ã§ã¯ mozIndexedDB, Chrome ã§ã¯ webkitIndexedDB ã¨ã—ã¦å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB;
var IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.mozIDBTransaction;
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ã</h5>
<div class=i>
<p>ã¾ãšã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ãã¾ã™ã€‚ç¬¬ä¸€å¼•æ•°ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’æŒ‡å®šã—ã¾ã™ã€‚ç¬¬äºŒå¼•æ•°ã¯ã€2010å¹´8æœˆã®ä»•æ§˜ã§ã¯DBã®èª¬æ˜ã‚’æŒ‡å®šã—ã¦ã„ã¾ã—ãŸã€‚2011å¹´4æœˆã®ä»•æ§˜ã§ã¯ç¬¬äºŒå¼•æ•°ã¯å»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚æœ€æ–°ã® 2011å¹´12æœˆã®ä»•æ§˜ã§ã¯ã€ç¬¬äºŒå¼•æ•°ã¯ unsigned long long å‹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³(çœç•¥å¯èƒ½)ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
reqOpen = indexedDB.open("sampleDB", 20120520);
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ã‚’ä½œæˆã™ã‚‹</h5>
<div class=i>
<p>Firefox 12 ã®å®Ÿè£…ã§ã¯ã€reqOpen.onupgradeneeded ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§ createObjectStore() ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚Chrome 19 ã®å®Ÿè£…ã§ã¯ã€reqOpen.onsuccess ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§ db.setVersion() ã‚’å‘¼ã³å‡ºã—ã€ãã® reqVersion.onsuccess ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§ createObjectStore() ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚createObjectStore() ã®ç¬¬ä¸€å¼•æ•°ã«ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢åã‚’ã€ç¬¬äºŒå¼•æ•°ã«ã¯ã‚­ãƒ¼åãªã©ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
// Firefox 12
reqOpen.onupgradeneeded = function(e) {
    db = reqOpen.result;
    db.createObjectStore("sample", { "keyPath": "id" });
}
// Chrome 19
reqOpen.onsuccess = function(e) {
    db = reqOpen.result;
    var reqVersion = db.setVersion(ver);
    reqVersion.onsuccess = function() {
        db.createObjectStore("sample", { "keyPath": "id" });
    }
}
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹</h5>
<div class=i>
<p>db.transaction() ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã€transaction.objectStore() ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆã‚¢ã‚’å¾—ãŸå¾Œã€add() ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã™ã€‚æˆåŠŸæ™‚ã«ã¯ onsuccess, å¤±æ•—æ™‚ã«ã¯ onerror ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
var data = { "id": 1, "name": "Yamada", "age": 18, "addr": "Tokyo" };
var transaction = db.transaction(["sample"], IDBTransaction.READ_WRITE);
var store = transaction.objectStore("sample");
var reqAdd = store.add(data);
reqAdd.onsuccess = function(e) { ... };
reqAdd.onerror = function(e) { ... };
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã™ã‚‹</h5>
<div class=i>
<p>ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã™ã‚‹ã«ã¯ get() ã‚’ç”¨ã„ã¾ã™ã€‚å¼•æ•°ã«ã¯ã‚­ãƒ¼å€¤ã‚’æŒ‡å®šã—ã¾ã™ã€‚çµæœã¯ onsuccess ãƒãƒ³ãƒ‰ãƒ©ã§å‚ç…§ã—ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
var transaction = db.transaction(["sample"], IDBTransaction.READ_ONLY);
var store = transaction.objectStore("sample");
var reqGet = store.get(1);
reqGet.onsuccess = function(e) {
    var data = reqGet.result;
    print("DATA : " + data.id + " / " + data.name + " / " + data.age + " / " + data.addr);
}
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§ã‚’å¾—ã‚‹</h5>
<div class=i>
<p>ãƒ‡ãƒ¼ã‚¿ã®ä¸€è¦§ã‚’å¾—ã‚‹ã«ã¯ openCursor() ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚å¤ã„ä»•æ§˜ã§ã¯ getAll() ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€å»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
var transaction = db.transaction(["sample"], IDBTransaction.READ_ONLY);
var store = transaction.objectStore("sample");
var reqGet = store.openCursor();
reqGet.onsuccess = function(e) {
    var cursor = reqGet.result;
    var key = cursor.key;
    var value = cursor.value;
    print("DATA : " + key + " / " + value.name + " / " + value.age + " / " + value.addr);
    cursor.continue();
}
</pre>
</div>
<h5>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹</h5>
<div class=i>
<p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹ã«ã¯ deleteDatabase() ã‚’ç”¨ã„ã¾ã™ã€‚</p>
<div class="tab">JavaScript</div>
<pre class=c2>
var reqDelete = indexedDB.deleteDatabase("sampleDB");
reqDelete.onsuccess = function(e) { ... };
reqDelete.onerror = function(e) { ... };
reqDelete.onblocked = function(e) { ... };
</pre>
</div>

<h4>ãƒªãƒ³ã‚¯</h4>
<div class=i>
<ul>
<li><a href="javascript:if(confirm('http://www.w3.org/TR/IndexedDB/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://www.w3.org/TR/IndexedDB/'" tppabs="http://www.w3.org/TR/IndexedDB/">http://www.w3.org/TR/IndexedDB/</a>
<li><a href="javascript:if(confirm('https://developer.mozilla.org/en/tec1.htm  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='https://developer.mozilla.org/en/tec1.htm'" tppabs="https://developer.mozilla.org/en/IndexedDB">https://developer.mozilla.org/en/IndexedDB</a>
<!--
<li><a href="http://nparashuram.com/IndexedDB/trialtool/index.html">http://nparashuram.com/IndexedDB/trialtool/index.html</a>
<li><a href="http://gisted.heroku.com/1045816/IndexDB-demo3.html">http://gisted.heroku.com/1045816/IndexDB-demo3.html</a>
<li><a href="http://mzsm.me/2011/12/16/indexeddb-201112/">http://mzsm.me/2011/12/16/indexeddb-201112/</a>
-->
</ul>
</div>

<hr>
<div>Copyright (C) 2012-2017 æœç”«ã€…</div>
<div>åˆç‰ˆï¼š2012å¹´5æœˆ17æ—¥ã€æœ€çµ‚æ›´æ–°ï¼š2017å¹´12æœˆ31æ—¥</div>
<div>http://www.tohoho-web.com/html5/indexed_db_api.html</div>
</body>
</html>

