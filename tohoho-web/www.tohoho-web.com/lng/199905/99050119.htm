<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<title>ＮＰＨでチャットログ更新</title>
<link rel="stylesheet" href="../style.css" tppabs="http://www.tohoho-web.com/lng/style.css">
</head>
<body>
<h3>ＮＰＨでチャットログ更新</h3>
<a href="index.htm" tppabs="http://www.tohoho-web.com/lng/199905/index.htm">[上に]</a>
<a href="99050118.htm" tppabs="http://www.tohoho-web.com/lng/199905/99050118.htm">[前に]</a>
<a href="99050120.htm" tppabs="http://www.tohoho-web.com/lng/199905/99050120.htm">[次に]</a>
<hr>
<span class=name>ぱよ☆</span>
<span class=email><a href="mailto:payo@studio-critt.com">[E-Mail]</a></span>
<span class=time>1999/05/21(金) 11:57:54</span><br>
いつも質問ばかりで恐縮です。<br>
<br>
　現在自分で組んでいるチャットスクリプトでネスケ専用に<br>
ＮＰＨ対応のモードを設けようかと思っています。ＮＰＨを利用<br>
しての更新をするとしたらwhile文で無限ループを作って、更新<br>
をチェックするのは分かるんですが、このスクリプトを起動した<br>
ユーザーが何らかの理由で落ちてしまった場合、サーバー上で<br>
ループし続けてしまうんでしょうか？<br>
もし、そうだとしたら、タイムアウトか何かで監視する必要が<br>
あると思うのですが...何か良い方法があったら教えて下さい。<br>
宜しくお願いいたします。<br>
<hr>
<span class=name>なえ</span>
<span class=time>1999/05/21(金) 12:07:30</span><br>
とほほさんのNPHスクリプトのサンプルの場合は、<br>
unless (print ""){<br>
last;<br>
}<br>
という具合にprintできなかったら抜けるようにしてます。<br>
多分これで大丈夫だと思いますけど、私もちょっと試して見ます。<br>
<hr>
<span class=name>なえ</span>
<span class=time>1999/05/21(金) 12:46:15</span><br>
linux+Apacheの環境ですとちゃんと終了しました。<br>
WIN+AnHTTPdだと処理が終了せず残っちゃいました。<br>
<hr>
<span class=name>ぱよ☆</span>
<span class=email><a href="mailto:payo@studio-critt.com">[E-Mail]</a></span>
<span class=time>1999/05/21(金) 16:34:35</span><br>
　なえさん、わざわざ確認までしていただきまして本当に<br>
ありがとうございます。わたしが利用しているサーバーは<br>
UNIX+Apacheだったと思うので、恐らくこれで大丈夫でしょう。<br>
<br>
<font color="#CC8000">&gt;WIN+AnHTTPdだと処理が終了せず残っちゃいました。</font><br>
このような場合、管理者サイドでなにか作業をするまで<br>
残り続けてしまうものなのでしょうか？<br>
初歩的な質問かもしれません(^^;)スミマセン。<br>
<br>
　それから、もし確実に終了させる方法があれば教えて<br>
頂きたいのですが... 難しいのでしょうか。<br>
よろしくお願いします。<br>
<hr>
<span class=name>なえ</span>
<span class=time>1999/05/21(金) 18:10:20</span><br>
処理が残っちゃった場合、killするしかありません。(WIN系ならタスクマネージャー開いて終了)<br>
また、確実に終了させる方法については調べてみます。<br>
ちなみにSunOSでもちゃんと終了しました。<br>
WIN＋AnHTTPdが特殊なんじゃないかと思うんですが．．．<br>
<hr>
<span class=name>とほほ</span>
<span class=time>1999/05/22(土) 02:09:05</span><br>
私の環境(Win95+AnHTTPD v1.08)だと、正常に終了してくれます。<br>
はてさて・・・<br>
<hr>
<span class=name>ぱよ☆</span>
<span class=email><a href="mailto:payo@studio-critt.com">[E-Mail]</a></span>
<span class=time>1999/05/24(月) 08:21:58</span><br>
　なえさん、とほほさん、動作確認(?) 本当にありがとうございます！！<br>
え〜、とりあえずのところ、「print = ""」を利用する事で処理が中断<br>
できるだろうと判断して作業を続けてみます。<br>
　ところで、ここまで来てふと疑問が出来てしまったのですが、<br>
既に一つのＮＰＨスクリプトを動作させたユーザーが再度同じ<br>
スクリプトを起動しようとした場合、同じスクリプトが二つ常駐<br>
してしまうのでしょうか。それともどちらかのスクリプトが優先<br>
されて片方は終了させられるのでしょうか。<br>
　チャットで書き込みの処理をした後、更新されたログを表示<br>
するようにしてしまう事が問題になるかどうか不安なもので...<br>
AnHTTPdというのはローカルのＰＣでＣＧＩが使えるヤツですよね。<br>
わたしも挑戦してみようかな。電話代も助かるし...(^^;)<br>
<hr>
<span class=name>なえ</span>
<span class=time>1999/05/24(月) 09:55:15</span><br>
既に一つのＮＰＨスクリプトを動作させたユーザーが再度同じ<br>
<font color="#CC8000">&gt;スクリプトを起動しようとした場合、同じスクリプトが二つ常駐</font><br>
<font color="#CC8000">&gt;してしまうのでしょうか。それともどちらかのスクリプトが優先</font><br>
<font color="#CC8000">&gt;されて片方は終了させられるのでしょうか。</font><br>
<font color="#CC8000">&gt;　チャットで書き込みの処理をした後、更新されたログを表示</font><br>
<font color="#CC8000">&gt;するようにしてしまう事が問題になるかどうか不安なもので...</font><br>
その場合、古いほうの処理は終了します。<br>
linux+Apacheで確認しました。<br>
<br>
それから確実に終了させる方法ですが、一定の時間が過ぎたらtimeoutさせるのはどうでしょうか？<br>
処理の先頭で<br>
$timeout = 60*30;<br>
$start_time = time;<br>
としておき、ループの終了判定を<br>
unless (print ""){<br>
last;<br>
}<br>
if (time &gt; $start_time + $timeout){<br>
last;<br>
}<br>
という具合に２段構えにするんです。<br>
これだとうちのWIN+AnHTTPdでもちゃんと終了しました。<br>
ただこれだとタイムアウトされちゃったらログ表示画面が更新されないので、<br>
クライアントプルと組み合わせる必要があります。<br>
HTMLのHEAD部分に&lt;META HTTP-EQUIV="Refresh" CONTENT="3"&gt;で<br>
タイムアウトになっても３秒後に再起動かかります。<br>
<br>
なお、これ調べててわかったのですが、メタタグのRefreshで指定した時間の基準は<br>
IEとネスケで違うようです。<br>
IEはページの読み込みが開始してからの時間ですが、<br>
ネスケは読み込みが完了してからの時間のようです。<br>
<hr>
<span class=name>ぱよ☆</span>
<span class=email><a href="mailto:payo@studio-critt.com">[E-Mail]</a></span>
<span class=time>1999/05/24(月) 10:51:15</span><br>
<span class=resolv>[[解決]]</span><br>
　なえさん、本当にありがとうございます。<br>
とても有意義な返答が頂けて感激しています(^-^)<br>
早速、今晩にでも参考にして作業をしてみようと思います。<br>
いちお解決にしておきますね。<br>
<br>
　なえさん、とほほさん、本当にありがとうございました。<br>
<br>
＃しかしＩＥとＮＮ（ＮＣ）って、結構違いが沢山あって<br>
　困りますね...(^^;)<br>
<hr>
<a href="index.htm" tppabs="http://www.tohoho-web.com/lng/199905/index.htm">[上に]</a>
<a href="99050118.htm" tppabs="http://www.tohoho-web.com/lng/199905/99050118.htm">[前に]</a>
<a href="99050120.htm" tppabs="http://www.tohoho-web.com/lng/199905/99050120.htm">[次に]</a>
</body>
</html>
