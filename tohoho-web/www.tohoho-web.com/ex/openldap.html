<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8"utf-8">
<title>OpenLDAPãƒ¡ãƒ¢ - ã¨ã»ã»ã®WWWå…¥é–€</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="../style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>OpenLDAPãƒ¡ãƒ¢</h2>
<a href="../www.htm" tppabs="http://www.tohoho-web.com/www.htm">ãƒˆãƒƒãƒ—</a> &gt;
OpenLDAPãƒ¡ãƒ¢

<h4>ç’°å¢ƒ</h4>
<div class="i">
<ul>
<li>å®Ÿæ–½æ—¥: 2016å¹´6æœˆ4æ—¥</li>
<li>ãƒ›ã‚¹ãƒˆOS: Windows 10</li>
<li>ã‚²ã‚¹ãƒˆOS: CentOS 6.8</li>
<li>ãƒã‚¤ãƒ‘ãƒ¼ãƒã‚¤ã‚¶: VirtualBox 5.0.12</li>
<li>OpenLDAP: OpenLDAP</li>
</ul>
</div>

<h4>å‚è€ƒ</h4>
<div class="i">
<p>ä¸‹è¨˜ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚</p>
<ul>
<li><a href="javascript:if(confirm('http://www.unix-power.net/linux/openldap.html  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://www.unix-power.net/linux/openldap.html'" tppabs="http://www.unix-power.net/linux/openldap.html">CentOS6 OpenLDAPã®è¨­å®š</a> (by UnixPower on Networking)
</ul>
</div>

<h4>OpenLDAP ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h4>
<div class="i">
<pre class="dos">
<span class="cm">OpenLDAP ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</span>
# yum -y install openldap-servers openldap-clients

<span class="cm">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æš—å·åŒ–ã—ã¦ãŠã</span>
# slappasswd
New password:
Re-enter new password:
{SSHA}l3lUgv5JrcNV0fwIEqPa93Ybielmvp3z

<span class="cm">ã‚³ãƒ³ãƒ•ã‚£ã‚°è¨­å®šã™ã‚‹</span>
<span class="cm">OpenLDAP 2.3 ä»¥é™ã§ã¯ã€slapd.conf ã‚’ä½¿ç”¨ã›ãšã€/etc/openldap/slapd.d/cn=config é…ä¸‹ã®ã‚¨ãƒ³ãƒˆãƒªã‚’</span>
<span class="cm">ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã•ã‚ŒãŸã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ•ã‚£ã‚°è‡ªä½“ã‚‚ LDAP çµŒç”±ã§ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã«ãƒªãƒ¢ãƒ¼ãƒˆã‹ã‚‰ã§ã‚‚å¤‰æ›´å¯èƒ½ã¨ãªã£ãŸãŒã€</span>
<span class="cm">é¢å€’ãªã®ã§ã€ä»Šå›ã¯ slapd.conf ã‚’ç”¨ã„ã¦åˆæœŸè¨­å®šã™ã‚‹ã€‚</span>

# cp -p /usr/share/openldap-servers/slapd.conf.obsolete /etc/openldap/slapd.conf
# vi /etc/openldap/slapd.conf

suffix          "dc=<em>example</em>,dc=com"
rootdn          "cn=Manager,dc=<em>example</em>,dc=com"
rootpw          <em>{SSHA}l3lUgv5JrcNV0fwIEqPa93Ybielmvp3z</em>

# vi /etc/sysconfig/ldap

SLAPD_OPTIONS=<em>"-f /etc/openldap/slapd.conf"</em>

<span class="cm">ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹</span>
# chkconfig slapd on
# service slapd start

<span class="cm">æ¥ç¶šã§ãã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚</span>
# ldapsearch -x -LLL -D 'cn=Manager,dc=example,dc=com' -W -b 'dc=example,dc=com' '(objectClass=*)'
Enter LDAP Password:
No such object (32)
</pre>
</div>

<h4>ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹</h4>
<div class="i">
<pre class="dos">
<span class="cm">åŸºæœ¬ã‚¨ãƒ³ãƒˆãƒªã‚’ç™»éŒ²ã™ã‚‹</span>

# vi init.ldif

dn: dc=example,dc=com
objectclass: dcObject
objectclass: organization
o: VIRTUAL CORPORATION
dc: example

dn: cn=Manager,dc=example,dc=com
objectclass: organizationalRole
cn: Manager

# ldapadd -x -W -D "cn=Manager,dc=example,dc=com" -f init.ldif

<span class="cm">Users, Groups, Computers ã‚’ç™»éŒ²ã™ã‚‹</span>

# vi add.ldif

dn: ou=Users,dc=example,dc=com
objectclass: organizationalUnit
ou: Users

dn: ou=Groups,dc=example,dc=com
objectclass: organizationalUnit
ou: Groups

dn: ou=Computers,dc=example,dc=com
objectclass: organizationalUnit
ou: Computers

# ldapadd -x -W -D "cn=Manager,dc=example,dc=com" -f add.ldif

<span class="cm">ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</span>

# vi groupadd.ldif

dn: cn=develop,ou=Groups,dc=example,dc=com
objectClass: posixGroup
cn: develop
gidNumber: 1000

dn: cn=sales,ou=Groups,dc=example,dc=com
objectClass: posixGroup
cn: sales
gidNumber: 1001

dn: cn=market,ou=Groups,dc=example,dc=com
objectClass: posixGroup
cn: market
gidNumber: 1002

# ldapadd -x -W -D "cn=Manager,dc=example,dc=com" -f groupadd.ldif

<span class="cm">ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹</span>

# vi useradd.ldif

dn: uid=takeda,ou=Users,dc=example,dc=com
objectclass: posixAccount
objectclass: inetOrgPerson
sn: takeda
cn: kazuma
displayName: Takeda Kazuma
uid: takeda
uidNumber: 1000
gidNumber: 1000
homeDirectory: /home/takeda
loginShell: /bin/bash
userPassword: {CRYPT}B5fKzlwfatuy2
mail: takeda@example.com

dn: uid=suzuki,ou=Users,dc=example,dc=com
objectclass: posixAccount
objectclass: inetOrgPerson
sn: suzuki
cn: hajime
displayName: Suzuki Hajime
uid: suzuki
uidNumber: 1001
gidNumber: 1000
homeDirectory: /home/suzuki
loginShell: /bin/bash
userPassword: {CRYPT}B5fKzlwfatuy2
mail: suzuki@example.com

dn: uid=tanaka,ou=Users,dc=example,dc=com
objectclass: posixAccount
objectclass: inetOrgPerson
sn: tanaka
cn: takuya
displayName: Tanaka Takuya
uid: tanaka
uidNumber: 1002
gidNumber: 1000
homeDirectory: /home/tanaka
loginShell: /bin/bash
userPassword: {CRYPT}B5fKzlwfatuy2
mail: tanaka@example.com

# ldapadd -x -W -D "cn=Manager,dc=example,dc=com" -f useradd.ldif
</pre>
</div>

<h4>ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã™ã‚‹</h4>
<div class="i">
<pre class="dos">
<span class="cm">ãƒ¦ãƒ¼ã‚¶æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹</span>

# ldapsearch -x -W -D "cn=Manager,dc=example,dc=com" -b "ou=Users,dc=example,dc=com" -s sub

 -x ç°¡æ˜“èªè¨¼
 -W ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰å…¥åŠ›
 -D èªè¨¼ã«ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶æƒ…å ±
 -b æ¤œç´¢ã®èµ·ç‚¹
 -s æ¤œç´¢ç¯„å›² base | one | sub
</pre>
</div>

<h4>Python ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹</h4>
<div class="i">
<pre class="dos">
# yum -y install python python-ldap python-setuptools
# easy_install pit
# vi pyldap.py

import ldap,ldif
import sys,optparse,getpass

lo = ldap.initialize("ldap://localhost")
lo.simple_bind_s("cn=Manager,dc=example,dc=com", "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰")
result = lo.search_s("dc=example,dc=com", ldap.SCOPE_SUBTREE)
ldif_writer = ldif.LDIFWriter(sys.stdout)
for dn, entry in result:
    ldif_writer.unparse(dn,entry)

# python pyldap.py
</pre>
</div>

<hr>
<div>Copyright (C) 2016 æœç”«ã€…</div>
<div>åˆç‰ˆ:2016å¹´6æœˆ4æ—¥ æœ€çµ‚æ›´æ–°:2016å¹´6æœˆ4æ—¥</div>
<div>http://www.tohoho-web.com/ex/openldap.html</div>
</body>
</html>
