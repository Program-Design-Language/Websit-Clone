<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8"utf-8">
<title>ã¨ã»ã»ã®Promiseå…¥é–€ - ã¨ã»ã»ã®WWWå…¥é–€</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="../style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>ã¨ã»ã»ã®Promiseå…¥é–€</h2>
<a href="../www.htm" tppabs="http://www.tohoho-web.com/www.htm">ãƒˆãƒƒãƒ—</a> &gt;
<a href="../wwwxx.htm" tppabs="http://www.tohoho-web.com/wwwxx.htm">ã‚¢ãƒ©ã‚«ãƒ«ãƒˆ</a> &gt;
ã¨ã»ã»ã®Promiseå…¥é–€

<h4 id="whatid">Promiseã¨ã¯</h4>
<div class=i>
<p>Promise ã¯ã€JavaScript ã‚„ Node.js ã«ãŠã„ã¦ã€éåŒæœŸå‡¦ç†ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã«è¨˜è¿°ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚è‹±èªã® promise ã¯ã€ã€Œåˆ¶ç´„ã€ã€ã€Œä¿éšœã€ãªã©ã®æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚Promise ã¯ã€Chrome 63, Firefox 58, Safari 11.1, Edge 18, Node.js 4.* ã‹ã‚‰åˆ©ç”¨å¯èƒ½ã§ã™ã€‚IE11 ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
</div>

<h4 id="callback_hell">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„</h4>
<div class=i>
<p>JavaScript ã‚„ Node.js ã§ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹(å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§å¾…ã¡åˆã‚ã›ã‚‹)é–¢æ•°ã‚ˆã‚Šã‚‚ã€éåŒæœŸé–¢æ•°(å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã€å‡¦ç†ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹)ã®æ–¹ãŒå¤šæ§˜ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã€ä¾‹ãˆã°ã€è†¨å¤§ãªæ¼”ç®—(å®Ÿã¯å˜ã«å…ƒã®æ•°ã‚’2å€ã™ã‚‹ã ã‘)ã‚’è¡Œã†éåŒæœŸé–¢æ•° aFunc1() ãŒã‚ã‚‹ã¨ã—ã¾ã™ã€‚ä¸‹è¨˜ã¯ã€100ã®2å€ã‚’æ±‚ã‚ã‚‹éåŒæœŸé–¢æ•°ã®ä½¿ç”¨ä¾‹ã§ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
<span class="cm">// å¼•æ•°ã‚’2å€ã«ã™ã‚‹éåŒæœŸé–¢æ•°</span>
function aFunc1(data, callback) {
    setTimeout(function() {
        callback(data * 2);
    }, Math.random() * 1000);
}
</pre>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_callback() {
    <span class="cm">// éåŒæœŸé–¢æ•°ã‚’ç”¨ã„ã¦100ã®2å€ã‚’æ±‚ã‚ã‚‹</span>
    aFunc1(100, function(value) {
        console.log(value);      <span class="comment">// =&gt; 200</span>
    });
}
</pre>
<p>å˜ç´”ã«éåŒæœŸé–¢æ•°ã‚’1å›ã ã‘å‘¼ã³å‡ºã™ã®ã§ã‚ã‚Œã°ã€ä¸Šè¨˜ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€1å›ç›®ã§å¾—ã‚‰ã‚ŒãŸå€¤ã‚’ç”¨ã„ã¦ã€aFunc1() ã‚’2åº¦ã€3åº¦å‘¼ã³å‡ºãã†ã¨ã™ã‚‹ã¨ã€ä¸‹è¨˜ã®æ§˜ãªå®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_callback_hell() {
    aFunc1(100, function(data) {
        console.log(data);                  <span class="comment">// =&gt; 200</span>
        aFunc1(data, function(data) {
            console.log(data);              <span class="comment">// =&gt; 400</span>
            aFunc1(data, function(data) {
                console.log(data);          <span class="comment">// =&gt; 800</span>
            });
        });
    });
}
</pre>
<p>å‘¼ã³å‡ºã™å›æ•°ã«æ¯”ä¾‹ã—ã¦ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ãƒã‚¹ãƒˆãŒæ·±ããªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ã€ã€Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã€ã¨å‘¼ã³ã¾ã™ã€‚</p>
</div>

<h4 id="timing-problem">ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ</h4>
<div class=i>
<p>éåŒæœŸé–¢æ•°ã¯ã¾ãŸã€å‡¦ç†ã®é †åºã‚’åˆ¶å¾¡ã§ããªã„ã¨ã„ã†å•é¡Œã‚‚å«ã¿ã¾ã™ã€‚ä¸‹è¨˜ã®ä¾‹ã§ã¯ã€100ã®2å€ã€200ã®2å€ã€400ã®2å€ã‚’æ±‚ã‚ã‚ˆã†ã¨ã—ãŸã«ã‚‚é–¢ã‚ã‚‰ãšã€å‡¦ç†çµæœã¯ 200, 400, 800 ã ã£ãŸã‚Šã€800, 200, 400 ãªã©ã€çµæœå‡¦ç†ãŒé †ä¸åŒã¨ãªã‚‹ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_timing_problem() {
    aFunc1(100, function(data) {
        console.log(data);      <span class="comment">// =&gt; 200</span>
    });
    aFunc1(200, function(data) {
        console.log(data);      <span class="comment">// =&gt; 400</span>
    });
    aFunc1(400, function(data) {
        console.log(data);      <span class="comment">// =&gt; 800</span>
    });
}
</pre>
</div>

<h4 id="promise">Promiseã«ã‚ˆã‚‹è§£æ±º</h4>
<div class=i>
<p>ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«è€ƒæ¡ˆã•ã‚ŒãŸã®ãŒ Promise ã§ã™ã€‚Promise ã¯ã€ç´„æŸã€èª“ç´„ã€ä¿è¨¼ãªã©ã®æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚Promise ã¯ã€å¾…æ©Ÿ(pending)ã€æˆåŠŸ(fulfilled)ã€å¤±æ•—(rejected)ã®3å€¤ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚å‰è¿°ã®éåŒæœŸé–¢æ•° aFunc1() ã‚’ Promise ã‚’ç”¨ã„ã¦æ›¸ãç›´ã™ã¨ä¸‹è¨˜ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚å‡¦ç†ã‚’è¡Œã†é–¢æ•°ã‚’å¼•æ•°ã¨ã—ãŸ Promise ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function aFunc2(data) {
    return <em>new Promise(function(callback)</em> {
        setTimeout(function() {
            callback(data * 2);
        }, Math.random() * 1000);
    });
}
</pre>
<p>Promise ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ then(ok_callback, ng_callback) ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¡ã¾ã™ã€‚then() ã¯ã€Promise ãŒæˆåŠŸã¾ãŸã¯å¤±æ•—ã«ãªã‚‹ã¾ã§å‡¦ç†ã‚’å—ã‘æµã—ã€æˆåŠŸæ™‚ã« ok_callback ã‚’ã€å¤±æ•—æ™‚ã« ng_callback ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨ã—ã¦å‘¼ã³å‡ºã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_promise() {
    aFunc2(100).<em>then(function(data) {</em>
        console.log(data);      <span class="comment">// =&gt; 200</span>
    <em>});</em>
}
</pre>
<p>ã‚¢ãƒ­ãƒ¼é–¢æ•°ã‚’ç”¨ã„ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ã‚‚è¨˜è¿°ã§ãã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_promise2() {
    aFunc2(100).<em>then((data) =&gt; {</em>
        console.log(data);      <span class="comment">// =&gt; 200</span>
    <em>});</em>
}
</pre>
<p>ã•ã‚‰ã«å‡¦ç†ã‚’ç¶™ç¶šã™ã‚‹ã«ã¯ã€ä¸‹è¨˜ã®æ§˜ã«ã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_promise3() {
    aFunc2(100).then((data) =&gt; {
        console.log(data);      <span class="comment">// =&gt; 200</span>
        <em>return aFunc2(data);</em>
    })
    <em>.then((data) =&gt; {</em>
        console.log(data);      <span class="comment">// =&gt; 400</span>
        <em>return aFunc2(data);</em>
    })
    <em>.then((data) =&gt; {</em>
        console.log(data);      <span class="comment">// =&gt; 800</span>
    <em>});</em>
}
</pre>
</div>

<h4 id="error">ã‚¨ãƒ©ãƒ¼å‡¦ç†</h4>
<div class=i>
<p>Promise ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã«ã¤ã„ã¦è€ƒå¯Ÿã—ã¾ã™ã€‚ä¸‹è¨˜ã¯ã€ç´„ 30% ã®ç¢ºç‡ã§ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ Promise éåŒæœŸé–¢æ•°ã§ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function aFunc3(data) {
    return new Promise(function(okCallback, ngCallback) {
        setTimeout(function() {
            <em>if (Math.random() &lt; 0.30) {
                ngCallback(new Error('ERROR!'));
            } else {</em>
                okCallback(data * 2);
            }
        }, Math.random() * 1000);
    });
}
</pre>
<p>.then() ã¯ç¬¬ä¸€å¼•æ•°ã«æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã€ç¬¬äºŒå¼•æ•°ã«å¤±æ•—æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã‚¨ãƒ©ãƒ¼ã‚’è€ƒæ…®ã—ãŸå‘¼ã³å‡ºã—å…ƒã¯ä¸‹è¨˜ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_reject() {
    aFunc3(100).then(
        (data) =&gt; { console.log(data); },    <span class="comment">// æˆåŠŸæ™‚ã®å‡¦ç†</span>
        <em>(e) =&gt; { console.log(e); }</em>           <span class="comment">// å¤±æ•—æ™‚ã®å‡¦ç†</span>
    );
}
</pre>
<p>ä¸Šè¨˜ã¯ã€ä¸‹è¨˜ã®æ§˜ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚.catch(ng_callback) ã¯ã€.then(undefined, ng_callback) ã¨åŒã˜æ„å‘³ã‚’æŒã¡ã¾ã™ã€‚Promise ã¯ä¸€åº¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨ã€æœ€åˆã« ng_callback é–¢æ•°ãŒæŒ‡å®šã•ã‚Œã‚‹ã¾ã§ã€then å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_catch() {
    aFunc3(100).then((data) =&gt; {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) =&gt; {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) =&gt; {
        console.log(data);
    })
    <em>.catch((e) =&gt; {
        console.log(e);
    });</em>
}
</pre>
</div>

<h4 id="error_with_throw">throwã‚’ä¼´ã†ã‚¨ãƒ©ãƒ¼å‡¦ç†</h4>
<div class=i>
<p>.catch() ã¯ã¾ãŸã€å‡¦ç†ä¸­ã«ç™ºç”Ÿã—ãŸ throw ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ä¸‹è¨˜ã®ä¾‹ã§ã¯ã€aFunc3() å†…éƒ¨ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚„ã€2ç•ªç›®ã®å‡¦ç†ã§ç™ºç”Ÿã—ãŸä¾‹å¤–ã‚’ .catch() ãŒå—ã‘æ­¢ã‚ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_catch_with_throw() {
    aFunc3(100).then((data) =&gt; {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) =&gt; {
        console.log(data);
        <em>throw new Error('ERROR!!!');</em>
    })
    .then((data) =&gt; {
        console.log(data);
    })
    <em>.catch((e) =&gt; {
        console.log(e);
    });</em>
}
</pre>
</div>

<h4 id="finally">Finally</h4>
<div class=i>
<p>.catch() ã®å¾Œã‚ã« .then() ã‚’åŠ ãˆã‚‹ã“ã¨ã§ã€æˆåŠŸæ™‚ã«ã‚‚ã€å¤±æ•—æ™‚ã«ã‚‚å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ Finally ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_finally() {
    aFunc3(100).then((data) =&gt; {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) =&gt; {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) =&gt; {
        console.log(data);
    })
    .catch((e) =&gt; {
        console.log(e);
    })
    <em>.then(() =&gt; {
        console.log('*** Finally ***');
    });</em>
}
</pre>
<p><a href="../js/what.htm#es2018" tppabs="http://www.tohoho-web.com/js/what.htm#es2018">ES2018(ES9)</a> ã§ã¯ã€.finally() ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚</p>
<pre class="c2">
function sample_finally2() {
    aFunc3(100).then((data) => {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) => {
        console.log(data);
        return aFunc3(data);
    })
    .then((data) => {
        console.log(data);
    })
    .catch((e) => {
        console.log("catch");
        console.log(e);
    })
    <em>.finally(() => {
        console.log('*** Finally ***');
    });</em>
}
</pre>
</div>

<h4 id="promise-all">ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸã‚‰(Promise.all())</h4>
<div class=i>
<p>Promise.all() ã¯é…åˆ—ã§æŒ‡å®šã•ã‚ŒãŸã™ã¹ã¦ã® Promise ã‚¿ã‚¹ã‚¯ã‚’å¾…ã¡åˆã‚ã›ã€ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ .then() ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function taskA() {
    return new Promise((callback) =&gt; {
        console.log("taskA start.");
        setTimeout(function() {
            console.log("taskA end.");
            callback();
        }, Math.random() * 3000);
    });
}
function taskB() {
    return new Promise((callback) =&gt; {
        console.log("taskB start.");
        setTimeout(function() {
            console.log("taskB end.");
            callback();
        }, Math.random() * 3000);
    });
}
function sample_all() {
    p1 = taskA();
    p2 = taskB();
    <em>Promise.all([p1, p2]).then(() =&gt; {
        console.log("taskA and taskB are finished.");
    });</em>
}
</pre>
</div>

<h4 id="promise-race">ã„ãšã‚Œã‹ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸã‚‰(Promise.race())</h4>
<div class=i>
<p>Promise.race() ã¯é…åˆ—ã§æŒ‡å®šã•ã‚ŒãŸ Promise ã‚¿ã‚¹ã‚¯ã‚’å¾…ã¡åˆã‚ã›ã€ã„ãšã‚Œã‹ã²ã¨ã¤ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸæ™‚ç‚¹ã§ã€.then() ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
function sample_race() {
    p1 = taskA();
    p2 = taskB();
    <em>Promise.race([p1, p2]).then(() =&gt; {
        console.log("taskA or task B is finished.");
    });</em>
}
</pre>
</div>

<h4 id="promise-allSettled">ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšå®Œäº†ã—ãŸã‚‰(Promise.allSettled())</h4>
<div class="i">
<p><a href="#promise-all">Promise.all()</a> ã§ã¯ã€æŒ‡å®šã—ãŸã‚¿ã‚¹ã‚¯ã®ã„ãšã‚Œã‹ä¸€ã¤ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¨ãã“ã§å¾…ã¡åˆã‚ã›ã‚’å®Œäº†ã—ã¦ã—ã¾ã„ã¾ã™ãŒã€<a href="javascript:if(confirm('http://div.wifi-cloud.jp/redir/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://div.wifi-cloud.jp/redir/#es2020'" tppabs="http://www.tohoho-web.com/ex/what.htm#es2020">ES2020</a> ã§ã‚µãƒãƒ¼ãƒˆã•ã‚ŒãŸ <b>Promise.allSettled()</b> ã‚’ç”¨ã„ã‚‹ã¨ã€ã‚¿ã‚¹ã‚¯ãŒã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã‚‚ã€ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒæˆåŠŸçµ‚äº†ã™ã‚‹ã‹ã€ã‚¨ãƒ©ãƒ¼çµ‚äº†ã™ã‚‹ã¾ã§ã€å‡¦ç†ã‚’å¾…ã¡åˆã‚ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
p1 = Promise.resolve("OK1");
p2 = Promise.reject("NG2");
p3 = Promise.resolve("OK3");
<em>Promise.allSettled(</em>[p1, p2, p3]<em>)</em>.then(
   resolveList => resolveList.forEach(res => console.log(res)),
   rejectList  => rejectList.forEach(rej => console.log(rej))
);
<span class="cm">// =&gt; <i>{status: "fulfilled", value: "OK1"}</i></span>
<span class="cm">// =&gt; <i>{status: "rejected", reason: "NG2"}</i></span>
<span class="cm">// =&gt; <i>{status: "fulfilled", value: "OK3"}</i></span>
</pre>
</div>

<h4 id="async-await">éåŒæœŸé–¢æ•°ã‚’åŒæœŸé–¢æ•°ã£ã½ãå‘¼ã³å‡ºã™(async/await)</h4>
<div class=i>
<p><a href="../js/what.htm#version" tppabs="http://www.tohoho-web.com/js/what.htm#version">ES2017</a> ã§ã¯ã€Promise ã«åŠ ãˆã€async/await ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚ã“ã¡ã‚‰ã‚‚ã€Internet Explorer ã‚’é™¤ãå¤§åŠã®ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚async ã¨ await ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€Promise ã«å¯¾å¿œã—ãŸéåŒæœŸé–¢æ•°ã‚’ã€åŒæœŸé–¢æ•°ã®æ§˜ã«å‘¼ã³å‡ºã™ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚åŒæœŸé–¢æ•°ã®æ§˜ã«å‘¼ã³å‡ºã—ãŸã„éåŒæœŸé–¢æ•°ã‚’å‘¼ã³å‡ºã™éš›ã« await ã‚’ã¤ã‘ã¾ã™ã€‚await ã‚’å‘¼ã³å‡ºã™é–¢æ•°ã« async ã‚’ã¤ã‘ã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
<em>async</em> function sample_async_await() {
    var val = 100;
    val = <em>await</em> aFunc2(val);
    console.log(val);                    <span class="cm">// 200</span>
    val = <em>await</em> aFunc2(val);
    console.log(val);                    <span class="cm">// 400</span>
    val = <em>await</em> aFunc2(val);
    console.log(val);                    <span class="cm">// 800</span>
}
</pre>
<p>ã‚¨ãƒ©ãƒ¼å‡¦ç†ã«å¯¾å¿œã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ä¸‹è¨˜ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
async function sample_async_await_with_catch() {
    var val = 100;
    <em>try {</em>
        val = await aFunc3(val);
        console.log(val);
        val = await aFunc3(val);
        console.log(val);
        val = await aFunc3(val);
        console.log(val);
    <em>} catch (e) {</em>
        console.log(e);
    <em>}</em>
}
</pre>
</div>

<h4 id="for-await-of">for await ... of ...</h4>
<div class="i">
<p><a href="../js/what.htm#es2018" tppabs="http://www.tohoho-web.com/js/what.htm#es2018">ES2018(ES9)</a> ã§ã¯ã€éåŒæœŸãªã‚¤ãƒ†ãƒ©ãƒ–ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã€for await (... of ...) ã§ãƒ«ãƒ¼ãƒ—ã‚’å›ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä¾‹ãˆã°ã€ã‚µãƒ¼ãƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’1ä»¶ãšã¤èª­ã¿è¾¼ã‚€éåŒæœŸå‡¦ç†ã‚’ã€åŒæœŸå‡¦ç†ã®æ§˜ã« for ãƒ«ãƒ¼ãƒ—ã§è¨˜è¿°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚</p>
<div class="title-tab">JavaScript</div>
<pre class="c2">
var asyncIterableObject = {
  [Symbol.asyncIterator]() {
    return {
      count: 0,
      next() {
        return new Promise((callback) =&gt; {
          setTimeout(() =&gt; {
            callback({
              value: this.count,
              done: (this.count &lt; 5) ? false : true,
            })
            this.count++;
          }, Math.random() * 1000);
        });
      }
    };
  }
};

async function for_await_of() {
   <em>for await</em> (num <em>of</em> asyncIterableObject) {
     console.log(num);                      <span class="cm">// 0, 1, 2, 3, 4</span>
   }
};
</pre>
</div>

<hr>
<div>Copyright (C) 2019-2020 æœç”«ã€…</div>
<div>åˆç‰ˆ:2019å¹´2æœˆ11æ—¥ æœ€çµ‚æ›´æ–°:2020å¹´12æœˆ27æ—¥</div>
<div>http://www.tohoho-web.com/ex/promise.html</div>
</body>
</html>
