<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>とほほのCookie入門 - とほほのWWW入門</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="stylesheet" href="style3.css" tppabs="http://www.tohoho-web.com/style3.css">
</head>
<body>
<h2>とほほのCookie入門</h2>
<a href="www.htm" tppabs="http://www.tohoho-web.com/www.htm">トップ</a> &gt;
とほほのCookie入門

<h4 id="CookieIndex">目次</h4>
<ul>
<li><a href="#CookieAbout">Cookieの概要</a></li>
<li><a href="#CookieFile">Cookie情報が保存されるファイル</a></li>
<li><a href="#CookieSample">Cookieの実行例</a></li>
<li><a href="#CookieConfig">Cookieの設定</a></li>
<li><a href="#CookieWrite">Cookieの書き込み</a></li>
<li><a href="#CookieSetSample">Cookie書き込みの例</a></li>
<li><a href="#CookieRead">Cookieの読み込み</a></li>
<li><a href="#CookieEncode">エンコードとデコード</a></li>
<li><a href="#CookieQandA">Cookieに関するQ&amp;A</a></li>
</ul>

<h4 id="CookieAbout">Cookieの概要</h4>
<div class=i>
<p><strong>Cookie</strong> とは、以下のようなことを実現するための機構です。</p>
<ul>
<li>訪問者がそのページに何回訪れたか記録して表示する。</li>
<li>通常モード、フレームモードなど、訪問者の好みを記録しておき、次回訪問時にその好みのモードで表示する。</li>
<li>掲示板やチャットで入力したユーザー名を記録しておき、次回訪問時にユーザー名の入力を省略する。</li>
<li>ログインによるセッションを維持する。</li>
</ul>
<p>下記の仕様書が公開されています。</p>
<ul>
<li>RFC2109: <a target="_top" href="javascript:if(confirm('https://tools.ietf.org/html/rfc2109  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tools.ietf.org/html/rfc2109'" tppabs="https://tools.ietf.org/html/rfc2109">https://tools.ietf.org/html/rfc2109</a> (1997年2月)
<li>RFC2965: <a target="_top" href="javascript:if(confirm('https://tools.ietf.org/html/rfc2965  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tools.ietf.org/html/rfc2965'" tppabs="https://tools.ietf.org/html/rfc2965">https://tools.ietf.org/html/rfc2965</a> (2000年10月)
<li>RFC6265: <a target="_top" href="javascript:if(confirm('https://tools.ietf.org/html/rfc6265  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='https://tools.ietf.org/html/rfc6265'" tppabs="https://tools.ietf.org/html/rfc6265">https://tools.ietf.org/html/rfc6265</a> (2011年4月)
</ul>
<p>上記のようなデータは CGI などを用いてサーバー側に記録することもできますが、Cookie を用いることにより、クライアント側（ブラウザを起動する側）のハードディスク内に <strong>Cookie情報</strong> と呼ばれるデータを記録することができるようになります。</p>
</div>

<h4 id="CookieFile">Cookie情報が保存されるファイル</h4>
<div class=i>
<p>Cookie情報が保存されるファイルは OS やブラウザのバージョンによって異なりますが、例えば以下のようなフォルダやファイルに記録されます。</p>
<ul>
<li>C:\Document and Settings\ユーザ名\Cookies</li>
<li>C:\Program Files\Netscape\Users\<i>UserName</i>\cookies.txt</li>
<li>C:\Program Files\Netscape\Navigator\cookies.txt</li>
<li>C:\Windows\Cookies\～.txt</li>
</ul>
</div>

<h4 id="CookieSample">Cookieの実行例</h4>
<div class=i>
<p>Cookie の実行例を次に示します。「再表示」を行うと、これまでの訪問回数と前回の訪問日が表示されます。オフラインでは動作しません。オンラインで実行してください。</p>
<ul>
<li><a href="wwwcook2.htm" tppabs="http://www.tohoho-web.com/wwwcook2.htm">JavaScriptでの例</a> （<a href="wwwcook3.htm" tppabs="http://www.tohoho-web.com/wwwcook3.htm">ソースコード</a>）</li>
<li><a href="cgi/wwwcook.cgi.htm" tppabs="http://www.tohoho-web.com/cgi/wwwcook.cgi">CGIでの例</a> （<a href="cgi/wwwcook.txt.htm" tppabs="http://www.tohoho-web.com/cgi/wwwcook.txt">ソースコード</a>）</li>
</ul>
<p>一度ページを表示すると Cookie情報がハードディスク内に書き込まれ、再度そのページにアクセスした際に Cookie情報がサーバーに送られます。</p>
</div>

<h4 id="CookieConfig">Cookieの設定</h4>
<div class=i>
<p>Cookie を受け付けるか受け付けないかの設定は以下のメニューで行います。</p>
<table class="tb1">
<tr><th class="nowrap">ブラウザ</th><th>メニュー</th></tr>
<tr><th>IE6.0</th><td>[ツール]→[インターネットオプション]→[プライバシー]</td></tr>
<tr><th>IE5.0</th><td>[ツール]→[インターネットオプション]→[セキュリティ]→[レベルのカスタマイズ]→[Cookie]</td></tr>
<tr><th>NS6.*</th><td>[編集]→[設定]→[プライバシーとセキュリティ]→[Cookie]</td></tr>
<tr><th>NS4.*</th><td>[編集]→[設定]→[詳細]→[Cookie]</td></tr>
</table>
</div>

<h4 id="CookieWrite">Cookieの書き込み</h4>
<div class=i>
<p>JavaScript を用いて Cookie を設定する場合は次のようにします。</p>
<div class="title-tab">JavaScript</div>
<pre class=c2>
document.cookie = "～";
</pre>
<p>CGI（Perl） を用いる場合は次のようにします。</p>
<div class="title-tab">Perl</div>
<pre class=c2>
print "Content-type: text/html\n";
print "Set-Cookie: ～\n";
print "\n";
</pre>
<p>HTML で指定するには次のようにします。ただし、この方法は推奨されない方式となりました。。</p>
<div class="title-tab">HTML</div>
<pre class=c2>
&lt;meta http-equiv="Set-Cookie" content="～"&gt;
</pre>
<p>～の部分には次のような文字列を指定します。</p>
<div class="tab">フォーマット</div>
<pre class=c2>
<i>NAME</i>=値; expires=値; domain=値; path=値; secure
</pre>
<p><i>NAME</i>=値; 以外は省略可能です。それぞれ、次のような意味があります。</p>
<table class="tb1">
<tr>
<th>パラメータ</th>
<th>意味</th>
</tr>
<tr>
<th><i>NAME</i>=<i>値</i></th>
<td>必須。好きな名前に好きな値を指定します。セミコロン（;）、カンマ（,）、空白文字（ ）や日本語を使用する際にはそれぞれ、何らかの形式にエンコードする必要があります。エンコードには %3B、%2C、%20 などの URL形式のエンコードがよく用いられるようです。</td>
</tr>
<tr>
<th  class="nowrap">expires=<i>値</i></th>
<td>クライアント側に記録される Cookie の有効期限を<br>
　　　Thu, 1-Jan-2030 00:00:00 GMT<br>
のような形式で指定します。タイムゾーンは必ず GMT で指定します。省略するとブラウザを終了させるまでが有効期限となります。過去の値を指定すると Cookie を削除します。</td>
</tr>
<tr>
<th class="nowrap">domain=<i>値</i></th>
<td>Cookie を発行する Webサーバーの名前を指定します。省略した場合は Webサーバー名（www.tohoho-web.com など）になります。</td>
</tr>
<tr>
<th>path=<i>値</i></th>
<td>ここで指定したパス名にマッチするページを参照したときに、ブラウザは保存しておいた Cookie情報をサーバーに送ります。例えば、path=/tanaka と指定すると、/tanaka にマッチするすべてのページに対して Cookie情報が送られます。省略時は、Cookie を設定したページのパス名部になります。</td>
</tr>
<tr>
<th>secure</th>
<td>これを記述しておくと、サーバーとの接続がセキュアである時のみ、Cookie情報が送信されるようになります。</td>
</tr>
</table>
</div>

<h4 id="CookieSetSample">Cookie書き込みの例</h4>
<div class=i>
<p>最も簡単な書き込みの例は次のようになります。これは、ブラウザが終了するまで有効で、設定したページと同じフォルダにある（もしくは下位層にある）ページに送信されます。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: NAME=tanaka;
</pre>
<p>有効期限を指定すると次のようになります。ブラウザを終了しても、OS を再起動しても、有効期限までディスクに保存されています。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: NAME=tanaka; Tue, 31-Dec-2030 23:59:59;
</pre>
</div>

<h4 id="CookieRead">Cookieの読み込み</h4>
<div class=i>
<p>JavaScriptを用いてCookieの値を読みこむには、document.cookie の値を参照します。解釈方法は上記のサンプルコードを参照してください。</p>
<div class="tab">JavaScript</div>
<pre class=c2>
alert(document.cookie);
</pre>
<p>CGI（Perl）でCookieの値を読みこむには、環境変数の HTTP_COOKIE の値を参照します。</p>
<div class="tab">Perl</div>
<pre class=c2>
print "$ENV{'HTTP_COOKIE'}\n";
</pre>
<p>具体的な読み込みの例は、上記の「Cookieの実行例」のソースコードを参照してください。</p>
</div>

<h4 id="CookieEncode">エンコードとデコード</h4>
<div class=i>
<p>Cookieの値では、=や;などの特殊記号や日本語文字は %82%A0 のような形式にエンコードして記録しておき、読み出し時にこれをデコードしてやる必要があります。</p>
<p>JavaScriptでエンコードするには次のようにします。最近の IE では日本語を %u65E5 のような Unicode にエンコードしてしまうので注意してください。</p>
<div class="tab">JavaScript</div>
<pre class=c2>
xx = escape(xx);
</pre>
<p>JavaScriptでデコードするには次のようにします。</p>
<div class="tab">JavaScript</div>
<pre class=c2>
xx = unescape(xx);
</pre>
<p>CGI（Perl）でエンコードするには次のようにします。</p>
<div class="tab">JavaScript</div>
<pre class=c2>
$xx =~ s/(\W)/sprintf("%%%02X", unpack("C", $1))/eg;
</pre>
<p>CGI（Perl）でデコードするには次のようにします。</p>
<div class="tab">JavaScript</div>
<pre class=c2>
$xx =~ s/%([0-9A-Fa-f][0-9A-Fa-f])/pack("C", hex($1))/eg;
</pre>
</div>

<h4 id="CookieQandA">Cookieに関するQ&amp;A</h4>
<h5>Cookieの語源は何ですか？</h5>
<div class=i>
<p>ブラウザに「食わせるもの」という意味ではないかと想像していたのですが、仕様書によると「Cookieの名前には特に理由は無い。」だそうです。ちょっと残念。</p>
</div>
<h5>Cookieで複数の値を設定するには？</h5>
<div class=i>
<p>CGI や &lt;meta&gt; の場合は Set-Cookie ヘッダを複数記述してください。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: LOGIN=tanaka;
Set-Cookie: PASSWD=hi.mi.tu;
</pre>
<p>JavaScript の場合は document.cookie = "～" を複数記述してください。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
document.cookie = "LOGIN=tanaka;";
document.cookie = "PASSWD=hi.mi.tu";
</pre>
<p>複数の値をひとつの値にまとめてしまう方法もあります。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: VALUE=NAME:tanaka:PASSWD:hi.mi.tu;
</pre>
<p>仕様書には、ひとつの Set-Cookie で複数の値を設定可能と書いてあるのですが、現状のブラウザではうまく動作しないようです。</p>
</div>
<h5>Cookieを削除するには？</h5>
<div class=i>
<p>expires で過去の時刻を指定してください。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: NAME=tanaka; expires=Fri, 31-Dec-1999 23:59:59 GMT;
</pre>
</div>
<h5>Cookieの有効期限を無期限にするには？</h5>
<div class=i>
<p>無期限という指定はできないようです。2038年以降の日付をうまく扱えないシステムもあるので、2037年頃の日付を指定しておきましょう。</p>
<div class="tab">HTTP Header</div>
<pre class=c2>
Set-Cookie: NAME=tanaka; expires=Tue, 31-Dec-2037 00:00:00 GMT;
</pre>
</div>
<h5>path=/ とすると、そのサーバー上のすべてのファイルに対して送信されるの？</h5>
<div class=i>
<p>はい。共有サーバーで、迂闊に path=/ などとしないようにしましょう。</p>
</div>
<h5>Cookieをフォルダ単位ではなく、ファイル単位に設定することはできますか？</h5>
<div class=i>
<p>path=/xxx.htm と指定すると OK かな・・・と思ったのですが、期待通りには動作してくれません。現状はフォルダ単位に設定されるようです。</p>
</div>
<h5>escape()でエンコードされたUnicodeをCGIでシフトJISにデコードするには？</h5>
<div class=i>
<p>Jcode.pm というモジュールを使用すると、Unicode → シフトJIS, EUC, JIS などの変換ができるようです。</p>
</div>
<h5>Cookieの読み込みがオンかオフかを見分けるには？</h5>
<div class=i>
<p>あるページで Cookie を設定しておいて、次のページで Cookie の値を読み出します。読み出せれば Cookie はオン。</p>
</div>

<hr>
<div>Copyright (C) 1997-2017 杜甫々</div>
<div>初版：1997年5月18日、最終更新：2017年12月31日</div>
<div>http://www.tohoho-web.com/wwwcook.htm</div>
</body>
</html>
